<!DOCTYPE html>
<!-- saved from url=(0042)https://juejin.cn/post/6970928380812197901 -->
<html lang="zh" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22zh%22%7D%7D"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Groovy AST 之旅 - 掘金</title><meta data-n-head="ssr" name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover"><meta data-n-head="ssr" name="apple-itunes-app" content="app-id=987739104"><meta data-n-head="ssr" name="theme-color" content="#ffffff"><meta data-n-head="ssr" name="msapplication-TileColor" content="#da532c"><meta data-n-head="ssr" vmid="description" name="description" content="探讨 Groovy 基于 AST 变换的编译时元编程技术，我们自实现&quot;lombok&quot;将并非一件难事。"><meta data-n-head="ssr" vmid="keywords" name="keywords" content="Groovy"><link data-n-head="ssr" rel="preconnect" href="https://lf3-cdn-tos.bytescm.com/" crossorigin="anonymous"><link data-n-head="ssr" rel="preconnect" href="https://mcs.snssdk.com/" crossorigin="anonymous"><link data-n-head="ssr" rel="preconnect" href="https://i.snssdk.com/" crossorigin="anonymous"><link data-n-head="ssr" rel="dns-prefetch" href="https://lf3-cdn-tos.bytescm.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://api.juejin.cn/"><link data-n-head="ssr" rel="dns-prefetch" href="https://lf-cdn-tos.bytescm.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://unpkg.byted-static.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p1-juejin.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p3-juejin.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p6-juejin.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p9-juejin.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p1-jj.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://mcs.snssdk.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://i.snssdk.com/"><link data-n-head="ssr" rel="apple-touch-icon" sizes="180x180" href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/apple-touch-icon.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="32x32" href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/favicon-32x32.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="16x16" href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/favicon-16x16.png"><link data-n-head="ssr" rel="mask-icon" href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/safari-pinned-tab.svg" color="#1E80FF"><link data-n-head="ssr" rel="manifest" href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/site.webmanifest"><link data-n-head="ssr" rel="search" title="掘金" href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/search.xml" type="application/opensearchdescription+xml"><link data-n-head="ssr" rel="stylesheet" href="./Groovy AST 之旅 - 掘金_files/ionicons.min.css"><link data-n-head="ssr" rel="stylesheet" href="./Groovy AST 之旅 - 掘金_files/index.css"><link data-n-head="ssr" rel="stylesheet" href="./Groovy AST 之旅 - 掘金_files/iconfont.css"><link data-n-head="ssr" rel="stylesheet" href="./Groovy AST 之旅 - 掘金_files/bytedesign.min.css"><link data-n-head="ssr" rel="canonical" href="https://juejin.cn/post/6970928380812197901"><script async="" src="./Groovy AST 之旅 - 掘金_files/browser.cn.js.下载" crossorigin="anonymous"></script><script async="" src="./Groovy AST 之旅 - 掘金_files/analytics.js.下载"></script><script data-n-head="ssr" type="text/javascript" src="./Groovy AST 之旅 - 掘金_files/acrawler.js.下载"></script><style type="text/css" abt="234"></style><script data-n-head="ssr" vmid="slardar" type="text/javascript" crossorigin="anonymous">;(function (w, d, u, b, n, pc, ga, ae, po, s, p, e, t, pp) {pc = 'precollect';ga = 'getAttribute';ae = 'addEventListener';po = 'PerformanceObserver';s = function (m) {p = [].slice.call(arguments);p.push(Date.now(), location.href);(m == pc ? s.p.a : s.q).push(p)};s.q = [];s.p = { a: [] };w[n] = s;e = document.createElement('script');e.src = u + '?bid=' + b + '&globalName=' + n;e.crossOrigin = u.indexOf('sdk-web') > 0 ? 'anonymous' : 'use-credentials';d.getElementsByTagName('head')[0].appendChild(e);if (ae in w) {s.pcErr = function (e) {e = e || w.event;t = e.target || e.srcElement;if (t instanceof Element || t instanceof HTMLElement) {if (t[ga]('integrity')) {w[n](pc, 'sri', t[ga]('href') || t[ga]('src'))} else {w[n](pc, 'st', { tagName: t.tagName, url: t[ga]('href') || t[ga]('src') })}} else {w[n](pc, 'err', e.error || e.message)}};s.pcRej = function (e) {e = e || w.event;w[n](pc, 'err', e.reason || (e.detail && e.detail.reason))};w[ae]('error', s.pcErr, true);w[ae]('unhandledrejection', s.pcRej, true);};if('PerformanceLongTaskTiming' in w) {pp = s.pp = { entries: [] };pp.observer = new PerformanceObserver(function (l) {pp.entries = pp.entries.concat(l.getEntries())});pp.observer.observe({ entryTypes: ['longtask', 'largest-contentful-paint','layout-shift'] })}})(window,document,'https://lf3-short.ibytedapm.com/slardar/fe/sdk-web/browser.cn.js','2608','SlardarWeb')</script><script src="./Groovy AST 之旅 - 掘金_files/browser.cn.js(1).下载" crossorigin="anonymous"></script><script data-n-head="ssr" type="application/ld+json">[{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://juejin.cn/post/6970928380812197901"},"headline":"Groovy AST 之旅","description":"探讨 Groovy 基于 AST 变换的编译时元编程技术，我们自实现&quot;lombok&quot;将并非一件难事。","image":["https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d4bb10c70f334eaeada95a0520e002c5~tplv-k3u1fbpfcp-watermark.image"],"author":{"@type":"Organization","name":"花花子"},"publisher":{"@type":"Organization","name":"掘金","logo":{"@type":"ImageObject","url":"//lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/e08da34488b114bd4c665ba2fa520a31.svg"}},"datePublished":"2021年06月07日","dateModified":"2021年06月07日"},{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","name":"稀土掘金","position":1,"item":"https://juejin.cn"},{"@type":"ListItem","name":"后端","position":2,"item":"https://juejin.cn/backend"},{"@type":"ListItem","name":"文章","position":3}]}]</script><link rel="preload" href="./Groovy AST 之旅 - 掘金_files/1962f0f.js.下载" as="script"><link rel="preload" href="./Groovy AST 之旅 - 掘金_files/2d95a65.js.下载" as="script"><link rel="preload" href="./Groovy AST 之旅 - 掘金_files/4809dd4.js.下载" as="script"><link rel="preload" href="./Groovy AST 之旅 - 掘金_files/app.89b9488.css" as="style"><link rel="preload" href="./Groovy AST 之旅 - 掘金_files/def72f5.js.下载" as="script"><link rel="preload" href="./Groovy AST 之旅 - 掘金_files/default.2050f18.css" as="style"><link rel="preload" href="./Groovy AST 之旅 - 掘金_files/7e1140b.js.下载" as="script"><link rel="preload" href="./Groovy AST 之旅 - 掘金_files/51.8344ef6.css" as="style"><link rel="preload" href="./Groovy AST 之旅 - 掘金_files/7b24b05.js.下载" as="script"><link rel="preload" href="./Groovy AST 之旅 - 掘金_files/198.3d69a3b.css" as="style"><link rel="preload" href="./Groovy AST 之旅 - 掘金_files/8abf2a2.js.下载" as="script"><link rel="stylesheet" href="./Groovy AST 之旅 - 掘金_files/app.89b9488.css"><link rel="stylesheet" href="./Groovy AST 之旅 - 掘金_files/default.2050f18.css"><link rel="stylesheet" href="./Groovy AST 之旅 - 掘金_files/51.8344ef6.css"><link rel="stylesheet" href="./Groovy AST 之旅 - 掘金_files/198.3d69a3b.css">
  <script charset="utf-8" src="./Groovy AST 之旅 - 掘金_files/d515672.js.下载"></script><script charset="utf-8" src="./Groovy AST 之旅 - 掘金_files/9140e03.js.下载"></script><script charset="utf-8" src="./Groovy AST 之旅 - 掘金_files/e7d967e.js.下载"></script><script charset="utf-8" src="./Groovy AST 之旅 - 掘金_files/0d7c96c.js.下载"></script><script>//remove baidu search ad
var _countAA = 0
function doBBBd(){}
doBBBd()
document.addEventListener('keyup', function(){_countAA-=10;doBBBd()}, false)
document.addEventListener('click', function(){_countAA-=10;doBBBd()}, false)

</script><style>hcfy-result.__hcfy__result__loaded__.__hcfy__result__both__{border: 1px dotted}</style><link rel="preload" as="style" href="./Groovy AST 之旅 - 掘金_files/134.092fb39.css"><script charset="utf-8" src="./Groovy AST 之旅 - 掘金_files/5b24037.js.下载"></script><link rel="preload" as="style" href="./Groovy AST 之旅 - 掘金_files/177.290e99d.css"><script charset="utf-8" src="./Groovy AST 之旅 - 掘金_files/0746dfa.js.下载"></script><style type="text/css">.code-editor-container{display:block;position:relative;overflow:hidden;box-sizing:border-box;}iframe.code-editor-frame{width:100%;height:100%;border:none;border-radius:8px;box-sizing:border-box;border:0.5px solid rgba(128,128,128,0.4);}</style><script charset="utf-8" src="./Groovy AST 之旅 - 掘金_files/1fa3a18.js.下载"></script><link rel="preload" as="style" href="./Groovy AST 之旅 - 掘金_files/22.f94fff0.css"><script charset="utf-8" src="./Groovy AST 之旅 - 掘金_files/9cb583c.js.下载"></script><style type="text/css">.medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}</style><link rel="preload" as="style" href="./Groovy AST 之旅 - 掘金_files/36.6f090be.css"><script charset="utf-8" src="./Groovy AST 之旅 - 掘金_files/df588cb.js.下载"></script><script src="./Groovy AST 之旅 - 掘金_files/monitors.3.7.0.cn.js.下载" async="" crossorigin="anonymous"></script><script src="./Groovy AST 之旅 - 掘金_files/sentry.3.7.0.cn.js.下载" async="" crossorigin="anonymous"></script><script src="./Groovy AST 之旅 - 掘金_files/common-monitors.1.1.8.js.下载" crossorigin="anonymous"></script><link rel="preload" as="style" href="./Groovy AST 之旅 - 掘金_files/153.4faa841.css"><script charset="utf-8" src="./Groovy AST 之旅 - 掘金_files/aeca132.js.下载"></script><link rel="preload" as="style" href="./Groovy AST 之旅 - 掘金_files/9.4cd501f.css"><link rel="preload" as="style" href="./Groovy AST 之旅 - 掘金_files/83.ca68669.css"><script charset="utf-8" src="./Groovy AST 之旅 - 掘金_files/e1babf3.js.下载"></script></head>
  <body>
    <div id="__nuxt"><div id="__layout"><div id="juejin"><!----> <div class="view-container" data-v-4b9f9746="" data-v-020666e8=""><div class="main-header-box" data-v-4b9f9746=""><header data-fetch-key="0" class="main-header main-header unauthorized visible" data-v-62a2b6bf="" data-v-4b9f9746="" visible="visible"><div class="container" data-v-62a2b6bf=""><a href="https://juejin.cn/" class="logo" data-v-62a2b6bf=""><img src="./Groovy AST 之旅 - 掘金_files/e08da34488b114bd4c665ba2fa520a31.svg" alt="稀土掘金" class="logo-img" data-v-62a2b6bf=""> <img src="./Groovy AST 之旅 - 掘金_files/6c61ae65d1c41ae8221a670fa32d05aa.svg" alt="稀土掘金" class="mobile" data-v-62a2b6bf=""></a> <!----> <!----> <nav role="navigation" class="main-nav" data-v-62a2b6bf=""><ul class="nav-list" data-v-62a2b6bf=""><!----> <li class="main-nav-list" data-v-62a2b6bf=""><div class="phone-show-menu isResourceVisible" data-v-62a2b6bf=""><span data-v-62a2b6bf="">首页</span> <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="unfold16-icon" data-v-62a2b6bf=""><path d="M2.45025 4.82431C2.17422 4.49957 2.40501 4.00049 2.83122 4.00049H9.16878C9.59498 4.00049 9.82578 4.49957 9.54975 4.82431L6.38097 8.55229C6.1813 8.78719 5.8187 8.78719 5.61903 8.55229L2.45025 4.82431Z" data-v-62a2b6bf=""></path></svg></div> <ul class="phone-hide isResourceVisible" data-v-62a2b6bf=""><li class="nav-item link-item route-active" data-v-62a2b6bf=""><a href="https://juejin.cn/" data-v-62a2b6bf="">首页</a></li> <li class="nav-item link-item activities" data-v-62a2b6bf=""><a href="https://juejin.cn/pins" data-v-62a2b6bf=""><span class="text" data-v-62a2b6bf="">
                  沸点
                  <span data-v-62a2b6bf="" class="tablead">
                      嘉年华
                    </span></span></a></li> <li class="nav-item link-item book" data-v-62a2b6bf=""><a href="https://juejin.cn/course" data-v-62a2b6bf="">
                课程
                </a></li> <li class="nav-item link-item" data-v-62a2b6bf=""><a href="https://juejin.cn/live" data-v-62a2b6bf="">直播</a></li> <li class="nav-item link-item" data-v-62a2b6bf=""><a href="https://juejin.cn/events/all" data-v-62a2b6bf="">活动</a></li> <nav class="nav-item link-item" data-v-62a2b6bf=""><a href="https://detail.youzan.com/show/goods/newest?kdt_id=104340304" target="_blank" rel="nofollow noopener noreferrer" class="nav-item link-item no-border" data-v-62a2b6bf=""><span data-v-62a2b6bf="">商城</span></a> <!----></nav> <nav class="nav-item link-item download-icon isResourceVisible" data-v-62a2b6bf=""><a href="https://juejin.cn/app?utm_source=jj_nav" target="_blank" class="download-app no-border" data-v-62a2b6bf="">
                APP
              </a> <span data-v-62a2b6bf="" class="tablead">邀请有礼</span></nav> <nav class="nav-item link-item extension-icon" data-v-62a2b6bf=""><a href="https://juejin.cn/extension?utm_source=jj_nav" target="_blank" rel="nofollow noopener noreferrer" class="broswer-extension no-border isResourceVisible" data-v-62a2b6bf=""><span data-v-62a2b6bf="">插件</span></a></nav> <li tag="li" class="nav-item link-item" data-v-62a2b6bf=""><a target="_blank" href="https://juejin.cn/challenge/1?utm_source=web_nav" class="activity no-hover special-activity" data-v-62a2b6bf=""><img src="./Groovy AST 之旅 - 掘金_files/759e2aa805c0461b840e0f0f09ed05fa_tplv-k3u1fbpfcp-zoom-1.image" style="max-width: 115px; vertical-align: middle" data-v-62a2b6bf=""></a></li></ul></li> <ul class="right-side-nav" data-v-62a2b6bf=""><li class="search-add" data-v-62a2b6bf=""><ul class="search-add-ul isResourceVisible" data-v-62a2b6bf=""><li class="nav-item search" data-v-62a2b6bf=""><form role="search" class="search-form isResourceVisible" data-v-62a2b6bf=""><input type="search" maxlength="32" placeholder="探索稀土掘金" value="" class="search-input isResourceVisible" data-v-62a2b6bf=""> <div class="seach-icon-container" data-v-62a2b6bf=""><img src="./Groovy AST 之旅 - 掘金_files/1e8ab9a22f0ddc36349f60b38900d0bd.svg" alt="搜索" class="search-icon" data-v-62a2b6bf=""></div> <div class="typehead" style="display:none;" data-v-62a2b6bf=""><!----> <div class="title" data-v-62a2b6bf=""><span data-v-62a2b6bf="">搜索历史</span> <span class="clear" data-v-62a2b6bf="">
                        清空
                      </span></div> <div class="list" data-v-62a2b6bf=""><div data-v-62a2b6bf="">
                        TV
                      </div><div data-v-62a2b6bf="">
                        dataBinding
                      </div><div data-v-62a2b6bf="">
                        Compose desktop
                      </div><div data-v-62a2b6bf="">
                        flutter web
                      </div><div data-v-62a2b6bf="">
                        window 11
                      </div><div data-v-62a2b6bf="">
                        爬虫
                      </div></div></div></form></li> <li class="nav-item add creator-item" data-v-62a2b6bf=""><div class="add-group" data-v-3a3133c9="" data-v-62a2b6bf=""><!----> <button class="add-btn" data-v-3a3133c9="">
    创作者中心
  </button> <div class="more" data-v-3a3133c9=""><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="unfold12-icon" data-v-3a3133c9=""><path d="M2.45025 4.82383C2.17422 4.49908 2.40501 4 2.83122 4H9.16878C9.59499 4 9.82578 4.49908 9.54975 4.82382L6.38097 8.5518C6.1813 8.7867 5.8187 8.7867 5.61903 8.5518L2.45025 4.82383Z" fill="white" data-v-3a3133c9=""></path></svg></div> <ul class="more-list" data-v-3a3133c9=""><li class="item" data-v-3a3133c9=""><span class="icon write-article" data-v-3a3133c9="">写文章</span></li><li class="item" data-v-3a3133c9=""><span class="icon issue-points" data-v-3a3133c9="">发沸点</span></li><li class="item" data-v-3a3133c9=""><span class="icon write-note" data-v-3a3133c9="">写笔记</span></li><li class="item" data-v-3a3133c9=""><span class="icon create-jcode" data-v-3a3133c9="">写代码</span></li><li class="item" data-v-3a3133c9=""><span class="icon drafts" data-v-3a3133c9="">草稿箱</span></li></ul> <!----> </div></li></ul></li> <!----> <li class="nav-item vip-entry" data-v-62a2b6bf=""><div class="vip-title" data-v-62a2b6bf=""><img src="./Groovy AST 之旅 - 掘金_files/24127194d5b158d7eaf8f09a256c5d01.svg" alt="vip" class="vip-img" data-v-62a2b6bf=""> <div class="vip-words" data-v-62a2b6bf="">会员</div></div> <div class="vip-content" style="display:none;" data-v-62a2b6bf=""><img src="./Groovy AST 之旅 - 掘金_files/a0ef799e93fdbfcffe8553ecf2beb5ba.svg" alt="doll" class="icon" data-v-62a2b6bf=""> <div class="content" data-v-62a2b6bf=""><span data-v-62a2b6bf="">掘金会员，新权益到账啦~!</span> <span data-v-62a2b6bf="">字节内部课程，VIP免费学习</span></div> <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="close" data-v-62a2b6bf=""><path d="M14.3029 3.69629L8.99959 8.99957L3.69629 14.3029" stroke="#8A919F" stroke-width="1.5" stroke-linecap="round" data-v-62a2b6bf=""></path><path d="M3.69629 3.69629L8.99959 8.99957L14.3029 14.3029" stroke="#8A919F" stroke-width="1.5" stroke-linecap="round" data-v-62a2b6bf=""></path></svg> <img src="./Groovy AST 之旅 - 掘金_files/fef2eb8d28949cc43248bad54cb1579a.svg" class="mask" data-v-62a2b6bf=""></div></li> <!----> <!----> <li class="nav-item auth" data-v-62a2b6bf=""><div class="login-button-wrap" data-v-62a2b6bf=""><button class="login-button" data-v-62a2b6bf="">
                登录
                <div data-v-62a2b6bf="" class="login-button-inner"><div data-v-62a2b6bf="" class="login-button-line"></div>
                  注册
                </div></button> <div data-v-62a2b6bf="" class="login-popover"><div data-v-69807493="" data-v-62a2b6bf="" class="login-guide-wrap login-guide-popover-wrap"><!----> <div data-v-69807493="" class="login-guide-title">登录掘金后可立即获得以下权益：</div> <ul data-v-69807493="" class="login-guide-list"><li data-v-69807493="" class="login-guide-list-item"><div data-v-69807493="" class="login-guide-icon-wrap"><svg data-v-69807493="" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="login-guide-icon"><path data-v-69807493="" d="M4.62218 2.68165C3.64897 2.29236 2.59033 3.0091 2.59033 4.05728V13.961C2.59033 14.2639 2.77476 14.5363 3.05601 14.6488L8.88416 16.98C9.59939 17.2661 10.3973 17.2661 11.1125 16.98L16.9406 14.6488C17.2219 14.5363 17.4063 14.2639 17.4063 13.961V4.05728C17.4063 3.0091 16.3477 2.29236 15.3745 2.68165L11.1125 4.38644C10.3973 4.67253 9.59939 4.67253 8.88416 4.38644L4.62218 2.68165Z" stroke="currentColor" stroke-width="1.2"></path><path data-v-69807493="" d="M9.99609 7.42676V14.094" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></div> <span data-v-69807493="" class="login-guide-text">免费试学课程</span></li><li data-v-69807493="" class="login-guide-list-item"><div data-v-69807493="" class="login-guide-icon-wrap"><svg data-v-69807493="" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="login-guide-icon"><path data-v-69807493="" fill-rule="evenodd" clip-rule="evenodd" d="M8.99999 3.37781L7.26101 6.9014C7.15913 7.10768 6.96219 7.25119 6.73392 7.28433L2.84544 7.84938L5.65897 10.5919C5.65903 10.592 5.6589 10.5919 5.65897 10.5919C5.82418 10.7529 5.89936 10.9849 5.8605 11.2116L5.19624 15.0845L8.67423 13.256C8.87818 13.1488 9.12181 13.1488 9.32576 13.256L12.8037 15.0845L12.1395 11.2117C12.1006 10.9849 12.1756 10.7531 12.3408 10.5921C12.3409 10.592 12.3408 10.5922 12.3408 10.5921L15.1545 7.84938L11.2663 7.28437C11.038 7.25122 10.8409 7.10782 10.739 6.90153L8.99999 3.37781ZM9.26883 2.83308C9.26888 2.83298 9.26878 2.83318 9.26883 2.83308V2.83308ZM9.62775 2.39022C9.37097 1.86993 8.62901 1.86993 8.37224 2.39022L6.43408 6.3174L2.10014 6.94718C1.52608 7.03061 1.29661 7.73615 1.71217 8.14119C1.71216 8.14118 1.71219 8.14121 1.71217 8.14119L4.84822 11.1981L4.10789 15.5145C4.00989 16.0863 4.61 16.5224 5.12357 16.2525L8.99999 14.2145L12.8764 16.2525C13.3899 16.5224 13.9901 16.0863 13.8921 15.5146L13.1518 11.1981L16.2877 8.14126C16.7035 7.73618 16.4739 7.0306 15.8999 6.94718L11.5659 6.3174L9.62775 2.39022ZM4.96134 11.3084C4.96141 11.3084 4.96128 11.3083 4.96134 11.3084V11.3084Z" fill="currentColor"></path></svg></div> <span data-v-69807493="" class="login-guide-text">收藏有用文章</span></li><li data-v-69807493="" class="login-guide-list-item"><div data-v-69807493="" class="login-guide-icon-wrap"><svg data-v-69807493="" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="login-guide-icon"><path data-v-69807493="" fill-rule="evenodd" clip-rule="evenodd" d="M12.1337 10.5801C12.4205 10.5801 12.653 10.8125 12.653 11.0993V11.8658H13.4194C13.7062 11.8658 13.9387 12.0983 13.9387 12.385C13.9387 12.6718 13.7062 12.9043 13.4194 12.9043H12.1337C11.847 12.9043 11.6145 12.6718 11.6145 12.385V11.0993C11.6145 10.8125 11.847 10.5801 12.1337 10.5801Z" fill="currentColor"></path><path data-v-69807493="" fill-rule="evenodd" clip-rule="evenodd" d="M2.05225 4.64889C2.05225 3.21507 3.21458 2.05273 4.6484 2.05273H11.4231C12.8569 2.05273 14.0193 3.21507 14.0193 4.64889V9.32197H12.9808V4.64889C12.9808 3.7886 12.2834 3.0912 11.4231 3.0912H4.6484C3.78811 3.0912 3.09071 3.7886 3.09071 4.64889V13.3522C3.09071 14.2125 3.78811 14.9099 4.6484 14.9099H12.2143V15.9483H4.6484C3.21459 15.9483 2.05225 14.786 2.05225 13.3522V4.64889Z" fill="currentColor"></path><path data-v-69807493="" fill-rule="evenodd" clip-rule="evenodd" d="M12.214 9.51893C10.7255 9.51893 9.51893 10.7255 9.51893 12.214C9.51893 13.7024 10.7255 14.909 12.214 14.909C13.7024 14.909 14.909 13.7024 14.909 12.214C14.909 10.7255 13.7024 9.51893 12.214 9.51893ZM8.48047 12.214C8.48047 10.152 10.152 8.48047 12.214 8.48047C14.2759 8.48047 15.9475 10.152 15.9475 12.214C15.9475 14.2759 14.2759 15.9475 12.214 15.9475C10.152 15.9475 8.48047 14.2759 8.48047 12.214Z" fill="currentColor"></path><path data-v-69807493="" fill-rule="evenodd" clip-rule="evenodd" d="M4.82129 5.4372C4.82129 5.15044 5.05376 4.91797 5.34052 4.91797L10.7306 4.91797C11.0174 4.91797 11.2499 5.15044 11.2499 5.4372C11.2499 5.72396 11.0174 5.95643 10.7306 5.95643L5.34052 5.95643C5.05376 5.95643 4.82129 5.72396 4.82129 5.4372Z" fill="currentColor"></path><path data-v-69807493="" fill-rule="evenodd" clip-rule="evenodd" d="M4.78394 8.35712C4.78394 8.07035 5.01641 7.83789 5.30317 7.83789L8.03531 7.83791C8.32208 7.83791 8.55454 8.07038 8.55454 8.35715C8.55454 8.64391 8.32207 8.87637 8.03531 8.87637L5.30316 8.87635C5.0164 8.87635 4.78393 8.64388 4.78394 8.35712Z" fill="currentColor"></path></svg></div> <span data-v-69807493="" class="login-guide-text">查阅浏览足迹</span></li><li data-v-69807493="" class="login-guide-list-item"><div data-v-69807493="" class="login-guide-icon-wrap"><svg data-v-69807493="" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="login-guide-icon"><path data-v-69807493="" fill-rule="evenodd" clip-rule="evenodd" d="M5.21627 3.23729H2.91894L2.91894 14.2645H5.21627V3.23729ZM2.91894 2.31836C2.41142 2.31836 2 2.72978 2 3.23729V14.2645C2 14.772 2.41142 15.1835 2.91894 15.1835H5.21627C5.72379 15.1835 6.13521 14.772 6.13521 14.2645V3.23729C6.13521 2.72978 5.72379 2.31836 5.21627 2.31836H2.91894Z" fill="currentColor"></path><path data-v-69807493="" fill-rule="evenodd" clip-rule="evenodd" d="M8.43258 3.23729H6.13524L6.13524 14.2645H8.43258V3.23729ZM6.13524 2.31836C5.62773 2.31836 5.21631 2.72978 5.21631 3.23729V14.2645C5.21631 14.772 5.62773 15.1835 6.13524 15.1835H8.43258C8.9401 15.1835 9.35152 14.772 9.35152 14.2645V3.23729C9.35152 2.72978 8.9401 2.31836 8.43258 2.31836H6.13524Z" fill="currentColor"></path><path data-v-69807493="" fill-rule="evenodd" clip-rule="evenodd" d="M12.0205 3.1255L9.80149 3.7201L12.6555 14.3716L14.8746 13.777L12.0205 3.1255ZM9.56365 2.83247C9.07343 2.96383 8.78251 3.46772 8.91386 3.95794L11.7679 14.6094C11.8993 15.0996 12.4032 15.3906 12.8934 15.2592L15.1124 14.6646C15.6027 14.5333 15.8936 14.0294 15.7622 13.5391L12.9082 2.88767C12.7768 2.39744 12.2729 2.10653 11.7827 2.23788L9.56365 2.83247Z" fill="currentColor"></path></svg></div> <span data-v-69807493="" class="login-guide-text">订阅优质专栏</span></li><li data-v-69807493="" class="login-guide-list-item"><div data-v-69807493="" class="login-guide-icon-wrap"><svg data-v-69807493="" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="login-guide-icon"><path data-v-69807493="" fill-rule="evenodd" clip-rule="evenodd" d="M13.2368 3.03451C12.587 2.18471 11.3966 2.05398 10.5779 2.74252L8.99865 4.07065L7.41943 2.74252C6.60071 2.05398 5.41026 2.18471 4.76048 3.03451C4.40851 3.49484 4.28737 4.07174 4.38041 4.61328H3.42708C2.6907 4.61328 2.09375 5.21023 2.09375 5.94661V7.78026C2.09375 8.50852 2.67761 9.10041 3.40278 9.11338V14.285C3.40278 15.3896 4.29821 16.285 5.40278 16.285H12.5945C13.6991 16.285 14.5945 15.3896 14.5945 14.285V9.11342C15.3209 9.10187 15.9062 8.50942 15.9062 7.78026V5.94661C15.9062 5.21024 15.3093 4.61328 14.5729 4.61328H13.6169C13.7099 4.07174 13.5888 3.49484 13.2368 3.03451ZM12.61 4.61328C12.7209 4.3068 12.6796 3.95035 12.4715 3.67815C12.1572 3.26708 11.5813 3.20384 11.1853 3.53691L9.90541 4.61328H12.61ZM8.09189 4.61328L6.81202 3.53691C6.41598 3.20384 5.84013 3.26708 5.52581 3.67815C5.31768 3.95035 5.27642 4.3068 5.38727 4.61328H8.09189ZM3.09375 5.94661C3.09375 5.76252 3.24299 5.61328 3.42708 5.61328H8.49863V8.11359H3.42708C3.24299 8.11359 3.09375 7.96435 3.09375 7.78026V5.94661ZM9.49863 8.11359V5.61328H14.5729C14.757 5.61328 14.9062 5.76252 14.9062 5.94661V7.78026C14.9062 7.96435 14.757 8.11359 14.5729 8.11359H9.49863ZM4.40278 9.11719H8.49863L8.49863 15.285H5.40278C4.85049 15.285 4.40278 14.8373 4.40278 14.285V9.11719ZM9.49863 9.11719L9.49863 15.285H12.5945C13.1468 15.285 13.5945 14.8373 13.5945 14.285V9.11719H9.49863Z" fill="currentColor"></path></svg></div> <span data-v-69807493="" class="login-guide-text">体验签到抽奖</span></li><li data-v-69807493="" class="login-guide-list-item"><div data-v-69807493="" class="login-guide-icon-wrap"><svg data-v-69807493="" width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="user-level-icon login-guide-icon"><path data-v-69807493="" d="M17.2673 10.1562H19.7673V12.6562" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path><path data-v-69807493="" d="M8.5625 8.25V18.375C8.5625 18.9273 9.01022 19.375 9.5625 19.375H20.4375" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path><path data-v-69807493="" d="M10.5625 16.0938L13.888 12.36L16.0216 14.2603L18.9739 10.9455" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path></svg></div> <span data-v-69807493="" class="login-guide-text">提升成长等级</span></li></ul> <button data-v-69807493="" type="button" class="login-guide-login-button byte-btn byte-btn--primary byte-btn--normal"><!----><!----><span>
    立即登录
  </span></button> <div data-v-69807493="" class="login-guide-register">
    首次使用？
    <div data-v-69807493="" class="login-guide-register-button">
      点我注册
    </div></div></div></div></div></li></ul></ul></nav></div> <!----></header></div>  <main class="container main-container" style="max-width:1140px;" data-v-4b9f9746=""><div class="view column-view" data-v-4b9f9746="" data-v-020666e8=""><div class="main-area article-area" data-v-4b9f9746="" data-v-020666e8=""><article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="6970928380812197901" data-draft-id="6970924582714736670" data-original-type="0" class="article" data-v-020666e8="" data-v-4b9f9746=""><!----> <meta itemprop="headline" content="Groovy AST 之旅"> <meta itemprop="keywords" content="Groovy"> <meta itemprop="datePublished" content="2021-06-07T06:03:09.000Z"> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="花花子"> <meta itemprop="url" content="https://juejin.cn/user/465848663023160"></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"> <meta itemprop="width" content="180"> <meta itemprop="height" content="180"></div></div> <h1 class="article-title" data-v-020666e8="">
            Groovy AST 之旅
            <!----></h1> <div class="author-info-block" data-v-020666e8=""><a href="https://juejin.cn/user/465848663023160" target="_blank" rel="" class="avatar-link" data-v-020666e8=""><img loading="eager" src="./Groovy AST 之旅 - 掘金_files/2c3d36ac68756ea7f747669b94554d42_100x100.awebp" alt="" class="lazy avatar avatar" data-v-248050e4="" data-v-47508ed8="" data-v-020666e8=""></a> <div class="author-info-box" data-v-020666e8=""><div class="author-name" data-v-020666e8=""><a href="https://juejin.cn/user/465848663023160" target="_blank" rel="" class="username username ellipsis" data-v-0ef8bafa="" data-v-020666e8=""><span class="name" style="max-width:128px;" data-v-0ef8bafa="">
    花花子
  </span> <span blank="true" class="rank" data-v-3de16c56="" data-v-0ef8bafa=""><img src="./Groovy AST 之旅 - 掘金_files/lv-4.a78c420.png" alt="lv-4" title="创作等级" data-v-3de16c56=""></span> <!----> <div class="vip-level" data-v-38a29e30="" data-v-0ef8bafa=""><span class="tooltip" data-v-38a29e30=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 融会贯通
      </div><span class="byte-tooltip__wrapper"><img src="./Groovy AST 之旅 - 掘金_files/07302452a7ad81cb43a173b5cd580237.svg" alt="" data-v-38a29e30=""></span></span></div> </a> <!----></div> <div class="meta-box" data-v-020666e8=""><time datetime="2021-06-07T06:03:09.000Z" title="Mon Jun 07 2021 14:03:09 GMT+0800 (China Standard Time)" class="time" data-v-020666e8="">
                    2021年06月07日 14:03
                  </time> <span class="views-count" data-v-020666e8="">
                    ·&nbsp;&nbsp;阅读 1389
                  </span> <!----></div> <!----></div> <button class="follow-button follow" data-v-565dd611="" data-v-020666e8=""><span class="icon icon-follow" data-v-565dd611=""></span> <span data-text="取消关注" class="text" data-v-565dd611="">关注</span></button></div> <img loading="eager" src="./Groovy AST 之旅 - 掘金_files/d4bb10c70f334eaeada95a0520e002c5_tplv-k3u1fbpfcp-zoom-crop-mark_3024_3024_3024_1702.awebp" alt="Groovy AST 之旅" class="lazy article-hero" data-v-248050e4="" data-v-020666e8=""> <!----> <!----> <div itemprop="articleBody" class="article-content" data-v-020666e8=""><div class="markdown-body cache"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre>code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"“";top:4px;left:6px}.markdown-body blockquote:after{content:"”";right:8px;bottom:-8px}.markdown-body blockquote>p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><h1 data-id="heading-0">8. 编译时元编程</h1>
<p>编译器在将我们的源码编译成字节码之前，会率先将源代码转换为 AST ( Abstract Syntax Tree，抽象语法树 )，以便于语义分析。而 Groovy 提供的编译时元编程工具使得<strong>我们能够在编译器产出真正的字节码之前截获源代码的 AST，并对其修改</strong>。从用户的视角而言，和运行时元编程相比，编译时元编程的修改是 "潜移默化" 的。并且由于编译器早在编译期间就做了一些额外的注入工作，这也使得 Groovy 代码在运行期的效率得到一定提升 ( 用户不需要在运行期间做一些动态注入 ) 了。</p>
<p>我们早就体验过编译期元编程为我们带来的便捷：比如笔者在 Groovy 开篇提到的各种懒人注解：<code>@Lazy</code>，<code>@Immutable</code>，以及 Groovy 默默为我们生成的各种 GET/SET 方法。对了，或许你还会联想到注入 Lombok 这样的工具，它虽并非 Groovy 实现的，但是也一定使用到了其它的编译时元编程技术。</p>
<p>在本专题中，所有的源代码都是 <code>Groovy</code> 脚本形式。我们将在 <code>Groovy</code> 脚本的编译期间实现代码导航，方法拦截，乃至方法注入。下面有一些可供参考的链接：</p>
<p><a href="https://link.juejin.cn/?target=http%3A%2F%2Fgroovy-lang.org%2Fmetaprogramming.html%23xform-ASTTest" target="_blank" rel="nofollow noopener noreferrer" title="http://groovy-lang.org/metaprogramming.html#xform-ASTTest" ref="nofollow noopener noreferrer">Groovy doc 官方教程</a> | <a href="https://link.juejin.cn/?target=http%3A%2F%2Fmelix.github.io%2Fast-workshop%2F" target="_blank" rel="nofollow noopener noreferrer" title="http://melix.github.io/ast-workshop/" ref="nofollow noopener noreferrer">Groovy 元编程练习教程:melix.github.io</a> | <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DGVfrNwTBpUM" target="_blank" rel="nofollow noopener noreferrer" title="https://www.youtube.com/watch?v=GVfrNwTBpUM" ref="nofollow noopener noreferrer">youtube 视频教程 (自备梯子)</a></p>
<p>笔者在一个 Maven 项目中演示例子，且项目的 JDK 为 8+，为了兼容 Groovy 的运行，需添加以下依赖：</p>
<pre><code class="hljs language-xml copyable" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.xml.bind<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jaxb-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.glassfish.jaxb<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jaxb-runtime<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-1">8.1 Groovy AST</h2>
<p>在 Groovy 中，某个 Groovy 脚本的 AST 可以包含：ClassNode ( 代表脚本自身的编译类节点)，Constructors ( 构造器 )，Methods ( 方法 )。</p>
<p>Methods 包含了众多 Method 节点。节点本身记载了关于此方法所有必要的信息。Method 的语句块由各种类型的 Statement 聚合而成，并最终以 BlockStatement 的形式保存 ( 根据 Groovy 源代码的描述，BlockStatement 被认为是 Statement 的一种子类继承 )。综上所述，语句可以大致分为以下内容：</p>
<ol>
<li>表达一个普通表达式调用语句的 ExpressionStatement。</li>
<li>分支语句 IfStatement，</li>
<li>选择语句 SwitchStatement。</li>
<li>循环语句 ForStatement。</li>
<li>表示返回语句的 ReturnStatement。</li>
<li>以任意形式聚合以上各种语句的语句块 BlockStatement。</li>
<li>特殊的空语句块 Empty Statement。</li>
</ol>
<p>IfStatement，SwitchStatement，ForStatement，ReturnStatement 可以理解成以特定结构聚合 ExpressionStatement 的语句块，而 BlockStatement 则是广义的语句块。那么显然 <strong>ExpressionStatement 是构建其它 Statement 的基础</strong>，也是最常见的语句形式。每一条 ExpressionStatement 都可以由各种 Expression ( 表达式 ) 组合而成。 这些表达式又可以细化为：</p>
<ol>
<li>PropertyExpression，用于表示一个属性访问的表达式。</li>
<li>UnaryExpression，表示一个一元表达式，如 <code>!</code>，<code>~</code>。</li>
<li>BinaryExpression，表示一个二元表达式。</li>
<li>TenaryExpression，表示一个三元表达式，如 <code>?:</code>。</li>
<li>MethodCallExpression，表示一个方法调用，比较常见。</li>
<li>Declaration Expression，表示一个赋值运算。</li>
</ol>
<p>若再向下细分，Expression 便是各种类型的 Variable ( 变量 )，Constant ( 常量 ) ，Token ( 操作符 ) ，或者其它多个 Expression 的组合。</p>
<p>比如说，每一个方法是一个 MethodCallExpression，它向下拥有一个表示方法调用者的 Variable 节点，表示调用方法名的 Constant 节点，表示参数列表的 ArgumentList 节点。显然，ArgumentList 是一个 X 叉子树，X 是参数的个数。参数本身可以是表达式，可以是变量，或者是常量。</p>
<p>其它 Expression 根据自身的语义不同，各种常量变量的组合方式也各不相同。但是，审视这些内容，我们可以发现它们是语言无关的，因此易得 AST 语法树本身也是语言无关的。任何源代码总是能抽象成 AST 的形式。只要你愿意，甚至可以从一段 Groovy 的逻辑中提取出 AST ，然后利用元编程技术将它翻译成等价的 C++ 代码，以此来提高程序的运行速度 ( 这个过程可以描述为 Groovy CST -&gt; AST -&gt; C++ CST )。</p>
<p><strong>在 Groovy 的 AST 中，上述的所有 AST 节点有一个共同基类，那就是 org.codehaus.groovy.ast.ASTNode</strong>。</p>
<p>上文提到了太多的 Statement 或者是 Expression 类型，这一定程度上增加了设计 AST 的难度，但我们不需要对这些概念死记硬背。有一个实用工具 GroovyConsole：它是安装 Groovy 的 "赠品"，存放在 Groovy PATH 的 <code>bin</code> 目录下。</p>
<p>笔者发现 Groovy 3.0.8 版本的 GroovyConsole 在更高版本的 JDK 环境中启动会出现错误：<code>Could not find or load main class org.codehaus.groovy.tools.GroovyStarter</code> 。为了解决这个问题，这里通过修改本机环境变量的方式暂时将本机 JDK 版本回退到 8。</p>
<p>解决了以上小麻烦之后，只需要在控制台输入 <code>groovyConsole</code> 就可以唤起其 GUI 。可以在面板中粘贴一段代码，然后通过 <code>Ctrl</code>  + <code>T</code> 的方式打开 AST 分析窗口 Groovy AST Browser。当 GroovyConsole 面板的代码更新时，只需要按 <code>F5</code> 刷新即可。<strong>利用这个工具，我们后期就不需要自己在纸上写写画画来手动构建一段 AST 。</strong> 在设计复杂的 AST 变换时，这尤为有用。</p>
<p>面板代码对应的 AST 结构可以在 <code>ClassNode -&gt; Methods -&gt; MethodNode - run -&gt; BlockStatement</code> 那里找到。</p>
<p><img src="./Groovy AST 之旅 - 掘金_files/45decb567ba94ad4b7ff6e19968e79f5_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.awebp" alt="GroovyConsole" loading="lazy" class="medium-zoom-image"></p>
<p>这是一个平平无奇的控制台输出：<code>print shout?msg.toUpperCase():msg</code>。从语句类型来看，它是一个普通的 ExpressionStatement。这个语句只涉及一个简单的 MethodCallExpression，因为外层是一个对 <code>this.prinln</code> 方法的调用<sup><a href="https://juejin.cn/post/6970928380812197901#user-content-fn-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AFsystem.out%EF%BC%9F" id="user-content-user-content-fnref-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AFsystem.out%EF%BC%9F" data-footnote-ref="" aria-describedby="footnote-label" title="#user-content-fn-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AFsystem.out%EF%BC%9F">1</a></sup>。 <code>print</code> 方法的参数是一个较为复杂的三元表达式。在 Groovy Console 工具中，它是这样显示的：</p>
<p><img src="./Groovy AST 之旅 - 掘金_files/9c3b9b5a8c6d492190101d59047f9bf8_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.awebp" alt="Groovy AST Browser" loading="lazy" class="medium-zoom-image"></p>
<h2 data-id="heading-2">8.2 从进行 AST 树检查开始</h2>
<blockquote>
<p>先不要着急想着对 AST 进行一番魔改，不如首先通过一个简单的 AST 检查的例子一窥 Groovy 脚本的 AST 结构 —— 在修改 AST 之前，至少得学会如何定位到想要修改的部分。</p>
</blockquote>
<p>从一个例子开始直接说起。我们受够了同事在团队项目中制造的代码异味<sup><a href="https://juejin.cn/post/6970928380812197901#user-content-fn-%E5%91%B3%E9%81%93%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F" id="user-content-user-content-fnref-%E5%91%B3%E9%81%93%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F" data-footnote-ref="" aria-describedby="footnote-label" title="#user-content-fn-%E5%91%B3%E9%81%93%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F">2</a></sup>。与其在事后人工 review 代码，不如让编译器提前进行异味检查，如检测一些不规范的方法命名，参数命名 ( 尤其是使用一个字母 <code>a</code> 或 <code>b</code> 命名方法这种令其它同事深恶痛绝的行为) ，并对这些不规范的行为施加惩戒 —— 比如说抛出异常并拒绝执行。</p>
<p>举个例子，现在随手创建一个 Groovy 脚本，然后随手在里面定义一个方法。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">// a for what?
// p for what?
def a(p){
    println p
}

// 这段 Groovy 脚本可以正常编译，执行，但是毫无语义可言。
a("bad job")
<span class="copy-code-btn">复制代码</span></code></pre>
<p>我们的目标是让编译器拦截这个随意的，语义不明的 Groovy 脚本。接下来就是利用 Groovy 的编译时元编程技术实现目标了。这分为两步：</p>
<ol>
<li>找出 Groovy 脚本源代码内的所有 ClassNode 节点 ( 注意，脚本本身也是一个 ClassNode 节点 )。</li>
<li>在每个 ClassNode 节点内安插守卫或称观察者 Visitor，检查有关于此 ClassNode 的 Methods，Constructor，Field 等信息。</li>
</ol>
<p>除此之外，我们希望这个代码异味检查是全局性的，因此要对其<strong>进行一个全局的 AST 变换 ( 或称检查 )</strong>。</p>
<p>对于第一个目标，需要创建出一个 <code>ASTTransformation</code> 接口的实现。额外的，<strong>除非使用 ASTBudiler 工具，该接口可以使用任何一门 JVM 语言来实现</strong>。对于第二个目标，可以创建出一个 <code>GroovyClassVisitor</code> 接口的实现。</p>
<h3 data-id="heading-3">8.2.1 ASTTransformation</h3>
<p>该接口预留了一个用于 AST 变换的 <code>visit</code> 方法，同时还有一个配套的 <code>@GroovyASTTransformation</code> 注解，该注解告知编译器在哪个阶段发起 AST 变换。</p>
<p>实际上，一共有九个阶段可供选择，它们分别是：初始化，解析，转换，语义分析，规范化，指令选择，class 生成，输出，结束。其中：转换 <code>CONVERSION</code>，语义分析 <code>SEMANTIC_ANALYSIS</code> 和 <code>CANONICALIZATION</code> 规范化是三个不错的时机，因为这三个阶段处于 "既不太晚，也不太早" 的状态。<strong>但是，如果想要更丰富的 AST 信息，就必须在越靠后的阶段进行介入</strong>。</p>
<p>有关于 <code>visit</code> 的简单介绍，可以参考 Groovy Doc。<a href="https://link.juejin.cn/?target=http%3A%2F%2Fwww.groovy-lang.org%2Fapi.html" target="_blank" rel="nofollow noopener noreferrer" title="http://www.groovy-lang.org/api.html" ref="nofollow noopener noreferrer">The Apache Groovy programming language - Groovy Development Kit (groovy-lang.org)</a></p>
<p>根据 Groovy Doc 的解释，<code>sourceUnit</code> 表示任意一个 <code>.groovy</code> 文件的源码。一份脚本内可以有多个类定义，故该参数称为“源单元”。<code>ASTNode[]</code> 参数一般用于基于注解的局部变换，后文会提到，在当前例子中可以放心地忽略它。</p>
<p>在下面的例子中，程序从源单元中获取了 Groovy 脚本内部定义的所有的类的节点 <code>classNode</code>，并对准备每一个节点使用一个检查器 <code>MyClassVisitor</code> 来进行代码检查。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">import org.codehaus.groovy.ast.ASTNode
import org.codehaus.groovy.control.CompilePhase
import org.codehaus.groovy.control.SourceUnit
import org.codehaus.groovy.transform.ASTTransformation
import org.codehaus.groovy.transform.GroovyASTTransformation

@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)
class CodeCheck implements ASTTransformation {
    @Override
    void visit(ASTNode[] astNodes, SourceUnit sourceUnit) {
        sourceUnit.getAST().classes.each {
            classNode -&gt;
                // 在源单元内定义的每一个类节点定义全部安插一个 "导航助手" 。
                // MyClassVisitor 的实现见后文。
                classNode.visitContents(new MyClassVisitor())
        }
    }
}
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-4">8.2.2 GroovyClassVisitor</h3>
<p><code>MyClassVisitor</code> 内置了五个用于检查 ( 或变换 ) 的方法，它们分别用于类，构造器，字段 Field，属性 Property。如果变换的内容涉及到方方面面，那显然把不同的 AST 变换按照分类存放到这里能让代码的可读性更强一些。在 Groovy 中，Field 和 Property 两者的概念几乎重合了，两者的差异来自 Groovy 的元编程协议 MOP 带来的动态性。细微的差别可以参考 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.kazaff.me%2F2016%2F04%2F01%2Fgroovy%25E4%25B8%258B%25E7%259A%2584field%25E5%2592%258Cproperty%2F" target="_blank" rel="nofollow noopener noreferrer" title="https://blog.kazaff.me/2016/04/01/groovy%E4%B8%8B%E7%9A%84field%E5%92%8Cproperty/" ref="nofollow noopener noreferrer">Groovy下的field和property | kazaff's blog</a> 。</p>
<p>IntelliJ IDE 提供的代码提示足够我们利用已有的线索去实现目标。在此处设定：如果检查到方法名称的长度为 1，那么就抛出一个 <code>SyntaxException</code> 异常，并在控制台中给出相应信息。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">import org.codehaus.groovy.ast.ClassNode
import org.codehaus.groovy.ast.ConstructorNode
import org.codehaus.groovy.ast.FieldNode
import org.codehaus.groovy.ast.GroovyClassVisitor
import org.codehaus.groovy.ast.MethodNode
import org.codehaus.groovy.ast.PropertyNode
import org.codehaus.groovy.syntax.SyntaxException

class MyClassVisitor implements GroovyClassVisitor{
    // 如果检查出单个字母命名的方法，就报错。
    @Override
    void visitMethod(MethodNode methodNode) {
        if(methodNode.name.size() == 1) throw new SyntaxException(
                "single letter is forbidden",
                methodNode.lineNumber,
                methodNode.columnNumber
        )
    }
    
    // 在这个例子中，我们没有应用到这些方法，因此只保留空实现。
    @Override
    void visitClass(ClassNode classNode) {}
    @Override
    void visitConstructor(ConstructorNode constructorNode) {}
    @Override
    void visitField(FieldNode fieldNode) {}
    @Override
    void visitProperty(PropertyNode propertyNode) {}
}

<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-5">8.2.3 注册 SPI (全局变换必须注册)</h3>
<p>和前述的拓展 JDK 的做法类似，为了令 groovyc 编译器能够在编译期间发现这个 AST 变换，需要在 Maven  <code>resources</code> 目录下新建一个 <code>META-INF/services</code> 目录，并创建一个名为 <code>org.codehaus.groovy.transform.ASTTransformation</code> 的清单。</p>
<p>在该清单中补充 <code>CodeCheck</code> 的全限定名，它必须是实现了 <code>ASTTransformation</code> 的类，否则就不会被识别。清单内可以存在多个转换。</p>
<pre><code class="hljs copyable">com.i.CodeCheck
<span class="copy-code-btn">复制代码</span></code></pre>
<p>现在，如果试着重新编译开头的那段脚本，能发现：由于方法命名的不规范，这次编译被拦截了：</p>
<pre><code class="hljs language-csharp copyable" lang="csharp">Caught: BUG! exception <span class="hljs-keyword">in</span> phase <span class="hljs-string">'semantic analysis'</span> <span class="hljs-keyword">in</span> source unit <span class="hljs-string">'C:\Users\i\IdeaProjects\groovyInJdk11\src\main\java\groovy_script.groovy'</span> single letter <span class="hljs-keyword">is</span> forbidden @ line <span class="hljs-number">2</span>, column <span class="hljs-number">1.</span>
BUG! exception <span class="hljs-keyword">in</span> phase <span class="hljs-string">'semantic analysis'</span> <span class="hljs-keyword">in</span> source unit <span class="hljs-string">'C:\Users\i\IdeaProjects\groovyInJdk11\src\main\java\groovy_script.groovy'</span> single letter <span class="hljs-keyword">is</span> forbidden @ line <span class="hljs-number">2</span>, column <span class="hljs-number">1.</span>
	at java.<span class="hljs-keyword">base</span>/jdk.<span class="hljs-keyword">internal</span>.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.<span class="hljs-keyword">base</span>/jdk.<span class="hljs-keyword">internal</span>.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="hljs-number">62</span>)
	at java.<span class="hljs-keyword">base</span>/jdk.<span class="hljs-keyword">internal</span>.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="hljs-number">43</span>)
	at java.<span class="hljs-keyword">base</span>/jdk.<span class="hljs-keyword">internal</span>.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.<span class="hljs-keyword">base</span>/jdk.<span class="hljs-keyword">internal</span>.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="hljs-number">62</span>)
	at java.<span class="hljs-keyword">base</span>/jdk.<span class="hljs-keyword">internal</span>.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="hljs-number">43</span>)
	at com.intellij.rt.execution.application.AppMainV2.main(AppMainV2.java:<span class="hljs-number">131</span>)
Caused <span class="hljs-keyword">by</span>: org.codehaus.groovy.syntax.SyntaxException: single letter <span class="hljs-keyword">is</span> forbidden @ line <span class="hljs-number">2</span>, column <span class="hljs-number">1.</span>
	at java.<span class="hljs-keyword">base</span>/jdk.<span class="hljs-keyword">internal</span>.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.<span class="hljs-keyword">base</span>/jdk.<span class="hljs-keyword">internal</span>.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:<span class="hljs-number">62</span>)
	at java.<span class="hljs-keyword">base</span>/jdk.<span class="hljs-keyword">internal</span>.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:<span class="hljs-number">45</span>)
	at astTest.MyClassVisitor.visitMethod(MyClassVisitor.groovy:<span class="hljs-number">25</span>)
	at astTest.CodeCheck$_visit_closure1.doCall(CodeCheck.groovy:<span class="hljs-number">15</span>)
	at java.<span class="hljs-keyword">base</span>/jdk.<span class="hljs-keyword">internal</span>.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.<span class="hljs-keyword">base</span>/jdk.<span class="hljs-keyword">internal</span>.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="hljs-number">62</span>)
	at java.<span class="hljs-keyword">base</span>/jdk.<span class="hljs-keyword">internal</span>.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="hljs-number">43</span>)
	at astTest.CodeCheck.visit(CodeCheck.groovy:<span class="hljs-number">13</span>)
	...
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这是一个全局的 AST 变换，它对于项目内的所有 Groovy 代码全部生效。</p>
<h2 data-id="heading-6">8.3 基于 AST 全局变换的方法拦截</h2>
<p>下面是另一个全局 AST 变换的演示，还是直接从例子开始讲起。有这样一段 Groovy 脚本，脚本内有一处 <code>CheckingAccountUsing</code> 的类定义：</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">class CheckingAccountUsing {
    def audit(int amount){println "audit..."}
    // 希望当执行的金额 &gt;10000 时，进行 audit 审计。
    def deposit(int amount){println "deposit \$$amount."}
    def withdraw(int amount){println "withdraw \$$amount."}
}

def account = new CheckingAccountUsing()
// 取出一万零一块钱。
account.withdraw(10001)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>我们希望 <code>CheckingAccountUsing</code> 内定义的任何方法 ( 除了 <code>audit</code> 方法本身 ) 当检测到操作的金额大于 10000 时，实例能够自动调用 <code>audit</code> 方法进行审计。基于之前各种 Execute Method Around 模式，运行时方法注入等手段，实现这个目的已经不是什么难事。不过这一次，这个 AOP 的实现将交付给编译器。</p>
<p>首先另创建一个 <code>ASTTransformation</code> 的实现类，然后进入到 <code>visit</code> 方法内实现我们的思路。第一步，从源单元 <code>sourceUnit</code> 中定位到脚本内定义的 <code>CheckingAccountUsing</code> 类，然后从它的 Methods 节点中翻找出所有除了 <code>auduit</code> 以外的方法节点 MethodNode 。注意，如果不小心对 <code>audit</code> 方法节点注入了 <code>audit</code> 方法，这会无意中设置一个无限循环的程序陷阱。</p>
<p>注入的详细步骤被封装成了 <code>injectMethodWithAudit</code> 方法，见下文。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">def targetClass = sourceUnit.getAST().classes.find {
    // 找出想要变换的类
    it.name == "astTest.CheckingAccountUsing"
}
def nonAuditMethods = targetClass?.methods?.findAll {
    // 找出想要变换的方法
    it.name != "audit"
}
nonAuditMethods?.each { injectMethodWithAudit(it) }
<span class="copy-code-btn">复制代码</span></code></pre>
<p>现在进入到了待实现的 <code>injectMethodWithAudit</code> 方法内部。后面的思路是，我们需要在每个 MethodNode 的 BlockStatement 节点内部，安插一段这样的逻辑：</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">// amount 来自于 deposit 或者是 withdraw 方法的参数。
if(amount&gt;10000){
    audit(amount)
}else{
    println("no need to audit")
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这段语句的 AST 树该如何表示呢？人工分析一定会比较麻烦，尤其是对于初学 AST 的开发者而言。一个投机的办法就是 —— 将这段代码直接复制到 Groovy Console 内，然后 "照葫芦画瓢"。</p>
<p><img src="./Groovy AST 之旅 - 掘金_files/140bec8de10b470c9fa78156b52c678e_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.awebp" alt="if 语句块对应的 AST" loading="lazy" class="medium-zoom-image"></p>
<p>将这个结构稍微整理一下，给出伪代码结构。</p>
<pre><code class="hljs language-scss copyable" lang="scss"><span class="hljs-built_in">IfStatement</span>(
	BooleanStatement(BinaryStatement(Variable(amount),<span class="hljs-built_in">Token</span>("&gt;"),<span class="hljs-built_in">Constant</span>(<span class="hljs-number">10000</span>)))，
	<span class="hljs-comment">// 表示条件为 true</span>
	<span class="hljs-built_in">ExpressionStatement</span>(
		MethodCallStatement(
			'this','audit',Variable('amount')
		)
	)
	<span class="hljs-comment">// 表示条件为 false</span>
	<span class="hljs-built_in">ExpressionStatement</span>(
		MethodCallStatement(
			'this','print',Variable('No need to audit')
		)
	)
)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>由于 if 和 else 块内只有一行语句，因此在这里可以直接传入 ExpressionStatement。在更一般的情形中，如果块内包含了多条语句，那么就必须要选择 BlockStatement，然后将多条 ExpressionStatement 组织为链表的形式放入其中。或者，条件分支没有 else 时，那么 else 块实际上为空。此时需要选择 EmptyStatement，而不是直接传入一个 <code>null</code>。</p>
<p>这些节点都是 <code>org.codehaus.groovy.ast.*</code> 包中确切存在的类 ( 在构建的过程中，IDE 可能还会提供其他包的同名类，不要选错了 ) 。当构建好一个蓝图之后，剩下的工作就是将这段逻辑使用源代码去实现。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">// condition
def condition = new BooleanExpression(
    new BinaryExpression(
        new VariableExpression('amount'),
        // org.codehaus.groovy.syntax.Types
        // org.codehaus.groovy.syntax.Token
        // 经过实践证明，startLine 和 startColumn 的设置不会影响构建 AST，在此处全部设置为 -1.
        Token.newSymbol(Types.COMPARE_GREATER_THAN, -1, -1),
        new ConstantExpression(10000, true)
    )
)

// 构造 this.audit(amount)
def ifBlock = new ExpressionStatement(
    new MethodCallExpression(
        new VariableExpression('this'),
        'audit',
        new ArgumentListExpression(
            new VariableExpression('amount')
        )
    )
)

// 没有 else 块则使用 EmptyStatement() 代替。
// def elseBlock = new EmptyStatement()
// this.println("No need to audit")
def elseBlock = new ExpressionStatement(
    new MethodCallExpression(
        new VariableExpression('this'),
        'println',
        new ArgumentListExpression(
            new ConstantExpression("No need to audit")
        )
    )
)

def insert = new IfStatement(condition , ifBlock, elseBlock)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>其中，二元符号 ( 这里需要一个表示大于的 <code>&gt;</code> 符号 ) 需要借助 <code>org.codehaus.groovy.syntax</code> 包下的 <code>Types</code> 和 <code>Token</code> 类创建。如果需要其它表达符号，可以进入到源代码内进行查看。</p>
<p>初次尝试 AST 语法变换是比较困难的事情，但是 IntelliJ IDE 给出的代码提示也足够用了。在创建各个 XXXStatement 实例时，可以多加留意每个 Statement 的创建需要哪些内容。最终的 <code>insert</code> 代表了我们想要插入的那段 <code>if</code> 语句块。最后的工作则是将它插入到原方法节点的 BlockStatement 内部。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">((BlockStatement)methodNode.code).statements.add(0, insert)
// 更偷懒的写法是:
// methodNode.code.statements.add(0,insert)，不过 IDE 无法对此给出代码提示。
<span class="copy-code-btn">复制代码</span></code></pre>
<p><code>.statements</code> 实际上获得的是一组存储方法原语句块的 <code>List&lt;Statement&gt;</code> 链表，我们后文总是通过修改它来实现编译时方法注入或变换。这里将 <code>insert</code> 语句块头插入到原语句块，以此实现一个前置通知。反之，实现的则是后置通知。</p>
<p>最后，不要忘记到 <code>META-INF/services/org.codehaus.groovy.transform.ASTTransforamtion</code> 那里注册这个 AST 变换。当然，这个演示有明显的不合理之处：这个全局变换实际上只应用在了特定类 <code>CheckAccountUsing</code> 上，我们应用全局变换后还得特地花些功夫重新将它从源单元 <code>sourceUnit</code> 挑出来，颇有买椟还珠之嫌。在后文会介绍如何结合<strong>注解实现一个局部 AST 变换</strong>。</p>
<p>从这个例子可以看出来，手动实现 AST 转换其实并非一件易事，编译时元编程明显要比运行时元编程要来的复杂。然而，它为用户提供带来的便捷可以说是一劳永逸的。</p>
<h2 data-id="heading-7">8.4 编译期注入属性</h2>
<p>注，<code>ASTTransformation</code> 的实现者可以是任何一门 JVM 语言。如果想要增强编译器的执行效率，那么也可以使用原生的 Java 语言来实现它，或者在 Groovy Class 上加上 <code>@ComplieStatic</code> ( 但是这样就写不了动态代码了，那还不如直接使用 Java ) 。注入属性只需要两步：</p>
<ol>
<li>找到目标 ClassNode 节点，调用其提供的 <code>addField</code> 增加属性方法。</li>
<li>构造方法的名称，修饰符，类型 ( 需要 ClassHelper 类辅助构造，详细可以翻阅源代码 )，初始值 ( Expression ) 。</li>
</ol>
<pre><code class="hljs language-groovy copyable" lang="groovy">import org.codehaus.groovy.ast.ASTNode;
import org.codehaus.groovy.ast.ClassHelper;
import org.codehaus.groovy.ast.ClassNode;
import org.codehaus.groovy.ast.expr.ConstantExpression;
import org.codehaus.groovy.control.CompilePhase;
import org.codehaus.groovy.control.SourceUnit;
import org.codehaus.groovy.transform.ASTTransformation;
import org.codehaus.groovy.transform.GroovyASTTransformation;
import java.util.List;
import static groovyjarjarasm.asm.Opcodes.ACC_FINAL;
import static groovyjarjarasm.asm.Opcodes.ACC_PUBLIC;
import static groovyjarjarasm.asm.Opcodes.ACC_STATIC;

// build from YouToBe
@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)
public class CodeBuilder implements ASTTransformation {
    @Override
    public void visit(ASTNode[] astNodes, SourceUnit sourceUnit) {
        // 增加字段，相当于 public static final String AUTHOR = me;
        List&lt;ClassNode&gt; classes = sourceUnit.getAST().getClasses();
        classes.forEach(classNode -&gt; classNode.addField(
                "AUTHOR",
                ACC_PUBLIC | ACC_FINAL | ACC_STATIC,
                ClassHelper.STRING_TYPE,
                new ConstantExpression("me")
        ));
    }
}
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-8">8.5 编译期注入方法</h2>
<p>我们已经了解如何利用 AST 对已有的方法进行改造。结合编译期注入属性章节，现在不妨尝试着在编译期为目标构建一个全新的方法。这需要三个步骤：</p>
<ol>
<li>找到目标 ClassNode 节点，调用 <code>addMethod</code> 插入方法。</li>
<li>设置方法的修饰符，返回值，参数列表，异常抛出列表等。</li>
<li>准备好方法对应函数体的 AST。</li>
</ol>
<p>或者说，和编译期注入属性相比，额外的工作就是准备一个符合语义<sup><a href="https://juejin.cn/post/6970928380812197901#user-content-fn-%E6%80%8E%E6%A0%B7%E7%AE%97%E7%AC%A6%E5%90%88%E8%AF%AD%E4%B9%89%EF%BC%9F" id="user-content-user-content-fnref-%E6%80%8E%E6%A0%B7%E7%AE%97%E7%AC%A6%E5%90%88%E8%AF%AD%E4%B9%89%EF%BC%9F" data-footnote-ref="" aria-describedby="footnote-label" title="#user-content-fn-%E6%80%8E%E6%A0%B7%E7%AE%97%E7%AC%A6%E5%90%88%E8%AF%AD%E4%B9%89%EF%BC%9F">3</a></sup>的 AST 以及方法的其它信息一起传入到 <code>addMethod</code> 方法内。</p>
<p>这个例子演示了如何为所有类注入一个 <code>getAuthor</code> 方法：</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">import groovyjarjarasm.asm.Opcodes
import org.codehaus.groovy.ast.ASTNode
import org.codehaus.groovy.ast.ClassHelper
import org.codehaus.groovy.ast.ClassNode
import org.codehaus.groovy.ast.Parameter
import org.codehaus.groovy.ast.expr.ConstantExpression
import org.codehaus.groovy.ast.stmt.BlockStatement
import org.codehaus.groovy.ast.stmt.ExpressionStatement
import org.codehaus.groovy.ast.stmt.ReturnStatement
import org.codehaus.groovy.control.CompilePhase
import org.codehaus.groovy.control.SourceUnit
import org.codehaus.groovy.transform.ASTTransformation
import org.codehaus.groovy.transform.GroovyASTTransformation

@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)
class getMethodInserter implements ASTTransformation{
    @Override
    void visit(ASTNode[] nodes, SourceUnit source) {

        // 为编译期注入的方法准备语句块部分
        BlockStatement code = new BlockStatement()

        /*
        *  { return "author:me" }
        */
        def returnString = new ReturnStatement(
            new ExpressionStatement(
                    new ConstantExpression("author:me")
            )
        )

        // 将语句插入到语句块内
        code.addStatement(returnString)

        // 向各个 ClassNode 注入一个新的 Method 节点。
        source.getAST().classes.each {
            classNode -&gt; classNode.addMethod(
                    // 表示注入的方法名称
                    "getAuthor",
                    // 修饰符
                    Opcodes.ACC_PUBLIC,
                    // 表示返回值类型。
                    ClassHelper.STRING_TYPE,
                    // 表示不接受参数
                    Parameter.EMPTY_ARRAY,
                    // 表示不抛出异常
                    ClassNode.EMPTY_ARRAY,
                    code
            )
        }
    }
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>将它注册到 SPI 之后，任何一个类都可以在不改动源代码的情况下直接获得 <code>getAuthor</code> ：</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">println new Foo().getAuthor()
<span class="copy-code-btn">复制代码</span></code></pre>
<p>当然，根据 Groovy 的统一访问原则，对于 <code>getXXX</code> 方法可以直接作为一个属性访问：</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">println new Foo().author
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-9">8.6 基于注解的局部变换</h2>
<blockquote>
<p>本章需要对 Java 注解的创建有一个基本认识，具体可查阅笔者的 <a href="https://juejin.cn/post/6844904164988813325#heading-6" target="_blank" title="https://juejin.cn/post/6844904164988813325#heading-6">简单回顾Java注解 (juejin.cn)</a> 。</p>
</blockquote>
<p>到目前为止，所有的案例全都是全局的 AST 变换。如果这个 AST 并不是通用的，那么它最好是局部变换而非全局变换。</p>
<p>一个好的解决方案是将一个 AST 变换和一个标记型注解关联起来 ( 后文为了方便叙述，称这样的注解为 trigger 注解 )。这样，编译器如果在解析类的过程中发现了这些注解，那么就能够根据线索对标记类进行指定的 AST 变换，而被未标记的类则不会受到任何影响。和全局 AST 变换的另一个显著区别是：<strong>局部变换不需要注册到 SPI 接口</strong>，<strong>如果不小心这么做了，那么程序反而会报错</strong>。</p>
<p>现在创建一个 <code>Messenger</code> 注解，并为它赋予这样的功能：一旦类的定义被该注解标记，那么编译期这个类就会新增一个 <code>message</code> 方法。该方法接收一个字符串，并将它输出到控制台。同时，<code>Messenger</code> 注解有一个 <code>boolean</code> 类型的选项：<code>shout</code>。如果该值为 <code>true</code>，那么 <code>message</code> 方法在输出到控制台之前，会将字符串内的英文全部转换为大写形式，否则，不采取任何额外操作。</p>
<p>一个 Java 注解至少需要两个元注解 <code>@Retention</code> 和 <code>@Target</code>。除此之外，这里需要额外标记一个元注解 <code>GroovyASTTransformClass</code> 去关联指定的 AST 变换。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">// 这个注解仅在编译期用于生成方法，因此生命周期保持到源码级别即可。
@Retention(RetentionPolicy.SOURCE)
// 指定这是个标记在类上面的注解。
@Target(ElementType.TYPE)
// 将该注解和指定的 AST 变换关联起来。
@GroovyASTTransformationClass(classes = MessageAdderAstTransformation.class)
public @interface Messenger {
    boolean shout() default false;
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>下一步便是实现这个 <code>MessageAdderAstTransformation</code> 。再次提醒，在局部变换中，这个 AST 变换不需要注册到 SPI 接口。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">import groovyjarjarasm.asm.Opcodes;
import org.codehaus.groovy.ast.*;
import org.codehaus.groovy.ast.expr.*;
import org.codehaus.groovy.ast.stmt.ExpressionStatement;
import org.codehaus.groovy.control.CompilePhase;
import org.codehaus.groovy.control.SourceUnit;
import org.codehaus.groovy.transform.AbstractASTTransformation;
import org.codehaus.groovy.transform.GroovyASTTransformation;

@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)
public class MessageAdderAstTransformation extends AbstractASTTransformation {
    @Override
    public void visit(ASTNode[] astNodes, SourceUnit sourceUnit) {
        /*
        `nodes` - The ASTnodes when the call was triggered.
        Element 0 is the AnnotationNode that triggered this annotation to be activated.
        Element 1 is the AnnotatedNode decorated, such as a MethodNode or ClassNode.
        For global transformations it is usually safe to ignore this parameter.
         */
        // 这里的类型来自 org.codehaus.groovy.ast.* .
        AnnotationNode msgAnnotation = (AnnotationNode) astNodes[0];
        
        // 从注解中获取 shout 选项的值并设定为常量 (因为是编译期就设定好的值)。
        // 它将决定 message 如何操作。
        ConstantExpression shout = (ConstantExpression) msgAnnotation.getMember("shout");
        ClassNode annotatedClass = (ClassNode) astNodes[1];
		
        //TODO 
    }
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在以往全局变换的例子中，我们总是从源单元 <code>sourceUnit</code> 获取源码的 AST 树。但在局部变换中，使用第一个参数更合适一些。<code>astNodes</code> 参数只有固定的两个元素，下面是 Groovy Doc 的提供的解释：</p>
<ol>
<li><code>astNodes[0]</code> 代表了能够引发 AST 变换的 trigger 注解，可以从该元素中提取 trigger 注解内部的信息。</li>
<li><code>astNodes[1]</code> 代表了被 trigger 注解标记的 ClassNode，可以从该元素中提取出被 trigger 注解标记的类的 AST 树并施加变换。</li>
</ol>
<p>显然，每一个局部 AST 变换只会和一个 trigger 注解关联，这是 <code>@GroovyASTTransformationClass</code> 元注解里定义的。这里为了方便操作，将 <code>astNodes[0]</code> 强制转换为 AnnotationNode，将 <code>astNodes[1]</code> 强制转换成 ClassNode。</p>
<p>剩下的步骤大概都比较明确了：那就是分析下面这段程序的 AST。类似的套路，如果觉得手动分析内部 AST 太过麻烦，可以直接使用 GroovyConsole 工具进行生成。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">// 标识符: ACC_PUBlIC,
// 返回值: ClassHelper.VOID_TYPE
// 参数: [Parameter(ClassHelper.STRING_TYPE,"message")]
// 抛出异常: ClassNode.EMPTY_ARRAY ( 表示不抛出异常 )
// 语法块: {this.println(shout?message.toUpperCase:message)}
public void message(String message){
    // shout 是一个 boolean 值，源自于 Messengers 注解。
    this.println(shout?message.toUpperCase:message)
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>完整的代码如下：</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">package astTest.javaImpl;

import groovyjarjarasm.asm.Opcodes;
import org.codehaus.groovy.ast.*;
import org.codehaus.groovy.ast.expr.*;
import org.codehaus.groovy.ast.stmt.ExpressionStatement;
import org.codehaus.groovy.control.CompilePhase;
import org.codehaus.groovy.control.SourceUnit;
import org.codehaus.groovy.transform.AbstractASTTransformation;
import org.codehaus.groovy.transform.GroovyASTTransformation;

@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)
public class MessageAdderAstTransformation extends AbstractASTTransformation {
    @Override
    public void visit(ASTNode[] astNodes, SourceUnit sourceUnit) {
        /*
        `nodes` - The ASTnodes when the call was triggered.
        Element 0 is the AnnotationNode that triggered this annotation to be activated.
        Element 1 is the AnnotatedNode decorated, such as a MethodNode or ClassNode.
        For global transformations it is usually safe to ignore this parameter.
         */
        // 这里的类型来自 org.codehaus.groovy.ast.* .
        AnnotationNode msgAnnotation = (AnnotationNode) astNodes[0];
        ConstantExpression shout = (ConstantExpression) msgAnnotation.getMember("shout");
        ClassNode annotatedClass = (ClassNode) astNodes[1];

        // 这个局部变量 message 和构造的函数体的 message 变量相对应。
        VariableExpression message = new VariableExpression("message");
        MethodCallExpression toUpperCaseCall = new MethodCallExpression(message, "toUpperCase", ArgumentListExpression.EMPTY_ARGUMENTS);

        // 构造了一个这样的一条语句 statement：
        // this.println(shout?message.toUpperCase:message)
        ExpressionStatement code = new ExpressionStatement(
                new MethodCallExpression(new VariableExpression("this"),
                        "println",
                        new TernaryExpression(new BooleanExpression(shout), toUpperCaseCall, message))
        );


        // 创建 message
        annotatedClass.addMethod("message",
                Opcodes.ACC_PUBLIC,
                ClassHelper.VOID_TYPE,
                new Parameter[]{
                        // 参数 message 和局部变量的 message 相对应。
                        new Parameter(ClassHelper.STRING_TYPE,"message")
                },
                // 指代不抛出任何异常
                ClassNode.EMPTY_ARRAY,
                code
                );

        /*
         最终相当于构造了这样的函数：
         public void message(String message){
            // shout 是一个 boolean 值，源自于 Messengers 注解。
            this.println(shout?message.toUpperCase:message)
         }
         */
    }
}
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-10">8.7 AST 杀手锏：AstBuilder</h2>
<p><strong>注意，一但使用 AstBuilder，那么 AST 变换就必须选择 Groovy 语言进行实现</strong>。</p>
<p>AstBuilder 提供了三种风格的 AST 辅助转换：<code>nuildFromSpec</code>，<code>buildFromString</code>，<code>buildFromCode</code>。我们将在一个例子中对这三种 AST 构建方式做出对比：</p>
<p>创建一个局部 AST 变换，使得所有被名为 <code>@InjectAOP</code> 的 trigger 注解标记的类，它内部所有其它方法块内部会被注入一条调用自身 <code>before</code> 方法的语句。为了确保目标类实现了 <code>before</code> 方法，这里可以使用接口做一些强制性约束。</p>
<p>给出 trigger 注解的实现：</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">package astBuilderTest
import org.codehaus.groovy.transform.GroovyASTTransformationClass;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;
@Retention(RetentionPolicy.SOURCE)
@Target(ElementType.TYPE)
@GroovyASTTransformationClass(classes = InjectAopASTTransformation.class)
public @interface InjectAOP {}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>给出目标脚本的实现：</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">package astBuilderTest

@InjectAOP
class Foo implements AOP{
    @Override
    void before() {println("这段逻辑会被注入到其它方法")} // 通过接口强制令该类实现 before 方法。
    void run(){println("测试的方法")}
}

// 目标:执行此脚本，控制台应当输出：
// 这段逻辑会被注入到其它方法
// 测试的方法
new Foo().run()
<span class="copy-code-btn">复制代码</span></code></pre>
<p>核心目标是 <code>InjectAopASTTransformation</code> 的实现。首先给出传统实现：</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">package astBuilderTest
import org.codehaus.groovy.ast.ASTNode
import org.codehaus.groovy.ast.ClassNode
import org.codehaus.groovy.ast.expr.ArgumentListExpression
import org.codehaus.groovy.ast.expr.MethodCallExpression
import org.codehaus.groovy.ast.expr.VariableExpression
import org.codehaus.groovy.ast.stmt.BlockStatement
import org.codehaus.groovy.ast.stmt.ExpressionStatement
import org.codehaus.groovy.control.CompilePhase
import org.codehaus.groovy.control.SourceUnit
import org.codehaus.groovy.transform.ASTTransformation
import org.codehaus.groovy.transform.GroovyASTTransformation

@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)
class InjectAopASTTransformation implements ASTTransformation {
    @Override
    void visit(ASTNode[] nodes, SourceUnit source) {
        def classNode = nodes[1] as ClassNode

        // 确保它实现了 AOP 接口。
        // 在 AST 内部，所有信息全部是 ASTNode 形式，因此需要将等待判断的 AOP 接口类型转换为 ClassNode 并比较。
        // 这和一般的判别方式有所不同。
        def c = new ClassNode(AOP.class)
        println classNode.interfaces.contains(c)

        // 找出所有其它方法
        def methods = classNode.methods.findAll {
            it.name != "before"
        }

        // -------------AstBuilder 主要负责重构的部分------------------//
        def beforeCall = new ExpressionStatement(
                new MethodCallExpression(
                        new VariableExpression('this'),
                        'before',
                        ArgumentListExpression.EMPTY_ARGUMENTS
                )
        )

        methods.each {
            ((BlockStatement) it.code).statements.add(0, beforeCall)
        }
        // ---------------------------------------------------------//

    }
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>第一种：<code>buildFromSpec</code>。它本质上是创建了一个内部 DSL，使我们在创建各种 ASTNode 的过程中免去了频繁的 <code>new</code> 关键字声明。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">package astBuilderTest
import org.codehaus.groovy.ast.ASTNode
import org.codehaus.groovy.ast.ClassNode
import org.codehaus.groovy.ast.builder.AstBuilder
import org.codehaus.groovy.ast.stmt.BlockStatement
import org.codehaus.groovy.ast.stmt.Statement
import org.codehaus.groovy.control.CompilePhase
import org.codehaus.groovy.control.SourceUnit
import org.codehaus.groovy.transform.ASTTransformation
import org.codehaus.groovy.transform.GroovyASTTransformation

@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)
class InjectAopASTTransformation implements ASTTransformation {
    @Override
    void visit(ASTNode[] nodes, SourceUnit source) {
        def classNode = nodes[1] as ClassNode

        // 确保它实现了 AOP 接口。
        // 在 AST 内部，所有信息全部是 ASTNode 形式，因此需要将等待判断的 AOP 接口类型转换为 ClassNode 并比较。
        // 这和一般的判别方式有所不同。
        def c = new ClassNode(AOP.class)
        assert classNode.interfaces.contains(c)

        // 找出所有其它方法
        def methods = classNode.methods.findAll {
            it.name != "before"
        }

        // -------------AstBuilder 主要负责重构的部分------------------//
        def beforeCall = new AstBuilder().buildFromSpec {
            // ExpressionStatement
            expression {
                methodCall {
                    variable 'this'
                    constant 'before'
                    argumentList {}
                }
            }
        } as List&lt;Statement&gt;

        methods.each {
            ((BlockStatement) it.code).statements.add(0, beforeCall[0])
        }
        // ---------------------------------------------------------//

    }
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>其 DSL 的构建方式只是在写法上减少了一点构建 AST 的负担，但是仍然要求我们熟练掌握 Groovy 提供的各种 AST 节点及其构建方式。对于不熟悉 <code>org.codehaus.groovy.ast</code> 包下各种类型的开发者而言，构建 AST 仍然是一个繁琐且困难的工作。</p>
<p>假如有这样一个工具，能够允许我们按照日常的习惯编写源代码，然后由它自动转换为 AST 树就好了 ( 这样的话，我们甚至都不用深入了解 AST 树了! )。AstBuilder 正好解决了这个痛点。下面介绍 AstBuilder 第二种使用方式：<code>buildFromCode</code>。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">package astBuilderTest
import org.codehaus.groovy.ast.ASTNode
import org.codehaus.groovy.ast.ClassNode
import org.codehaus.groovy.ast.builder.AstBuilder
import org.codehaus.groovy.ast.stmt.BlockStatement
import org.codehaus.groovy.ast.stmt.Statement
import org.codehaus.groovy.control.CompilePhase
import org.codehaus.groovy.control.SourceUnit
import org.codehaus.groovy.transform.ASTTransformation
import org.codehaus.groovy.transform.GroovyASTTransformation

@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)
class InjectAopASTTransformation implements ASTTransformation {
    @Override
    void visit(ASTNode[] nodes, SourceUnit source) {
        def classNode = nodes[1] as ClassNode

        // 确保它实现了 AOP 接口。
        // 在 AST 内部，所有信息全部是 ASTNode 形式，因此需要将判断的 AOP 接口类型装入到 ClassNode 并比较。
        // 这和一般的判别方式有所不同。
        def c = new ClassNode(AOP.class)
        assert classNode.interfaces.contains(c)

        // 找出所有其它方法
        def methods = classNode.methods.findAll {
            it.name != "before"
        }

        // -------------AstBuilder 主要负责重构的部分------------------//
        // AstBuilder 独立于 InjectAopASTTransformation 进行编译。
        def beforeCall = new AstBuilder().buildFromCode(CompilePhase.SEMANTIC_ANALYSIS){
            this.before()
        } as List&lt;Statement&gt;
        
        methods.each {
            // ((BlockStatement) it.code).statements.addAll(0,beforeCall)
            ((BlockStatement) it.code).statements.add(0,beforeCall[0])
        }
       // ---------------------------------------------------------//
    }
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这里有很多细节需要说明。如我们所见，<code>buildFromCode</code> 方法的闭包内允许直接放入一段代码块，我们不再需要在各种复杂的 AST 结构当中挣扎。除此之外，该方法还指明 AstBuilder 在某个阶段 ( 此处是 <code>CompilePhase.SEMANTIC_ANALYSIS</code> ) <strong>将闭包的内代码转为等价的 AST</strong> ( 笔者推测 AstBuilder 的 AST 变换过程和 <code>InjectAopASTTransformation</code> 的 AST 变换是分开且独立的，但是 Groovy Doc 给出的解释令我云里雾里，网上也没有足够资料 ) 。</p>
<p>实际上，<code>buildFromCode</code> 返回的是一个抽象的 <code>List&lt;ASTNode&gt;</code> 类型。为了便于操作，这里通过 <code>as</code> 符号将其转换为了 <code>List&lt;Statement&gt;</code> 类型 。 注，<code>as</code> 操作符依赖调用者的 <code>asType</code> 方法，和强制转换的概念有区别。无论我们在 <code>buildFromCode</code> 内创建了多少语句块，它们最终总是被包装为一个 BlockStatement，然后再装入到一个 List 内部。</p>
<p>换句话说，通过访问 <code>beforeCall[0]</code> 就可以获取到 AstBuilder 为我们转换好的 AST 了。注意，一旦进入到 <code>buildFromCode</code> ( 还有后文的 <code>buildFromString</code> ) 方法的闭包内部，<strong>IntelliJ IDE 就无法再为我们提供有效的代码提示</strong>，甚至有时还会出现 "误导" 的情况。比如：上述代码块内的 <code>this</code> 可不是指代这个 AST 变换类本身，而是指代上下文中被注入的那个对象 "that"，调用的是 "that" 的 <code>before</code> 方法。</p>
<p>第三种，<code>buildFromString</code>。这种方式和 <code>buildFromCode</code> 非常接近，只不过 AstBuilder 这一次转化的目标是 <code>String</code> 类型。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">package astBuilderTest
import org.codehaus.groovy.ast.ASTNode
import org.codehaus.groovy.ast.ClassNode
import org.codehaus.groovy.ast.builder.AstBuilder
import org.codehaus.groovy.ast.stmt.BlockStatement
import org.codehaus.groovy.ast.stmt.Statement
import org.codehaus.groovy.control.CompilePhase
import org.codehaus.groovy.control.SourceUnit
import org.codehaus.groovy.transform.ASTTransformation
import org.codehaus.groovy.transform.GroovyASTTransformation

@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)
class InjectAopASTTransformation implements ASTTransformation {
    @Override
    void visit(ASTNode[] nodes, SourceUnit source) {
        def classNode = nodes[1] as ClassNode

        // 确保它实现了 AOP 接口。
        // 在 AST 内部，所有信息全部是 ASTNode 形式，因此需要将等待判断的 AOP 接口类型转换为 ClassNode 并比较。
        // 这和一般的判别方式有所不同。
        def c = new ClassNode(AOP.class)
        assert classNode.interfaces.contains(c)

        // 找出所有其它方法
        def methods = classNode.methods.findAll {
            it.name != "before"
        }

        // -------------AstBuilder 主要负责重构的部分------------------//
        // AstBuilder 独立于 InjectAopASTTransformation 进行编译。
        def info = "println \"this source build by AstBuilder\" "
        def beforeCall = new AstBuilder().buildFromString(CompilePhase.SEMANTIC_ANALYSIS,"""
            this.before()
            ${info}
        """) as List&lt;Statement&gt;
        
        methods.each {
            ((BlockStatement) it.code).statements.add(0,beforeCall[0])
        }
        // -------------等待 AstBuilder 重构的部分------------------//
    }
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>和 <code>buildFromCode</code> 相比，它的优势是允许我们能够像拼凑 GString 一样自由地组合源代码 ( 并且不再需要关心它的 AST 结构，因为 AstBuilder 会替我们搞定 )，而缺点则是可能会遇到一些字符串转义的烦恼。</p>
<h2 data-id="heading-11">8.8 补充：部分 AST 节点表示为 “空” 的方式</h2>
<p>如果要构造一个空语句块，则需要创建 EmptyStatement 实例。</p>
<p>当构造 MethodCallExpression 时，如果遇到空括号方法的调用，那么参数列表应表示为 <code>ArgumentListExpression.EMPTY_ARGUMENTS</code>。</p>
<p>当进行编译期方法构造 ( 对某个 ClassNode 调用 <code>addMethod</code> 方法 ) 时，如果此方法是空括号方法，那么参数列表应表示为 <code>Parameter.EMPTY_ARRAY</code>。如果此方法不抛出任何异常，那么应表示为 <code>ClassNode.EMPTY_ARRAY</code>。如果该方法不返回值，应表示为 <code>ClassHelper.VOID_TYPE</code>。</p>
<p>在构造方法返回值类型，或是属性类型时，使用 Groovy 提供 ClassHelper 去完成。</p>
<h2 id="user-content-footnote-label" class="sr-only" data-id="heading-12">Footnotes</h2>
<ol>
<li id="user-content-user-content-fn-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AFsystem.out%EF%BC%9F">
<p>Groovy 给所有的 GroovyObject 都绑定了 print 方法，因此调用者自然就是 this 。 <a href="https://juejin.cn/post/6970928380812197901#user-content-fnref-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AFsystem.out%EF%BC%9F" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content" title="#user-content-fnref-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AFsystem.out%EF%BC%9F">↩</a></p>
</li>
<li id="user-content-user-content-fn-%E5%91%B3%E9%81%93%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F">
<p>常见的代码异味包括 Duplicated Code，Long Method，Switch Statement，以及其它可以想到的不良代码，详情可见<a href="https://link.juejin.cn/?target=http%3A%2F%2Fwww.nowamagic.net%2Flibrarys%2Fveda%2Fdetail%2F2053" target="_blank" rel="nofollow noopener noreferrer" title="http://www.nowamagic.net/librarys/veda/detail/2053" ref="nofollow noopener noreferrer">一些常见的代码异味 Code Smell -- 简明现代魔法 (nowamagic.net)</a>。 <a href="https://juejin.cn/post/6970928380812197901#user-content-fnref-%E5%91%B3%E9%81%93%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content" title="#user-content-fnref-%E5%91%B3%E9%81%93%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F">↩</a></p>
</li>
<li id="user-content-user-content-fn-%E6%80%8E%E6%A0%B7%E7%AE%97%E7%AC%A6%E5%90%88%E8%AF%AD%E4%B9%89%EF%BC%9F">
<p>比如插入方法时设定返回值为 <code>String</code>，那么该方法的 BlockStatement 的最后一个元素应当是返回字符串类型的 ReturnStatement。 <a href="https://juejin.cn/post/6970928380812197901#user-content-fnref-%E6%80%8E%E6%A0%B7%E7%AE%97%E7%AC%A6%E5%90%88%E8%AF%AD%E4%B9%89%EF%BC%9F" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content" title="#user-content-fnref-%E6%80%8E%E6%A0%B7%E7%AE%97%E7%AC%A6%E5%90%88%E8%AF%AD%E4%B9%89%EF%BC%9F">↩</a></p>
</li>
</ol>
</div><style>.markdown-body pre,.markdown-body pre>code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style></div></article> <div class="article-end" data-v-4b9f9746="" data-v-020666e8=""><div class="tag-list-box" data-v-4b9f9746="" data-v-020666e8=""><div class="tag-list" data-v-4b9f9746="" data-v-020666e8=""><div class="tag-list-title" data-v-4b9f9746="" data-v-020666e8="">分类：</div> <a href="https://juejin.cn/backend" target="_blank" rel="" class="item category-item" data-v-020666e8="" data-v-4b9f9746=""><span class="tag-title" data-v-020666e8="">后端</span></a></div> <div class="tag-list" data-v-4b9f9746="" data-v-020666e8=""><div class="tag-list-title" data-v-4b9f9746="" data-v-020666e8="">标签：</div> <div class="tag-list-container" data-v-4b9f9746="" data-v-020666e8=""><a href="https://juejin.cn/tag/Groovy" target="_blank" rel="" class="item tag-item" data-v-020666e8="" data-v-4b9f9746=""><span class="tag-title" data-v-020666e8="">Groovy</span></a></div></div></div> <div data-v-8c900db2="" data-v-020666e8="" class="column-container"><div data-v-8c900db2="" class="column-header"><span data-v-8c900db2="" class="column-title">文章被收录于专栏：</span></div> <div data-v-8c900db2="" class="column-content"><div data-v-79b79a50="" data-v-8c900db2="" class="item-container"><img data-v-248050e4="" data-v-79b79a50="" loading="eager" src="./Groovy AST 之旅 - 掘金_files/674d913150fa4dbcac9d0cc223160d6d_tplv-k3u1fbpfcp-no-mark_160_160_160_120.awebp" alt="cover" class="lazy"> <div data-v-79b79a50="" class="content"><div data-v-79b79a50="" class="title">
      Groovy 从入门到 MOP
    </div> <span data-v-79b79a50="" class="tooltip"><div class="byte-tooltip byte-tooltip--dark" style="display: none;">
        从基础开始，逐步了解这门运作在 JVM 之上的动态语言，并且尝试着利用动态特性进行元编程，或者是设计内部 DSL 。
      </div><span class="byte-tooltip__wrapper"><span data-v-79b79a50="" class="description">
        从基础开始，逐步了解这门运作在 JVM 之上的动态语言，并且尝试着利用动态特性进行元编程，或者是设计内部 DSL 。
      </span></span></span></div> <!----> <!----> <button data-v-05e27314="" data-v-79b79a50="" class="ui-btn btn follow-btn primary mini default attention"><!----> 
    关注专栏
  </button></div></div></div> <div data-fetch-key="1" class="extension-banner" data-v-bf9647a6="" data-v-020666e8="" data-v-4b9f9746=""><span class="banner-icon" data-v-bf9647a6=""></span> <div class="banner-wrapper" data-v-bf9647a6=""><a class="banner-title" data-v-bf9647a6="" href="https://juejin.cn/extension/?utm_source=standalone&amp;utm_medium=post&amp;utm_campaign=extension_promotion" target="_blank">
      安装掘金浏览器插件
    </a> <div class="banner-content" data-v-bf9647a6="">多内容聚合浏览、多引擎快捷搜索、多工具便捷提效、多模式随心畅享，你想要的，这里都有！</div></div> <a class="banner-action" data-v-bf9647a6="" href="https://juejin.cn/extension/?utm_source=standalone&amp;utm_medium=post&amp;utm_campaign=extension_promotion" target="_blank">前往安装</a></div></div> <div data-v-9bc035e6="" data-v-020666e8="" class="wrap category-course-recommend"><div data-v-9bc035e6="" class="title">相关课程</div> <div data-v-9bc035e6="" class="list"><div data-v-7a387154="" data-v-9bc035e6="" data-booklet-id="6944917557878980638" class="book-card-wrap"><div data-v-077cd020="" data-v-7a387154="" class="book-thumb book-card-cover"><img data-v-248050e4="" data-v-077cd020="" src="./Groovy AST 之旅 - 掘金_files/3fb5f24fe8f046369ded3514c7cdc7c1_tplv-k3u1fbpfcp-no-mark_420_420_300_420.awebp" alt="「玩转 MyBatis：深度解析与定制」封面" class="lazy book-thumb-img" loading="lazy" style=""> <!----></div> <div data-v-7a387154="" class="book-card-info"><div data-v-7a387154="" class="book-card-top"><div data-v-7a387154="" title="玩转 MyBatis：深度解析与定制" class="book-card-title"><div data-v-7a387154="" class="book-card-vip">VIP</div> <span data-v-7a387154="" class="book-card-title-text">玩转 MyBatis：深度解析与定制</span></div> <div data-v-7a387154="" class="book-card-content"><a data-v-0ef8bafa="" data-v-7a387154="" href="https://juejin.cn/user/3808363977640301" target="_blank" rel="" class="username author-name"><span data-v-0ef8bafa="" class="name" style="max-width: 128px;">
      LinkedBear
    </span> <span data-v-3de16c56="" data-v-0ef8bafa="" blank="true" class="rank"><img data-v-3de16c56="" src="./Groovy AST 之旅 - 掘金_files/lv-3.7938ebc.png" alt="lv-3" title="创作等级"></span> <!----> <!----> </a> <div data-v-7a387154="" class="book-card-count">
          1704购买
        </div></div></div> <div data-v-7a387154="" class="book-card-price-wrap"><div data-v-7a387154="" class="book-card-price">
        ¥24.95
      </div> <div data-v-7a387154="" class="book-card-sale">
        ¥49.9
      </div> <div data-v-7a387154="" class="sale-tooltip-entry-box"><div data-v-6a0ef028="" data-v-7a387154="" class="sale-tooltip-wrap sale-tooltip-entry"><!----> <div data-v-6a0ef028="" class="sale-tooltip">
    首单券后价
    <!----> <div data-v-6a0ef028="" class="sale-tooltip-content">
      首单券后价
      <!----></div></div> <!----></div></div></div></div></div><div data-v-7a387154="" data-v-9bc035e6="" data-booklet-id="6844733769996304392" class="book-card-wrap"><div data-v-077cd020="" data-v-7a387154="" class="book-thumb book-card-cover"><img data-v-248050e4="" data-v-077cd020="" src="./Groovy AST 之旅 - 掘金_files/172d144898de3145_tplv-t2oaga2asx-no-mark_420_420_300_420.awebp" alt="「MySQL 是怎样运行的：从根儿上理解 MySQL」封面" class="lazy book-thumb-img" loading="lazy" style=""> <!----></div> <div data-v-7a387154="" class="book-card-info"><div data-v-7a387154="" class="book-card-top"><div data-v-7a387154="" title="MySQL 是怎样运行的：从根儿上理解 MySQL" class="book-card-title"><div data-v-7a387154="" class="book-card-vip">VIP</div> <span data-v-7a387154="" class="book-card-title-text">MySQL 是怎样运行的：从根儿上理解 MySQL</span></div> <div data-v-7a387154="" class="book-card-content"><a data-v-0ef8bafa="" data-v-7a387154="" href="https://juejin.cn/user/3526889001463006" target="_blank" rel="" class="username author-name"><span data-v-0ef8bafa="" class="name" style="max-width: 128px;">
      小孩子4919
    </span> <span data-v-3de16c56="" data-v-0ef8bafa="" blank="true" class="rank"><img data-v-3de16c56="" src="./Groovy AST 之旅 - 掘金_files/lv-5.d08789d.png" alt="lv-5" title="创作等级"></span> <!----> <!----> </a> <div data-v-7a387154="" class="book-card-count">
          20639购买
        </div></div></div> <div data-v-7a387154="" class="book-card-price-wrap"><div data-v-7a387154="" class="book-card-price">
        ¥14.95
      </div> <div data-v-7a387154="" class="book-card-sale">
        ¥29.9
      </div> <div data-v-7a387154="" class="sale-tooltip-entry-box"><div data-v-6a0ef028="" data-v-7a387154="" class="sale-tooltip-wrap sale-tooltip-entry"><!----> <div data-v-6a0ef028="" class="sale-tooltip">
    首单券后价
    <!----> <div data-v-6a0ef028="" class="sale-tooltip-content">
      首单券后价
      <!----></div></div> <!----></div></div></div></div></div></div></div> <!----> <div data-v-38c0fdbe="" data-v-020666e8="" data-jj-helper="comment-container" class="container comment-list-box" id="comment-box" data-v-4b9f9746=""><div data-v-48a7e3c5="" data-v-38c0fdbe="" class="comment-form"><div data-v-48a7e3c5="" class="header"><span data-v-48a7e3c5="" class="header-title">评论</span></div><div data-v-48a7e3c5="" class="content"><div data-v-48a7e3c5="" class="avatar-box"><img data-v-248050e4="" data-v-47508ed8="" data-v-48a7e3c5="" src="./Groovy AST 之旅 - 掘金_files/58aaf1326ac763d8a1054056f3b7f2ef.svg" alt="" class="lazy avatar avatar" loading="lazy"></div><div data-v-48a7e3c5="" class="form-box"><div data-v-7c7c7498="" data-v-48a7e3c5="" class="auth-card"><!----> <div data-v-48a7e3c5="" data-v-7c7c7498="" class="input-box"><div data-v-48a7e3c5="" data-v-7c7c7498="" contenteditable="true" spellcheck="false" placeholder="输入评论（Enter换行，Ctrl + Enter发送）" disabled="disabled" class="rich-input empty"></div><div data-v-48a7e3c5="" data-v-7c7c7498="" class="login-guide"><div data-v-48a7e3c5="" data-v-7c7c7498="" class="login-guide-text">看完啦，</div><div data-v-48a7e3c5="" data-v-7c7c7498="" class="login-guide-button">登录</div><div data-v-48a7e3c5="" data-v-7c7c7498="" class="login-guide-text">分享一下感受吧～</div></div><!----></div></div><div data-v-48a7e3c5="" class="action-box"><div data-v-9fe533ba="" data-v-48a7e3c5="" class="emoji-container emoji-btn" style="display: none;"><div data-v-9fe533ba="" class="emoji-box"><svg data-v-9fe533ba="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon"><path data-v-9fe533ba="" fill-rule="evenodd" clip-rule="evenodd" d="M8.00002 0.666504C12.0501 0.666504 15.3334 3.94975 15.3334 7.99984C15.3334 12.0499 12.0501 15.3332 8.00002 15.3332C3.94993 15.3332 0.666687 12.0499 0.666687 7.99984C0.666687 3.94975 3.94993 0.666504 8.00002 0.666504ZM8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2ZM10.6667 5.66667V7.66667H9.33333V5.66667H10.6667ZM6.66667 5.66667V7.66667H5.33333V5.66667H6.66667ZM10.0767 9.33333H11.0495C11.1804 9.33333 11.2866 9.43951 11.2866 9.57048C11.2866 9.60754 11.2779 9.64409 11.2612 9.67718L11.244 9.71053C10.6294 10.8739 9.40726 11.6667 7.99998 11.6667C6.61523 11.6667 5.40977 10.8991 4.7859 9.76612L4.73786 9.67593C4.67845 9.56052 4.72385 9.4188 4.83926 9.35939C4.87253 9.34226 4.90941 9.33333 4.94683 9.33333H5.92347C6.02396 9.33332 6.11908 9.37865 6.18238 9.4567C6.26207 9.55496 6.32833 9.62955 6.38117 9.68046C6.80074 10.0847 7.37133 10.3333 7.99998 10.3333C8.63289 10.3333 9.20694 10.0814 9.62728 9.67224C9.67791 9.62296 9.74135 9.55121 9.8176 9.45698C9.88089 9.37877 9.97611 9.33333 10.0767 9.33333Z"></path></svg> <span data-v-9fe533ba="">表情</span></div> <!----></div><div data-v-48a7e3c5="" class="image-btn" style="display: none;"><svg data-v-48a7e3c5="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon"><path data-v-48a7e3c5="" fill-rule="evenodd" clip-rule="evenodd" d="M14 1.3335C14.3514 1.3335 14.6394 1.60546 14.6648 1.95041L14.6666 2.00016V14.0002C14.6666 14.3516 14.3947 14.6396 14.0497 14.665L14 14.6668H1.99998C1.64853 14.6668 1.36059 14.3949 1.33514 14.0499L1.33331 14.0002V2.00016C1.33331 1.64871 1.60527 1.36077 1.95023 1.33532L1.99998 1.3335H14ZM13.3333 2.66618H2.66664V13.3328H13.3333V2.66618ZM11.9219 6.7879C11.9719 6.83791 12 6.90574 12 6.97647V11.7993C12 11.9098 11.9104 11.9993 11.8 11.9993H6.81615C6.7975 11.9993 6.77945 11.9968 6.76232 11.992L3.91042 11.9847C3.79996 11.9844 3.71063 11.8947 3.7109 11.7842C3.71102 11.7313 3.73209 11.6807 3.76948 11.6433L6.52468 8.88807C6.62882 8.78393 6.79766 8.78393 6.9018 8.88807L8.17297 10.1593L11.5447 6.7879C11.6489 6.68376 11.8177 6.68376 11.9219 6.7879ZM5.99997 3.99951V5.99951H3.99997V3.99951H5.99997Z"></path></svg><span data-v-48a7e3c5="">图片</span></div><div data-v-48a7e3c5="" class="submit" style="display: none;"><span data-v-48a7e3c5="">Ctrl + Enter</span><button data-v-48a7e3c5="" disabled="disabled" class="submit-btn">发表评论</button></div></div></div><input data-v-48a7e3c5="" type="file" class="hidden"></div></div> <!----> <!----></div> <div data-v-4fa94e66="" data-v-020666e8="" class="action-box action-bar" data-v-4b9f9746=""><div data-v-4fa94e66="" class="praise-action action"><div data-v-4fa94e66="" class="action-title-box"><img data-v-4fa94e66="" src="./Groovy AST 之旅 - 掘金_files/00ba359ecd0075e59ffbc3d810af551d.svg"> <span data-v-4fa94e66="" class="action-title">
          1
        </span></div></div> <div data-v-4fa94e66="" class="comment-action action"><div data-v-4fa94e66="" class="action-title-box"><img data-v-4fa94e66="" src="./Groovy AST 之旅 - 掘金_files/336af4d1fafabcca3b770c8ad7a50781.svg"> <span data-v-4fa94e66="" class="action-title">评论</span></div></div> <div data-v-4fa94e66="" class="collect-action action"><div data-v-4fa94e66="" class="action-title-box"><img data-v-4fa94e66="" src="./Groovy AST 之旅 - 掘金_files/3d482c7a948bac826e155953b2a28a9e.svg"> <span data-v-4fa94e66="" class="action-title">收藏</span></div></div> <!----></div></div> <div data-v-020666e8="" data-v-4b9f9746="" class="main-area recommended-area shadow"><div data-v-020666e8="" data-v-4b9f9746="" class="recommended-list-title-wrapper"><div data-v-020666e8="" data-v-4b9f9746="" class="title"><span data-v-020666e8="" data-v-4b9f9746="" class="title-content">相关推荐</span></div></div> <div data-v-3ff8f708="" data-v-2bf301c8="" data-v-020666e8="" name="entry-list" tag="div" class="entry-list list recommended-entry-list" data-v-4b9f9746=""><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="6992013495692689422" data-original-type="0" data-draft-id="6992012896817381384" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/993614243303053" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">1年前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91" target="_blank" rel="" class="tag">
        敏捷开发
      </a><a data-v-d5649b80="" href="https://juejin.cn/tag/Groovy" target="_blank" rel="" class="tag">
        Groovy
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/6992013495692689422" target="_blank" rel="" title="复杂多变场景下的Groovy脚本引擎实战" class="title">复杂多变场景下的Groovy脚本引擎实战</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/6992013495692689422" target="_blank" rel=""><div data-v-d5649b80="">互联网时代随着业务的飞速发展，不仅产品迭代、更新的速度越来越快，个性化需求也是越来越多，如：多维度（条件）的查询、业务流转规则等。通过项目实战，带大家了解Groovy在脚本引擎方面的应用。</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">1452</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            10
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            评论
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="7149082070604578824" data-original-type="0" data-draft-id="7149061897743466527" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/2506542240247943" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">1月前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/gradle" target="_blank" rel="" class="tag">
        gradle
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/7149082070604578824" target="_blank" rel="" title="Gradle迁移指南：从Groovy到KTS" class="title">Gradle迁移指南：从Groovy到KTS</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/7149082070604578824" target="_blank" rel=""><div data-v-d5649b80="">Android Gradle 插件早在 4.0 就支持在 Gradle 构建配置中使用 Kotlin 脚本 (KTS)，用于替代 Groovy，不来试试吗？</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">839</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            4
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            4
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-d5649b80="" src="./Groovy AST 之旅 - 掘金_files/cb355bd449cf49dfb2e8882c8a2061b4_tplv-k3u1fbpfcp-no-mark_240_240_240_160.awebp" alt="Gradle迁移指南：从Groovy到KTS" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="7139877924676567048" data-original-type="0" data-draft-id="7139877056598245384" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/4332528356045070" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">2月前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/%E5%90%8E%E7%AB%AF" target="_blank" rel="" class="tag">
        后端
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/7139877924676567048" target="_blank" rel="" title="SpringBoot整合Groovy脚本，实现动态编程" class="title">SpringBoot整合Groovy脚本，实现动态编程</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/7139877924676567048" target="_blank" rel=""><div data-v-d5649b80="">Groovy简介 Groovy 是增强 Java 平台的唯一的脚本语言。它提供了类似于 Java 的语法，内置映射（Map）、列表（List）、方法、类、闭包（closure）以及生成器。脚本语言不会</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">1069</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            5
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            评论
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-d5649b80="" src="./Groovy AST 之旅 - 掘金_files/c0b60880a6134ff6b56c743025a7a0df_tplv-k3u1fbpfcp-no-mark_240_240_240_160.awebp" alt="SpringBoot整合Groovy脚本，实现动态编程" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="7069550779454980104" data-original-type="0" data-draft-id="7069549381598314527" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/668101431009496" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">8月前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/Android" target="_blank" rel="" class="tag">
        Android
      </a><a data-v-d5649b80="" href="https://juejin.cn/tag/gradle" target="_blank" rel="" class="tag">
        gradle
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/7069550779454980104" target="_blank" rel="" title="相比 Groovy 脚本, KTS 性能到底怎么样？" class="title">相比 Groovy 脚本, KTS 性能到底怎么样？</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/7069550779454980104" target="_blank" rel=""><div data-v-d5649b80="">KTS在易用性，可读性，IDE支持等方面都提供了比Groovy更好的支持，但目前在性能方面稍弱，那么相比 Groovy 脚本, KTS 性能到底怎么样？</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">3353</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            21
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            10
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-d5649b80="" src="./Groovy AST 之旅 - 掘金_files/b75ea37d868b4956837279e90f1a9c8e_tplv-k3u1fbpfcp-no-mark_240_240_240_160.awebp" alt="相比 Groovy 脚本, KTS 性能到底怎么样？" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="7148456353332215838" data-original-type="0" data-draft-id="7148448574865408014" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/3421335918746109" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">1月前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/gradle" target="_blank" rel="" class="tag">
        gradle
      </a><a data-v-d5649b80="" href="https://juejin.cn/tag/Groovy" target="_blank" rel="" class="tag">
        Groovy
      </a><a data-v-d5649b80="" href="https://juejin.cn/tag/Android%20Studio" target="_blank" rel="" class="tag">
        Android Studio
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/7148456353332215838" target="_blank" rel="" title="Android 混淆规则是如何生效的？" class="title">Android 混淆规则是如何生效的？</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/7148456353332215838" target="_blank" rel=""><div data-v-d5649b80="">记录一下关于 Android 中关于混淆配置文件的生效规则、混淆规则的细节、build 产物中和混淆相关的内容及其作用。</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">1047</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            9
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            6
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-d5649b80="" src="./Groovy AST 之旅 - 掘金_files/f81848c9352049ccaf19947bb7f231c9_tplv-k3u1fbpfcp-no-mark_240_240_240_160.awebp" alt="Android 混淆规则是如何生效的？" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="7155151377013047304" data-original-type="0" data-draft-id="7122709241344819214" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/932829447855975" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">1月前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/%E5%89%8D%E7%AB%AF" target="_blank" rel="" class="tag">
        前端
      </a><a data-v-d5649b80="" href="https://juejin.cn/tag/JavaScript" target="_blank" rel="" class="tag">
        JavaScript
      </a><a data-v-d5649b80="" href="https://juejin.cn/tag/%E6%9E%B6%E6%9E%84" target="_blank" rel="" class="tag">
        架构
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/7155151377013047304" target="_blank" rel="" title="前端工程化基石 -- AST（抽象语法树）以及AST的广泛应用🔥" class="title">前端工程化基石 -- AST（抽象语法树）以及AST的广泛应用🔥</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/7155151377013047304" target="_blank" rel=""><div data-v-d5649b80="">本文将从一道小学语文题出发，由浅入深的讲述AST的设计原理以及各种衍生应用，在这过程中会手写各种好玩的插件，弄懂ESLint和代码压缩等这类基建原理，最后通过最佳实践直接助你成为基建大师。</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">4123</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            176
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            32
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-d5649b80="" src="./Groovy AST 之旅 - 掘金_files/5c94a34948d640fd90d4194c26b79b61_tplv-k3u1fbpfcp-no-mark_240_240_240_160.awebp" alt="前端工程化基石 -- AST（抽象语法树）以及AST的广泛应用🔥" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="6844903750117785607" data-original-type="0" data-draft-id="6845076098267660301" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/976022054903464" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">3年前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/Kafka" target="_blank" rel="" class="tag">
        Kafka
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/6844903750117785607" target="_blank" rel="" title="kafka之旅总览" class="title">kafka之旅总览</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/6844903750117785607" target="_blank" rel=""><div data-v-d5649b80="">初识kafka初识kafka集群初识kafka中的生产者与消费者初识kafka对消息处理与可靠性做出的保证</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">204</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            点赞
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            评论
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="6844903898231078926" data-original-type="1" data-draft-id="0" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/1714893871125175" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">3年前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/Java" target="_blank" rel="" class="tag">
        Java
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/6844903898231078926" target="_blank" rel="" title="Java与groovy混编 —— 一种兼顾接口清晰和实现敏捷的开发方式" class="title">Java与groovy混编 —— 一种兼顾接口清晰和实现敏捷的开发方式</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/6844903898231078926" target="_blank" rel=""><div data-v-d5649b80="">这意味着大多数项目都是既有程序库的拼装，标准化程度高而定制化场景少 开发工具、测试工具、问题排查工具完善，成熟 —— 基本上没有团队愿意在时间紧、任务重的项目情况下去做没有把握的、基础开发工具类的技术试探 有面向对象特性, 适合大型项目开发 —— 无数大型项目已向世人述说，“面…</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">160</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            点赞
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            评论
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="6844903965717430279" data-original-type="0" data-draft-id="6845076493819707399" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/4441682708007511" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">3年前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/%E5%91%BD%E4%BB%A4%E8%A1%8C" target="_blank" rel="" class="tag">
        命令行
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/6844903965717430279" target="_blank" rel="" title="Bash 学习的快乐之旅：3 个命令行游戏" class="title">Bash 学习的快乐之旅：3 个命令行游戏</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/6844903965717430279" target="_blank" rel=""><div data-v-d5649b80="">学习是件艰苦的工作，然而没有人喜欢工作。这意味着无论学习 Bash 多么容易，它仍然对你来说就像工作一样。当然，除非你通过游戏来学习。 你不会觉得会有很多游戏可以教你如何使用 Bash 终端吧，这是对的。严肃的 PC 游戏玩家知道，《辐射Fallout》系列在金库中配备了基于终…</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">1272</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            点赞
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            评论
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="6981266734363705374" data-original-type="0" data-draft-id="6981266110658117663" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/756900414357528" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">1年前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/Babel" target="_blank" rel="" class="tag">
        Babel
      </a><a data-v-d5649b80="" href="https://juejin.cn/tag/%E5%89%8D%E7%AB%AF" target="_blank" rel="" class="tag">
        前端
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/6981266734363705374" target="_blank" rel="" title="babel的AST实践" class="title">babel的AST实践</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/6981266734363705374" target="_blank" rel=""><div data-v-d5649b80="">说起 AST 语法，很多前端小伙伴都是不陌生，但是真正使用的却少之又少，本文简单总结一下自己学习和使用 ast 的心路历程。 首先什么是 AST 呢？ JavaScript 是一种解释类型语言，在执行</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">337</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            3
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            评论
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="7121643784638562317" data-original-type="0" data-draft-id="7121643497199042590" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/3615671881575853" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">4月前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/Android" target="_blank" rel="" class="tag">
        Android
      </a><a data-v-d5649b80="" href="https://juejin.cn/tag/Groovy" target="_blank" rel="" class="tag">
        Groovy
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/7121643784638562317" target="_blank" rel="" title="学完ASM Tree api，再也不怕hook了" class="title">学完ASM Tree api，再也不怕hook了</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/7121643784638562317" target="_blank" rel=""><div data-v-d5649b80="">背景 看完本章，你将会学习到用ASM的tree api进行对匿名线程的hook操作，同时也能够了解到asm相关的操作和背景知识介绍！</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">6128</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            77
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            28
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="6844903949883932685" data-original-type="0" data-draft-id="6845076424928264206" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/1063982987485245" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">3年前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/%E5%89%8D%E7%AB%AF" target="_blank" rel="" class="tag">
        前端
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/6844903949883932685" target="_blank" rel="" title="bizcharts的痛苦之旅（一）" class="title">bizcharts的痛苦之旅（一）</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/6844903949883932685" target="_blank" rel=""><div data-v-d5649b80="">众所周知：现在最火热的图表库就是G2以及echarts,而bizcharts是基于G2的一个react封装之后的库，使用起来比原生要方便些，但是文档分类比较简略，所以希望在官方文档的基础上把常用的整理出来。。。 .....</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">3486</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            17
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            2
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="6977539704493178893" data-original-type="0" data-draft-id="6977537053974233102" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/3359715731703080" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">1年前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a><a data-v-d5649b80="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/6977539704493178893" target="_blank" rel="" title="Swift Combine 记录" class="title">Swift Combine 记录</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/6977539704493178893" target="_blank" rel=""><div data-v-d5649b80="">Swift Combine 函数响应式编程，包含 publisher、 operator、 and subscriber</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">1633</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            1
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            1
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-d5649b80="" src="./Groovy AST 之旅 - 掘金_files/30ba3b62cc2a497481d1baf48118bd97_tplv-k3u1fbpfcp-no-mark_240_240_240_160.awebp" alt="Swift Combine 记录" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="6844903878484295694" data-original-type="0" data-draft-id="6845076359924940808" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/2137106333575309" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">3年前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1" target="_blank" rel="" class="tag">
        领域驱动设计
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/6844903878484295694" target="_blank" rel="" title="CQRS之旅——旅程5(准备发布V1版本)" class="title">CQRS之旅——旅程5(准备发布V1版本)</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/6844903878484295694" target="_blank" rel=""><div data-v-d5649b80="">本章描述了团队为准备Contoso会议管理系统的第一个产品版本所做的更改。这项工作包括对前两章介绍的订单(Order)和注册(Registrations)限界上下文的一些重构和功能添加，以及一个新的会议管理(Conference Management)限界上下文和一个新的支付(…</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">299</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            1
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            评论
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="6844903856430645256" data-original-type="0" data-draft-id="6845076325569413133" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/2137106333575309" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">3年前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/%E6%9E%B6%E6%9E%84" target="_blank" rel="" class="tag">
        架构
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/6844903856430645256" target="_blank" rel="" title="CQRS之旅——旅程2(分解领域)" class="title">CQRS之旅——旅程2(分解领域)</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/6844903856430645256" target="_blank" rel=""><div data-v-d5649b80="">在本章中，我们将对Contoso会议管理系统进行一个高层次的概述。这将帮助您理解应用程序的结构、集成点以及应用程序的各个部分之间的关系。 在这里，我们借用Eric Evans在他的书《领域驱动设计 软件核心复杂性应对之道(Addison-Wesley Professional,…</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">461</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            点赞
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            评论
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="6844903879453179912" data-original-type="0" data-draft-id="6845076361376333837" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/3685218705215832" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">3年前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/V8" target="_blank" rel="" class="tag">
        V8
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/6844903879453179912" target="_blank" rel="" title="深入V8引擎-AST(2)" class="title">深入V8引擎-AST(2)</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/6844903879453179912" target="_blank" rel=""><div data-v-d5649b80="">先声明一下，这种长系列的大块头博客只能保证尽可能的深入到每一行源码，有些代码我不乐意深究就写个注释说明一下作用。另外，由于本地整理的比较好，博客就随心写了。 整个Compile过程目前只看到asmjs之前，简单的过了几遍，大部分方法没有点进去看，实在是太复杂了。上一篇的结尾指出…</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">550</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            1
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            2
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="6844903753053650958" data-original-type="1" data-draft-id="0" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/4054654614250253" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">3年前</div> <!----></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/6844903753053650958" target="_blank" rel="" title="Gradle入门系列(二)——groovy高级语法" class="title">Gradle入门系列(二)——groovy高级语法</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/6844903753053650958" target="_blank" rel=""><div data-v-d5649b80="">groovy是完全兼容java的，所以java能使用的第三方json库（如：gson、fastjson），在groovy中也同样可以导入使用，但一般不建议这么做，groovy本身提供的工具箱就已经满足日常开发需求了。 java xml处理：DOM文档驱动处理方式、SAX事件驱动…</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">818</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            点赞
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            评论
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="6844903434034872333" data-original-type="1" data-draft-id="0" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/2207475076180173" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">6年前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a><a data-v-d5649b80="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/6844903434034872333" target="_blank" rel="" title="Swift 编程思想，第四部分：map all the things!" class="title">Swift 编程思想，第四部分：map all the things!</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/6844903434034872333" target="_blank" rel=""><div data-v-d5649b80="">在本系列之前的文章中我们学到了如何使用 map 和 flatMap 来操作数组 (arrays)。今天我们继续研究如何对可选类型(Optionals) 以及很多其他类型使用 map 和 flatMap。</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">1122</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            34
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            1
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-d5649b80="" src="./Groovy AST 之旅 - 掘金_files/480fa285c0dd7eefbc28.jpg_tplv-t2oaga2asx-no-mark_240_240_240_160.awebp" alt="Swift 编程思想，第四部分：map all the things!" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="7036565818271858719" data-original-type="0" data-draft-id="7036565762844131335" class="entry" style="margin-bottom: 0px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/2840793777968238" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">11月前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/Java" target="_blank" rel="" class="tag">
        Java
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/7036565818271858719" target="_blank" rel="" title="Groovy热更新Java实践" class="title">Groovy热更新Java实践</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/7036565818271858719" target="_blank" rel=""><div data-v-d5649b80="">之前在写Groovy动态添加方法和属性及Spock单测文章的时候，我还没意识到metaclass的神奇之处，直到有一天我突然想要不经过构建过程直接更新功能，也就是传说中的热更新。 之前学过arthas</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">493</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            点赞
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            评论
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-d5649b80="" src="./Groovy AST 之旅 - 掘金_files/38a12c892da64dd39623b8fb981b84a0_tplv-k3u1fbpfcp-no-mark_240_240_240_160.awebp" alt="Groovy热更新Java实践" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-2bf301c8="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-d5649b80="" data-v-5a9d6e8e="" data-v-2bf301c8="" data-entry-id="7088897451725160461" data-original-type="0" data-draft-id="7088687673107283998" class="entry" style="margin-bottom: 20px;"><div data-v-d5649b80="" class="meta-container"><a data-v-d5649b80="" href="https://juejin.cn/user/1882007127197694" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-9421b4e2="" data-v-d5649b80="" class="popover-box user-popover"><!---->  
        
      </div></a> <div data-v-d5649b80="" class="date">7月前</div> <div data-v-d5649b80="" class="tag_list"><a data-v-d5649b80="" href="https://juejin.cn/tag/Groovy" target="_blank" rel="" class="tag">
        Groovy
      </a></div></div> <div data-v-d5649b80="" class="content-wrapper" style="border-bottom: 0px;"><div data-v-d5649b80="" class="content-main"><div data-v-d5649b80="" class="title-row"> <!----> <!----> <!----> <a data-v-d5649b80="" href="https://juejin.cn/post/7088897451725160461" target="_blank" rel="" title="有道词典Android客户端包体积优化之路" class="title">有道词典Android客户端包体积优化之路</a></div> <div data-v-d5649b80="" class="abstract"><a data-v-d5649b80="" href="https://juejin.cn/post/7088897451725160461" target="_blank" rel=""><div data-v-d5649b80="">本文主要介绍了包体积包含的内容以及优化方法，分析了技术实现的具体细节，在接下来的工作中，我们会对启动速度、安装包体积以及内存占用等多方面进行持续优化，欢迎大家关注！</div></a></div> <ul data-v-d5649b80="" class="action-list jh-timeline-action-area"><li data-v-d5649b80="" class="item view"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">790</span></li> <li data-v-d5649b80="" class="item like"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            2
          </span></li> <li data-v-d5649b80="" class="item comment"><i data-v-d5649b80=""></i> <span data-v-d5649b80="">
            评论
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-d5649b80="" src="./Groovy AST 之旅 - 掘金_files/f5c6a76631fa4e4fa74f7441b654db94_tplv-k3u1fbpfcp-no-mark_240_240_240_160.awebp" alt="有道词典Android客户端包体积优化之路" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li></div></div> <div data-v-d96003d4="" data-v-020666e8="" class="recommended-links main-area" data-v-4b9f9746=""><p data-v-d96003d4="">友情链接：</p> <ul data-v-d96003d4=""><li data-v-d96003d4=""><a data-v-d96003d4="" href="https://www.dongchedi.com/auto/series/2244" title="双龙LIV-2" target="_blank" rel="noopener noreferrer">
        双龙LIV-2
      </a></li><li data-v-d96003d4=""><a data-v-d96003d4="" href="https://www.dongchedi.com/auto/series/2245" title="起亚Novo" target="_blank" rel="noopener noreferrer">
        起亚Novo
      </a></li><li data-v-d96003d4=""><a data-v-d96003d4="" href="https://www.dongchedi.com/auto/series/2246" title="日产IDS" target="_blank" rel="noopener noreferrer">
        日产IDS
      </a></li><li data-v-d96003d4=""><a data-v-d96003d4="" href="https://www.dongchedi.com/auto/series/2247" title="双龙SIV-2" target="_blank" rel="noopener noreferrer">
        双龙SIV-2
      </a></li><li data-v-d96003d4=""><a data-v-d96003d4="" href="https://backend.devrank.cn/traffic-aggregation/1199083" title="java接收ios文件" target="_blank" rel="noopener noreferrer">
        java接收ios文件
      </a></li><li data-v-d96003d4=""><a data-v-d96003d4="" href="https://backend.devrank.cn/traffic-aggregation/1199089" title="java byte 0x01" target="_blank" rel="noopener noreferrer">
        java byte 0x01
      </a></li><li data-v-d96003d4=""><a data-v-d96003d4="" href="https://backend.devrank.cn/traffic-aggregation/1199090" title="oracle复制表数据到另一张表" target="_blank" rel="noopener noreferrer">
        oracle复制表数据到另一张表
      </a></li><li data-v-d96003d4=""><a data-v-d96003d4="" href="https://backend.devrank.cn/traffic-aggregation/1199078" title="php sql 分表" target="_blank" rel="noopener noreferrer">
        php sql 分表
      </a></li><li data-v-d96003d4=""><a data-v-d96003d4="" href="https://backend.devrank.cn/traffic-aggregation/1199081" title="java设置周从开始" target="_blank" rel="noopener noreferrer">
        java设置周从开始
      </a></li><li data-v-d96003d4=""><a data-v-d96003d4="" href="https://backend.devrank.cn/traffic-aggregation/1199082" title="python取列表第一个元素" target="_blank" rel="noopener noreferrer">
        python取列表第一个元素
      </a></li></ul></div> <div st:block="sidebar" class="sidebar sidebar" style="" data-v-4a8226b0="" data-v-020666e8="" data-v-4b9f9746=""><div class="sidebar-block author-block pure" data-v-71f2d09e="" data-v-2d7c39c6="" data-v-4a8226b0=""><a href="https://juejin.cn/user/465848663023160" target="_blank" rel="" class="user-item item" data-v-2d7c39c6="" data-v-71f2d09e=""><img src="./Groovy AST 之旅 - 掘金_files/2c3d36ac68756ea7f747669b94554d42_100x100.awebp" alt="" class="lazy avatar avatar" data-v-248050e4="" data-v-47508ed8="" data-v-2d7c39c6="" loading="lazy"> <div class="info-box" data-v-2d7c39c6=""><a data-v-0ef8bafa="" data-v-2d7c39c6="" href="https://juejin.cn/user/465848663023160" target="_blank" rel="" class="username"><span data-v-0ef8bafa="" class="name" style="max-width: 128px;">
      花花子
    </span> <span data-v-3de16c56="" data-v-0ef8bafa="" blank="true" class="rank"><img data-v-3de16c56="" src="./Groovy AST 之旅 - 掘金_files/lv-4.a78c420.png" alt="lv-4" title="创作等级"></span> <!----> <div data-v-38a29e30="" data-v-0ef8bafa="" class="vip-level"><span data-v-38a29e30="" class="tooltip"><div class="byte-tooltip byte-tooltip--dark" style="display: none;">
        VIP.4 融会贯通
      </div><span class="byte-tooltip__wrapper"><img data-v-38a29e30="" src="./Groovy AST 之旅 - 掘金_files/07302452a7ad81cb43a173b5cd580237.svg" alt=""></span></span></div> </a> <div title="学生 @ 新东方烹饪学校" class="position" data-v-2d7c39c6="">
        学生 @ 新东方烹饪学校
      </div></div></a> <div class="operate-btn" data-v-71f2d09e="" data-v-2d7c39c6=""><button st:name="followBtn" class="ui-btn follow-btn primary large default attention" data-v-05e27314="" data-v-2d7c39c6="" data-v-71f2d09e=""><!----> 
    关注
  </button> <a href="https://juejin.cn/notification/im?participantId=465848663023160" class="im-button im-btn" data-v-11443840="" data-v-2d7c39c6="" data-v-71f2d09e=""><!----> <div data-v-11443840="">私信</div></a></div> <div class="cut-off" data-v-71f2d09e="" data-v-2d7c39c6=""></div>  <div class="stat-item item" data-v-71f2d09e="" data-v-2d7c39c6=""><svg xmlns="http://www.w3.org/2000/svg" width="25" height="26" viewBox="0 0 25 26" class="zan" data-v-71f2d09e="" data-v-2d7c39c6=""><g fill="none" fill-rule="evenodd" transform="translate(0 .57)" data-v-71f2d09e="" data-v-2d7c39c6=""><ellipse cx="12.5" cy="12.57" fill="#E1EFFF" rx="12.5" ry="12.57" data-v-71f2d09e="" data-v-2d7c39c6=""></ellipse><path fill="#7BB9FF" d="M8.596 11.238V19H7.033C6.463 19 6 18.465 6 17.807v-5.282c0-.685.483-1.287 1.033-1.287h1.563zm4.275-4.156A1.284 1.284 0 0 1 14.156 6c.885.016 1.412.722 1.595 1.07.334.638.343 1.687.114 2.361-.207.61-.687 1.412-.687 1.412h3.596c.38 0 .733.178.969.488.239.317.318.728.21 1.102l-1.628 5.645a1.245 1.245 0 0 1-1.192.922h-7.068v-7.889c1.624-.336 2.623-2.866 2.806-4.029z" data-v-71f2d09e="" data-v-2d7c39c6=""></path></g></svg> <span class="content" data-v-71f2d09e="" data-v-2d7c39c6="">
      获得点赞
      <span class="count" data-v-71f2d09e="" data-v-2d7c39c6="">&nbsp;365</span></span></div> <div class="stat-item item" data-v-71f2d09e="" data-v-2d7c39c6=""><svg width="25" height="25" viewBox="0 0 25 25" class="icon stat-view-icon" data-v-71f2d09e="" data-v-2d7c39c6=""><g fill="none" fill-rule="evenodd" data-v-71f2d09e="" data-v-2d7c39c6=""><circle cx="12.5" cy="12.5" r="12.5" fill="#E1EFFF" data-v-71f2d09e="" data-v-2d7c39c6=""></circle><path fill="#7BB9FF" d="M4 12.5S6.917 7 12.75 7s8.75 5.5 8.75 5.5-2.917 5.5-8.75 5.5S4 12.5 4 12.5zm8.75 2.292c1.208 0 2.188-1.026 2.188-2.292 0-1.266-.98-2.292-2.188-2.292-1.208 0-2.188 1.026-2.188 2.292 0 1.266.98 2.292 2.188 2.292z" data-v-71f2d09e="" data-v-2d7c39c6=""></path></g></svg> <span class="content" data-v-71f2d09e="" data-v-2d7c39c6="">
      文章被阅读
      <span class="count" data-v-71f2d09e="" data-v-2d7c39c6="">&nbsp;97,822</span></span></div> <!----></div> <ul data-v-4a8226b0="" class="sidebar-bd-entry"><li data-v-4a8226b0=""><a data-v-25f2c691="" data-v-4a8226b0="" href="https://conf.juejin.cn/future2022/?utm_source=jjtofu1" target="_blank" class="sidebar-entry" style="background-image: url(&quot;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/646c43a0f83d4fc584eec1f18f7f14ac~tplv-k3u1fbpfcp-watermark.image?&quot;);"></a></li><li data-v-4a8226b0=""><a data-v-25f2c691="" data-v-4a8226b0="" href="https://juejin.cn/post/7162096952883019783?utm_source=article&amp;utm_medium=banner&amp;utm_campaign=jinshijihua02" target="_blank" class="sidebar-entry" style="background-image: url(&quot;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45c30b323e2042e39beb0a32e903a4cc~tplv-k3u1fbpfcp-watermark.image?&quot;);"></a></li><li data-v-4a8226b0=""><a data-v-25f2c691="" data-v-4a8226b0="" href="https://juejin.cn/live/2209714" target="_blank" class="sidebar-entry" style="background-image: url(&quot;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d18575a69084ee08671ccb09d506659~tplv-k3u1fbpfcp-watermark.image?&quot;);"></a></li></ul> <a href="https://juejin.cn/user/center/signin?from=item" target="" rel="" data-v-4a8226b0=""><img data-v-4a8226b0="" src="./Groovy AST 之旅 - 掘金_files/sign-in.d6891e5.png" alt="限时领掘金会员" class="banner"></a> <!----> <div data-v-71f2d09e="" data-v-54794b76="" data-v-4a8226b0="" class="sidebar-block related-entry-sidebar-block shadow" st:block="relatedEntrySidebarBlock"><div data-v-71f2d09e="" class="block-title">相关文章</div> <div data-v-71f2d09e="" class="block-body"><div data-v-54794b76="" data-v-71f2d09e="" class="entry-list"><a data-v-54794b76="" href="https://juejin.cn/post/7084949825866694686" target="_blank" rel="" st:name="link" title="我与 Groovy 不共戴天" class="item" data-v-71f2d09e=""><div data-v-54794b76="" class="entry-title">我与 Groovy 不共戴天</div> <div data-v-54794b76="" class="entry-meta-box"><div data-v-54794b76="" class="entry-meta">23点赞</div> <div data-v-54794b76="" class="entry-meta">&nbsp;·&nbsp;</div> <div data-v-54794b76="" class="entry-meta">13评论</div></div></a><a data-v-54794b76="" href="https://juejin.cn/post/7092366305977696287" target="_blank" rel="" st:name="link" title="通过 javax.mail 实现系统异常自动告警" class="item" data-v-71f2d09e=""><div data-v-54794b76="" class="entry-title">通过 javax.mail 实现系统异常自动告警</div> <div data-v-54794b76="" class="entry-meta-box"><div data-v-54794b76="" class="entry-meta">1点赞</div> <div data-v-54794b76="" class="entry-meta">&nbsp;·&nbsp;</div> <div data-v-54794b76="" class="entry-meta">0评论</div></div></a><a data-v-54794b76="" href="https://juejin.cn/post/6844903972977770503" target="_blank" rel="" st:name="link" title="Scala 初体验" class="item" data-v-71f2d09e=""><div data-v-54794b76="" class="entry-title">Scala 初体验</div> <div data-v-54794b76="" class="entry-meta-box"><div data-v-54794b76="" class="entry-meta">4点赞</div> <div data-v-54794b76="" class="entry-meta">&nbsp;·&nbsp;</div> <div data-v-54794b76="" class="entry-meta">5评论</div></div></a><a data-v-54794b76="" href="https://juejin.cn/post/6996129680541614093" target="_blank" rel="" st:name="link" title="Scala 之关于 _ 符号的妙用" class="item" data-v-71f2d09e=""><div data-v-54794b76="" class="entry-title">Scala 之关于 _ 符号的妙用</div> <div data-v-54794b76="" class="entry-meta-box"><div data-v-54794b76="" class="entry-meta">1点赞</div> <div data-v-54794b76="" class="entry-meta">&nbsp;·&nbsp;</div> <div data-v-54794b76="" class="entry-meta">5评论</div></div></a><a data-v-54794b76="" href="https://juejin.cn/post/6844903725228621832" target="_blank" rel="" st:name="link" title="平庸前端码农之蜕变 — AST" class="item" data-v-71f2d09e=""><div data-v-54794b76="" class="entry-title">平庸前端码农之蜕变 — AST</div> <div data-v-54794b76="" class="entry-meta-box"><div data-v-54794b76="" class="entry-meta">1099点赞</div> <div data-v-54794b76="" class="entry-meta">&nbsp;·&nbsp;</div> <div data-v-54794b76="" class="entry-meta">46评论</div></div></a></div></div></div> <div class="sticky-block-box" data-v-4a8226b0=""><div class="sidebar-block catalog-block catalog-block pure" style="" data-v-71f2d09e="" data-v-4a8226b0=""><nav class="article-catalog" style="" data-v-cb93f23a="" data-v-71f2d09e=""><div class="catalog-title" data-v-cb93f23a="">目录</div> <div class="catalog-body" data-v-cb93f23a=""><ul class="catalog-list" style="margin-top:0px;" data-v-cb93f23a=""><li data-v-cb93f23a="" class="item d1 active"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-0" title="8. 编译时元编程" class="catalog-aTag">
      8. 编译时元编程
    </a></div> <ul class="sub-list"><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-1" title="8.1 Groovy AST" class="catalog-aTag">
      8.1 Groovy AST
    </a></div> <!----></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-2" title="8.2 从进行 AST 树检查开始" class="catalog-aTag">
      8.2 从进行 AST 树检查开始
    </a></div> <ul class="sub-list"><li class="item d3"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-3" title="8.2.1 ASTTransformation" class="catalog-aTag">
      8.2.1 ASTTransformation
    </a></div> <!----></li><li class="item d3"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-4" title="8.2.2 GroovyClassVisitor" class="catalog-aTag">
      8.2.2 GroovyClassVisitor
    </a></div> <!----></li><li class="item d3"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-5" title="8.2.3 注册 SPI (全局变换必须注册)" class="catalog-aTag">
      8.2.3 注册 SPI (全局变换必须注册)
    </a></div> <!----></li></ul></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-6" title="8.3 基于 AST 全局变换的方法拦截" class="catalog-aTag">
      8.3 基于 AST 全局变换的方法拦截
    </a></div> <!----></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-7" title="8.4 编译期注入属性" class="catalog-aTag">
      8.4 编译期注入属性
    </a></div> <!----></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-8" title="8.5 编译期注入方法" class="catalog-aTag">
      8.5 编译期注入方法
    </a></div> <!----></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-9" title="8.6 基于注解的局部变换" class="catalog-aTag">
      8.6 基于注解的局部变换
    </a></div> <!----></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-10" title="8.7 AST 杀手锏：AstBuilder" class="catalog-aTag">
      8.7 AST 杀手锏：AstBuilder
    </a></div> <!----></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-11" title="8.8 补充：部分 AST 节点表示为 “空” 的方式" class="catalog-aTag">
      8.8 补充：部分 AST 节点表示为 “空” 的方式
    </a></div> <!----></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/6970928380812197901#heading-12" title="Footnotes" class="catalog-aTag">
      Footnotes
    </a></div> <!----></li></ul></li></ul></div></nav></div> <nav data-v-04051bd0="" data-v-4a8226b0="" class="next-article"><div data-v-04051bd0="" class="next-article-header"><div data-v-04051bd0="" class="next-article-title">下一篇</div> <svg data-v-04051bd0="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="list-icon"><path data-v-04051bd0="" fill-rule="evenodd" clip-rule="evenodd" d="M2.00001 2C1.63182 2 1.33334 2.29848 1.33334 2.66667C1.33334 3.03486 1.63182 3.33333 2.00001 3.33333H3.33334C3.70153 3.33333 4.00001 3.03486 4.00001 2.66667C4.00001 2.29848 3.70153 2 3.33334 2H2.00001ZM6.00034 2C5.63215 2 5.33367 2.29848 5.33367 2.66667C5.33367 3.03486 5.63215 3.33333 6.00034 3.33333H14.0003C14.3685 3.33333 14.667 3.03486 14.667 2.66667C14.667 2.29848 14.3685 2 14.0003 2H6.00034ZM6.00034 7.33333C5.63215 7.33333 5.33367 7.63181 5.33367 8C5.33367 8.36819 5.63215 8.66667 6.00034 8.66667H14.0003C14.3685 8.66667 14.667 8.36819 14.667 8C14.667 7.63181 14.3685 7.33333 14.0003 7.33333H6.00034ZM1.33367 8C1.33367 7.63181 1.63215 7.33333 2.00034 7.33333H3.33367C3.70186 7.33333 4.00034 7.63181 4.00034 8C4.00034 8.36819 3.70186 8.66667 3.33367 8.66667H2.00034C1.63215 8.66667 1.33367 8.36819 1.33367 8ZM1.33367 13.3333C1.33367 12.9651 1.63215 12.6667 2.00034 12.6667H3.33367C3.70186 12.6667 4.00034 12.9651 4.00034 13.3333C4.00034 13.7015 3.70186 14 3.33367 14H2.00034C1.63215 14 1.33367 13.7015 1.33367 13.3333ZM6.00034 12.6667C5.63215 12.6667 5.33367 12.9651 5.33367 13.3333C5.33367 13.7015 5.63215 14 6.00034 14H14.0003C14.3685 14 14.667 13.7015 14.667 13.3333C14.667 12.9651 14.3685 12.6667 14.0003 12.6667H6.00034Z"></path></svg></div> <hr data-v-04051bd0="" class="next-article-hr"> <div data-v-04051bd0="" class="article-content"><a data-v-04051bd0="" href="https://juejin.cn/post/6962777564335046687" title="一文通读 Groovy 元对象协议 MOP" target="_blank" class="article">
      一文通读 Groovy 元对象协议 MOP
    </a></div> <!----></nav></div></div> <div class="article-suspended-panel article-suspended-panel" data-v-b7c4e7d2="" data-v-020666e8="" data-v-4b9f9746=""><svg xmlns="http://www.w3.org/2000/svg" style="display:none;" data-v-b7c4e7d2="" class=""><symbol id="icon-collect" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-v-b7c4e7d2=""><path fill-rule="evenodd" clip-rule="evenodd" d="M5.24287 18.3845C4.89724 18.5507 4.48229 18.4053 4.31605 18.0596C4.26029 17.9437 4.23783 17.8146 4.25117 17.6866L4.75725 12.8332C4.77762 12.6379 4.71431 12.443 4.583 12.297L1.29207 8.63594C1.03567 8.35071 1.05905 7.91164 1.34428 7.65524C1.43464 7.574 1.54475 7.5179 1.66358 7.49254L6.47789 6.46509C6.66998 6.42409 6.83572 6.30367 6.93407 6.13365L9.39894 1.87248C9.59098 1.54049 10.0158 1.42704 10.3478 1.61907C10.453 1.67992 10.5403 1.76729 10.6012 1.87248L13.0661 6.13365C13.1644 6.30367 13.3301 6.42409 13.5222 6.46509L18.3365 7.49254C18.7116 7.57259 18.9508 7.94155 18.8707 8.31664C18.8454 8.43547 18.7893 8.54557 18.708 8.63594L15.4171 12.297C15.2858 12.443 15.2225 12.6379 15.2429 12.8332L15.7489 17.6866C15.7887 18.0681 15.5117 18.4096 15.1303 18.4493C15.0023 18.4627 14.8732 18.4402 14.7572 18.3845L10.3011 16.2412C10.1108 16.1497 9.8893 16.1497 9.69906 16.2412L5.24287 18.3845Z" data-v-b7c4e7d2=""></path></symbol><symbol id="icon-comment" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-v-b7c4e7d2=""><path fill-rule="evenodd" clip-rule="evenodd" d="M4.62739 1.25C2.9347 1.25 1.5625 2.6222 1.5625 4.31489L1.56396 12.643C1.56403 14.3356 2.9362 15.7078 4.62885 15.7078H6.48326L6.93691 17.6869L6.93884 17.6948C7.16894 18.6441 8.28598 19.0599 9.08073 18.4921L12.7965 15.7078H15.5001C17.1928 15.7078 18.565 14.3355 18.565 12.6428L18.5635 4.31477C18.5635 2.62213 17.1913 1.25 15.4986 1.25H4.62739ZM5.98265 9.89255C6.68783 9.89255 7.2595 9.32089 7.2595 8.61571C7.2595 7.91053 6.68783 7.33887 5.98265 7.33887C5.27747 7.33887 4.70581 7.91053 4.70581 8.61571C4.70581 9.32089 5.27747 9.89255 5.98265 9.89255ZM9.95604 9.89255C10.6612 9.89255 11.2329 9.32089 11.2329 8.61571C11.2329 7.91053 10.6612 7.33887 9.95604 7.33887C9.25086 7.33887 8.6792 7.91053 8.6792 8.61571C8.6792 9.32089 9.25086 9.89255 9.95604 9.89255ZM15.2124 8.61571C15.2124 9.32089 14.6407 9.89255 13.9355 9.89255C13.2304 9.89255 12.6587 9.32089 12.6587 8.61571C12.6587 7.91053 13.2304 7.33887 13.9355 7.33887C14.6407 7.33887 15.2124 7.91053 15.2124 8.61571Z" data-v-b7c4e7d2=""></path></symbol><symbol id="icon-zan" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-v-b7c4e7d2=""><path fill-rule="evenodd" clip-rule="evenodd" d="M13.0651 3.25923C12.6654 2.21523 12.1276 1.60359 11.4633 1.40559C10.8071 1.21 10.2539 1.48626 9.97848 1.67918C9.43962 2.05668 9.17297 2.64897 9.0009 3.12662C8.93522 3.30893 8.87504 3.50032 8.82077 3.67291L8.82077 3.67292C8.80276 3.73019 8.78541 3.78539 8.76872 3.8375C8.6974 4.06017 8.63455 4.23905 8.56561 4.38315C8.07104 5.41687 7.64014 6.034 7.2617 6.43277C6.89154 6.8228 6.5498 7.0275 6.18413 7.21038C5.8887 7.35813 5.69369 7.66144 5.69365 8.00211L5.69237 17.3908C5.6923 17.8783 6.08754 18.2736 6.57511 18.2736H14.8382C15.2621 18.2736 15.5829 18.1393 15.8149 17.9421C15.9234 17.8497 15.9985 17.7554 16.0484 17.6856C16.0695 17.6561 16.088 17.6282 16.0983 17.6126L16.1017 17.6075L16.1033 17.6051L16.1194 17.5857L16.1428 17.5478C16.913 16.3019 17.4472 15.3088 17.8659 14.1183C18.3431 12.7613 18.5849 11.5853 18.6874 10.6685C18.7871 9.77617 18.7612 9.07318 18.6558 8.68779C18.5062 8.14118 18.138 7.82653 17.7668 7.66617C17.4231 7.51771 17.0763 7.49836 16.8785 7.49807L13.1134 7.44551C13.662 5.19751 13.31 3.89889 13.0651 3.25923ZM1.251 8.0848C1.22726 7.5815 1.62891 7.16046 2.13277 7.16046H3.4408C3.92832 7.16046 4.32354 7.55568 4.32354 8.04321V17.4303C4.32354 17.9178 3.92832 18.313 3.4408 18.313H2.57554C2.10419 18.313 1.71599 17.9427 1.69378 17.4718L1.251 8.0848Z" data-v-b7c4e7d2=""></path></symbol><symbol id="icon-share" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-v-b7c4e7d2=""><path fill-rule="evenodd" clip-rule="evenodd" d="M10.4167 6.40399C5.35406 6.40399 1.25 10.5675 1.25 15.7035C1.25 16.0225 1.28448 16.4512 1.35344 16.9898C1.36807 17.1039 1.47243 17.1846 1.58655 17.17C1.6483 17.1621 1.70328 17.127 1.73643 17.0743L1.86865 16.8676C1.99553 16.6731 2.10644 16.5147 2.20137 16.3925C3.69554 14.4692 6.13777 13.3823 9.35515 13.3378L10.4167 13.3364V17.0757C10.4167 17.3101 10.6086 17.5 10.8453 17.5C10.959 17.5 11.068 17.4553 11.1483 17.3757L18.145 10.45C18.3961 10.2015 18.3961 9.79853 18.145 9.55L11.1483 2.62426C10.981 2.45858 10.7096 2.45858 10.5422 2.62426C10.4618 2.70383 10.4167 2.81174 10.4167 2.92426V6.40399Z" data-v-b7c4e7d2=""></path></symbol><symbol id="icon-report" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-v-b7c4e7d2=""><path fill-rule="evenodd" clip-rule="evenodd" d="M10.8389 1.89381C11.0873 2.03868 11.2939 2.24532 11.4388 2.49366L18.9369 15.0065C19.4007 15.8015 19.1322 16.8221 18.3371 17.2859C18.0822 17.4346 17.7924 17.5129 17.4973 17.5129H2.50041C1.57993 17.5129 0.83374 16.7667 0.83374 15.8462C0.83374 15.5512 0.912088 15.2614 1.06078 15.0065L8.5595 2.49366C9.0233 1.69857 10.0438 1.43001 10.8389 1.89381ZM10.3118 13.3459C10.6283 13.3459 10.8848 13.6025 10.8848 13.9189V14.4918C10.8848 14.8082 10.6283 15.0647 10.3118 15.0647H9.73893C9.42252 15.0647 9.16602 14.8082 9.16602 14.4918V13.9189C9.16602 13.6025 9.42252 13.3459 9.73893 13.3459H10.3118ZM10.8356 7.09513C10.8356 6.86502 10.6491 6.67847 10.419 6.67847H9.58512C9.35501 6.67847 9.16846 6.86502 9.16846 7.09513V12.0956C9.16846 12.3257 9.35501 12.5123 9.58512 12.5123H10.419C10.6491 12.5123 10.8356 12.3257 10.8356 12.0956V7.09513Z" data-v-b7c4e7d2=""></path></symbol><symbol id="icon-immerse" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-v-b7c4e7d2=""><path fill-rule="evenodd" clip-rule="evenodd" d="M0.25 1C0.25 0.585786 0.585786 0.25 1 0.25H4C4.41421 0.25 4.75 0.585786 4.75 1C4.75 1.41421 4.41421 1.75 4 1.75H1.75V4C1.75 4.41421 1.41421 4.75 1 4.75C0.585786 4.75 0.25 4.41421 0.25 4V1ZM0.25 19C0.25 19.4142 0.585786 19.75 1 19.75H4C4.41421 19.75 4.75 19.4142 4.75 19C4.75 18.5858 4.41421 18.25 4 18.25H1.75V16C1.75 15.5858 1.41421 15.25 1 15.25C0.585786 15.25 0.25 15.5858 0.25 16V19ZM19 0.25C19.4142 0.25 19.75 0.585786 19.75 1V4C19.75 4.41421 19.4142 4.75 19 4.75C18.5858 4.75 18.25 4.41421 18.25 4V1.75H16C15.5858 1.75 15.25 1.41421 15.25 1C15.25 0.585786 15.5858 0.25 16 0.25H19ZM19.75 19C19.75 19.4142 19.4142 19.75 19 19.75H16C15.5858 19.75 15.25 19.4142 15.25 19C15.25 18.5858 15.5858 18.25 16 18.25H18.25V16C18.25 15.5858 18.5858 15.25 19 15.25C19.4142 15.25 19.75 15.5858 19.75 16V19ZM7 5C5.89543 5 5 5.89543 5 7V13C5 14.1046 5.89543 15 7 15H13C14.1046 15 15 14.1046 15 13V7C15 5.89543 14.1046 5 13 5H7Z" data-v-b7c4e7d2=""></path></symbol><symbol id="icon-wechat" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-v-b7c4e7d2=""><path fill-rule="evenodd" clip-rule="evenodd" d="M13.5578 5.34061C12.0476 2.85722 8.90911 1.73257 6.11813 2.05358C4.56413 2.23231 3.0449 2.85861 1.88463 3.92471C1.00689 4.72863 0.354462 5.78486 0.109889 6.95889C-0.187864 8.37395 0.125815 9.85314 0.957723 11.0298C1.28982 11.4994 1.68479 11.9193 2.11951 12.2941C2.25136 12.4079 2.38694 12.5172 2.52543 12.6228C2.59301 12.6742 2.66115 12.7249 2.73011 12.7745C2.74195 12.7831 2.75392 12.7902 2.76512 12.7969C2.80389 12.8201 2.83351 12.8378 2.81653 12.8887L2.67458 13.3177C2.53986 13.7252 2.40492 14.1325 2.26998 14.5399C2.22084 14.6883 2.17169 14.8366 2.12256 14.985L2.61572 14.7368C2.85714 14.6151 3.09863 14.4935 3.34012 14.3719C3.58099 14.2507 3.82186 14.1294 4.06266 14.0081L4.40902 13.8337C4.42474 13.8257 4.44104 13.8164 4.45775 13.8069C4.51759 13.7728 4.58265 13.7356 4.64501 13.7481C4.76613 13.7723 4.88708 13.7972 5.00801 13.8221C5.08094 13.8372 5.15386 13.8522 5.22681 13.867C6.06287 14.0373 6.88508 14.1348 7.73859 14.0675C7.4486 13.0669 7.44915 12.0016 7.7559 11.0045C8.09853 9.88624 8.81438 8.89831 9.74448 8.19773C11.0171 7.23915 12.6431 6.81493 14.2212 6.99199C14.0895 6.4081 13.8688 5.85148 13.5578 5.34061ZM4.77922 5.02147C4.28094 5.02147 3.71299 5.35514 3.71299 5.90829C3.71299 6.46088 4.28066 6.79844 4.77922 6.79844C5.29233 6.79844 5.66293 6.42291 5.66293 5.90829C5.66293 5.39311 5.29205 5.02147 4.77922 5.02147ZM10.6158 5.90829C10.6158 6.42444 10.2434 6.79844 9.7296 6.79844C9.23076 6.79844 8.66641 6.46032 8.66641 5.90829C8.66641 5.3557 9.23104 5.02147 9.7296 5.02147C10.2431 5.02147 10.6158 5.39158 10.6158 5.90829ZM17.7911 8.53846C15.3552 6.80489 11.734 6.93368 9.53048 9.01108C8.77779 9.72181 8.22909 10.6485 8.04061 11.6744C7.78288 13.0799 8.22536 14.5441 9.17304 15.605C10.0674 16.6063 11.2889 17.2564 12.5986 17.5166C13.4216 17.6806 14.2559 17.6931 15.0799 17.5344C15.2863 17.4948 15.4911 17.4481 15.6954 17.3986C15.7826 17.3774 15.8697 17.3559 15.9568 17.334C15.9655 17.3319 15.9784 17.3272 15.9934 17.3219C16.0359 17.3068 16.0949 17.2858 16.118 17.2984C16.2476 17.3695 16.3771 17.4408 16.5066 17.5122L17.0557 17.8142L17.0577 17.8153L17.0598 17.8164C17.3912 17.9986 17.7227 18.1809 18.054 18.3634C17.9748 18.0977 17.895 17.832 17.8153 17.5664L17.8146 17.5641L17.6749 17.0981L17.5814 16.7863L17.5332 16.6257C17.5159 16.5675 17.5927 16.5183 17.6556 16.4779C17.6753 16.4653 17.6937 16.4535 17.7073 16.4426C18.0608 16.1622 18.3952 15.8558 18.6963 15.5191C19.1832 14.9747 19.5895 14.3498 19.8161 13.6505C20.0122 13.039 20.0488 12.392 19.9377 11.7604C19.7098 10.438 18.8643 9.30511 17.7911 8.53846ZM15.2396 11.0049C15.1595 10.6088 15.5334 10.1787 15.931 10.1787C16.3063 10.1787 16.7409 10.3931 16.8096 10.7989C16.8724 11.1695 16.556 11.4696 16.227 11.5617C15.8032 11.6802 15.3326 11.4649 15.2396 11.0049ZM12.0348 10.1787C11.6369 10.1787 11.2573 10.6064 11.3385 11.0049C11.4325 11.4667 11.9081 11.68 12.3327 11.5617C12.6626 11.4696 12.9753 11.1695 12.9134 10.7989C12.8453 10.3914 12.4112 10.1787 12.0348 10.1787Z" data-v-b7c4e7d2=""></path></symbol><symbol id="icon-weibo" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-v-b7c4e7d2=""><path fill-rule="evenodd" clip-rule="evenodd" d="M-0.000244141 13.0984C-0.000244141 8.70757 6.6145 3.5004 9.18008 4.57052C10.1717 4.98415 9.97381 6.1693 9.85415 6.88576C9.8069 7.16863 9.77186 7.37844 9.82705 7.43887C9.92921 7.55074 10.2955 7.42054 10.7994 7.2414C11.8362 6.87286 13.4557 6.2972 14.5566 7.19617C15.2665 7.77576 14.9657 8.72382 14.7905 9.27603C14.7289 9.4701 14.6829 9.61528 14.7017 9.6784C14.741 9.81053 14.9858 9.91133 15.317 10.0477C15.926 10.2984 16.8269 10.6692 17.2784 11.5759C18.3716 13.7713 15.2036 18.2504 8.62234 18.2504C3.25024 18.2504 -0.000244141 15.6688 -0.000244141 13.0984ZM8.45309 17.057C11.7733 16.7393 14.2944 14.7397 14.0842 12.5908C13.874 10.4418 11.012 8.95732 7.69179 9.27503C4.37159 9.59274 1.85045 11.5924 2.06068 13.7413C2.2709 15.8902 5.13288 17.3747 8.45309 17.057Z" data-v-b7c4e7d2=""></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.7098 12.7012C11.1162 14.1374 10.0604 15.6852 8.35157 16.1581C6.64275 16.6311 4.92801 15.8502 4.5216 14.4139C4.11518 12.9777 5.171 11.4299 6.87982 10.957C8.58865 10.484 10.3034 11.2649 10.7098 12.7012ZM7.67026 13.6265C7.89619 14.1072 7.61751 14.7092 7.04779 14.9711C6.47808 15.2331 5.83308 15.0558 5.60715 14.5751C5.38122 14.0945 5.6599 13.4925 6.22962 13.2306C6.79933 12.9686 7.44433 13.1459 7.67026 13.6265ZM8.41746 13.3766C8.63945 13.2745 8.74804 13.0399 8.66001 12.8526C8.57197 12.6654 8.32065 12.5963 8.09866 12.6984C7.87667 12.8004 7.76808 13.035 7.85612 13.2223C7.94415 13.4095 8.19547 13.4786 8.41746 13.3766Z" data-v-b7c4e7d2=""></path><path d="M13.648 3.54836C13.9523 3.47388 14.2712 3.43418 14.6004 3.43418C16.7813 3.43418 18.5492 5.18267 18.5492 7.33955C18.5492 7.81593 18.4633 8.27085 18.3066 8.69104C18.168 9.06261 18.3602 9.47493 18.7359 9.61199C19.1116 9.74904 19.5285 9.55894 19.6671 9.18737C19.8822 8.61063 19.9993 7.98781 19.9993 7.33955C19.9993 4.3906 17.5822 2 14.6004 2C14.1528 2 13.717 2.05403 13.2996 2.15619C12.9109 2.25133 12.6738 2.64011 12.77 3.02455C12.8662 3.40899 13.2593 3.6435 13.648 3.54836Z" data-v-b7c4e7d2=""></path><path d="M14.2887 6.05162C14.388 6.02824 14.4923 6.01569 14.6004 6.01569C15.3397 6.01569 15.939 6.6084 15.939 7.33955C15.939 7.49914 15.9108 7.65062 15.8596 7.7904C15.7232 8.16277 15.9179 8.57396 16.2944 8.70881C16.6709 8.84366 17.0867 8.65112 17.2231 8.27875C17.3307 7.98466 17.3891 7.66805 17.3891 7.33955C17.3891 5.81633 16.1406 4.58152 14.6004 4.58152C14.3784 4.58152 14.1614 4.60734 13.9529 4.65643C13.5633 4.74813 13.3227 5.1348 13.4154 5.52008C13.5082 5.90535 13.8991 6.14333 14.2887 6.05162Z" data-v-b7c4e7d2=""></path></symbol><symbol id="icon-qq" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-v-b7c4e7d2=""><path d="M11.8841 17.1943C11.1815 17.1943 10.5625 17.2136 10.0541 17.26C9.44625 17.2112 8.8365 17.1898 8.22671 17.1956C6.20498 17.1956 4.40588 17.9613 4.40588 18.5263C4.40588 19.0681 5.89998 19.0076 7.91657 18.987C8.64426 18.985 9.3699 18.9096 10.0824 18.7618C10.6796 18.8879 11.4079 18.9677 12.193 18.9741C14.2095 18.9947 15.7024 19.0552 15.7024 18.5173C15.7024 17.9549 13.9045 17.1943 11.8841 17.1943V17.1943Z" data-v-b7c4e7d2=""></path><path d="M16.9138 11.6311C16.5346 10.6112 16.1212 9.60428 15.6745 8.61206C15.6951 8.37141 15.7054 8.12818 15.7054 7.8811C15.7054 4.08086 13.7622 1 10.0649 1C6.36759 1 4.42307 4.08086 4.42307 7.8811C4.42307 8.11274 4.43208 8.34052 4.45138 8.56573C3.99804 9.5756 3.57913 10.6006 3.19536 11.6389C2.41678 13.7494 2.38203 15.6566 2.65357 15.7982C2.84661 15.8985 3.54797 15.1611 4.21845 13.9669C4.66115 16.7801 6.53102 18.8842 10.0649 18.8842C13.5871 18.8842 15.457 16.7916 15.9074 13.99C16.5728 15.1611 17.2664 15.8818 17.4569 15.7814C17.7284 15.6399 17.6937 13.7365 16.9138 11.6311V11.6311Z" data-v-b7c4e7d2=""></path><path d="M8.5542 3.2522C8.00598 3.26507 7.57358 3.90981 7.58902 4.69739C7.60447 5.48369 8.06132 6.11299 8.60954 6.1027C9.15776 6.0924 9.59016 5.44637 9.57472 4.65879C9.56056 3.87249 9.10243 3.24319 8.5542 3.25348V3.2522ZM11.5862 3.26764C11.0315 3.25734 10.5695 3.88278 10.5541 4.66651C10.5386 5.44895 10.9749 6.0924 11.5308 6.1027C12.0842 6.11299 12.5475 5.48755 12.5629 4.70512C12.5784 3.92139 12.1408 3.27794 11.5862 3.26764V3.26764Z" data-v-b7c4e7d2=""></path><path d="M13.6704 9.57861C12.5971 9.76521 11.354 9.87074 10.0285 9.87074C8.7287 9.87074 7.50742 9.76779 6.44959 9.58762C5.71605 10.4962 5.65942 11.8307 5.65942 13.3184C5.65942 16.0505 7.20371 18.2665 10.0645 18.2665C12.924 18.2665 14.4696 16.0505 14.4696 13.3184C14.4696 11.8243 14.4104 10.4859 13.6704 9.57861V9.57861Z" data-v-b7c4e7d2=""></path><path d="M10.0628 6.56616C8.14273 6.56616 6.58557 6.95223 6.58557 7.26238C6.58557 7.57124 8.62146 8.42188 10.0641 8.42188C11.5054 8.42188 13.5413 7.55065 13.5413 7.26238C13.5413 6.97411 11.9842 6.56745 10.0641 6.56745L10.0628 6.56616Z" data-v-b7c4e7d2=""></path><path d="M15.6744 8.6121L15.6757 8.59151C14.264 9.05866 12.2718 9.35078 10.0648 9.35078C7.8513 9.35078 5.85402 9.05737 4.441 8.58765C4.14115 9.25684 3.85546 9.93375 3.58521 10.6171C4.45644 10.9054 5.43192 11.1357 6.48332 11.2992V13.8858C6.48332 13.8858 7.22715 14.0235 7.92981 14.0531C8.42784 14.0737 8.95676 13.9888 8.95676 13.9888V11.5398C9.32095 11.5565 9.6903 11.5656 10.0635 11.5656C12.4919 11.5656 14.7311 11.2142 16.5251 10.6222C16.2566 9.94593 15.9729 9.27571 15.6744 8.6121V8.6121Z" data-v-b7c4e7d2=""></path><path d="M8.87981 4.24829C8.63787 4.24829 8.44226 4.53656 8.44226 4.89174C8.44226 5.24693 8.63787 5.5352 8.87981 5.5352C9.12046 5.5352 9.31736 5.24693 9.31736 4.89174C9.31736 4.53656 9.12046 4.24829 8.87981 4.24829V4.24829ZM12.0997 4.65624C12.0997 4.65624 11.9246 4.41816 11.4819 4.48122C11.0444 4.54428 10.8745 4.83126 10.8423 4.86215C10.8423 4.86215 10.7381 5.0243 10.8115 5.12467C10.8848 5.22505 11.0174 5.06676 11.0174 5.06676C11.0174 5.06676 11.2194 4.78364 11.4806 4.77335C11.6273 4.76349 11.7729 4.80489 11.8925 4.89046C11.8925 4.89046 12.0211 4.99856 12.0984 4.89046C12.1769 4.78364 12.0997 4.65624 12.0997 4.65624V4.65624Z" data-v-b7c4e7d2=""></path></symbol></svg> <div badge="1" class="panel-btn with-badge" data-v-b7c4e7d2=""><svg class="sprite-icon icon-zan" data-v-0f838daa="" data-v-b7c4e7d2=""><use xlink:href="#icon-zan" data-v-0f838daa=""></use></svg></div> <div badge="0" class="panel-btn" data-v-b7c4e7d2=""><svg class="sprite-icon icon-comment" data-v-0f838daa="" data-v-b7c4e7d2=""><use xlink:href="#icon-comment" data-v-0f838daa=""></use></svg></div> <div class="panel-btn" data-v-b7c4e7d2=""><svg class="sprite-icon icon-collect" data-v-0f838daa="" data-v-b7c4e7d2=""><use xlink:href="#icon-collect" data-v-0f838daa=""></use></svg> <div class="collect-popover" data-v-d0b73df6="" data-v-b7c4e7d2=""><div class="title" data-v-d0b73df6="">收藏成功！</div> <div class="sub-title" data-v-d0b73df6="">
    已添加到「」，
    <span class="modify-btn" data-v-d0b73df6="">点击更改</span></div></div> <!----> <!----></div> <div class="share-btn panel-btn" data-v-b7c4e7d2=""><svg class="sprite-icon icon-share" data-v-0f838daa="" data-v-b7c4e7d2=""><use xlink:href="#icon-share" data-v-0f838daa=""></use></svg> <div class="share-popup" data-v-b7c4e7d2=""><ul data-v-b7c4e7d2=""><li class="share-item wechat" data-v-b7c4e7d2=""><svg class="sprite-icon share-icon icon-wechat" data-v-0f838daa="" data-v-b7c4e7d2=""><use xlink:href="#icon-wechat" data-v-0f838daa=""></use></svg> <span class="share-item-title" data-v-b7c4e7d2="">微信</span> <div class="wechat-qrcode" data-v-b7c4e7d2=""><img src="https://juejin.cn/post/6970928380812197901" class="wechat-qrcode-img" style="display:none;" data-v-b7c4e7d2=""> <span class="wechat-qrcode-title" data-v-b7c4e7d2="">微信扫码分享</span></div></li> <li class="share-item weibo" data-v-b7c4e7d2=""><svg class="sprite-icon share-icon icon-weibo" data-v-0f838daa="" data-v-b7c4e7d2=""><use xlink:href="#icon-weibo" data-v-0f838daa=""></use></svg> <span class="share-item-title" data-v-b7c4e7d2="">新浪微博</span></li> <li class="share-item qq" data-v-b7c4e7d2=""><svg class="sprite-icon share-icon icon-qq" data-v-0f838daa="" data-v-b7c4e7d2=""><use xlink:href="#icon-qq" data-v-0f838daa=""></use></svg> <span class="share-item-title" data-v-b7c4e7d2="">QQ</span></li></ul></div></div> <div class="divider" data-v-b7c4e7d2=""></div> <div class="panel-btn" data-v-b7c4e7d2=""><svg class="sprite-icon icon-report" data-v-0f838daa="" data-v-b7c4e7d2=""><use xlink:href="#icon-report" data-v-0f838daa=""></use></svg></div> <span class="tooltip" data-v-b7c4e7d2=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        沉浸阅读
      </div><span class="byte-tooltip__wrapper"><div class="panel-btn" data-v-b7c4e7d2=""><svg class="sprite-icon icon-immerse" data-v-0f838daa="" data-v-b7c4e7d2=""><use xlink:href="#icon-immerse" data-v-0f838daa=""></use></svg></div></span></span></div></div> <!----></main> <!----></div> <!----> <div class="global-component-box"><div data-v-262fe4c6="" class="alert-list alert-list"></div> <div data-v-0b2d23d8="" class="suspension-panel suspension-panel"><!----> <button data-v-0b2d23d8="" title="回到顶部" class="btn to-top-btn" style="display: none;"><svg data-v-0b2d23d8="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-0b2d23d8="" fill-rule="evenodd" clip-rule="evenodd" d="M2.75 1C2.33579 1 2 1.33579 2 1.75C2 2.16421 2.33579 2.5 2.75 2.5H13.25C13.6642 2.5 14 2.16421 14 1.75C14 1.33579 13.6642 1 13.25 1H2.75ZM7.24407 3.87287C7.64284 3.41241 8.35716 3.41241 8.75593 3.87287L13.0622 8.84535C13.6231 9.49299 13.163 10.5 12.3063 10.5H10V14C10 14.5523 9.55228 15 9 15H7C6.44772 15 6 14.5523 6 14V10.5H3.69371C2.83696 10.5 2.37691 9.49299 2.93778 8.84535L7.24407 3.87287Z" fill="#8A919F"></path></svg></button> <button data-v-0b2d23d8="" title="建议反馈" class="btn meiqia-btn" style=""><svg data-v-0b2d23d8="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-feedback"><path data-v-0b2d23d8="" fill-rule="evenodd" clip-rule="evenodd" d="M1.8252 4.002C1.8252 2.80032 2.79935 1.82617 4.00102 1.82617H12.001C13.2027 1.82617 14.1768 2.80032 14.1768 4.002V9.71628C14.1768 10.918 13.2027 11.8921 12.001 11.8921H9.43308L6.92709 14.1281C6.4455 14.5578 5.68234 14.216 5.68234 13.5706V11.8921H4.00102C2.79934 11.8921 1.8252 10.918 1.8252 9.71628V4.002ZM11.2414 7.86753C11.3826 7.65526 11.3249 7.36878 11.1126 7.22764C10.9004 7.08651 10.6139 7.14417 10.4728 7.35643C9.94042 8.15705 9.03153 8.68309 7.99997 8.68309C6.96841 8.68309 6.05952 8.15705 5.52719 7.35643C5.38605 7.14417 5.09957 7.08651 4.88731 7.22764C4.67504 7.36878 4.61738 7.65526 4.75852 7.86753C5.45467 8.91452 6.64645 9.60617 7.99997 9.60617C9.35349 9.60617 10.5453 8.91452 11.2414 7.86753Z" fill="#1E80FF"></path></svg></button></div> <!----> <!----> <!----> <!----> <!----></div> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----></div></div></div><script>window.__NUXT__=(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){u.loading=a;u.skeleton=b;u.cursor=f;u.data=[];u.total=d;u.hasMore=b;return {layout:"default",data:[{skipSSR:a,additionalDataUseCSR:b}],fetch:[{bdPageUrlForNav:"https:\u002F\u002Fbd.juejin.cn?utm_campaign=bd&utm_source=web&utm_medium=nav",queryString:e,isShowUserDropdownList:a,isShowAddMoreList:a,isFocus:a,isPhoneMenuShow:a,visibleBadge:a,placeholder:e,hiddenProperty:"hidden",searchHistoryVisible:a,searchHistoryItems:[],tabBadge:c,isChangePlaceholder:b,showMallBridge:a,isGuideLoginHeaderVisible:a,loginGuideTimer:c,loginGuideStartTime:d,loginGuideNextTime:d,needLoginGuide:a},{articleBanner:{url:"https:\u002F\u002Fjuejin.cn\u002Fextension\u002F?utm_source=standalone&utm_medium=post&utm_campaign=extension_promotion",title:"安装掘金浏览器插件",content:"多内容聚合浏览、多引擎快捷搜索、多工具便捷提效、多模式随心畅享，你想要的，这里都有！"},showExtension:b}],error:c,state:{view:{activityIndex:{activityList:[],pageInfo:{hasNextPage:a,endCursor:e},afterPosition:e,activityListIsLoading:b,activityListIsError:a,userActivityList:[],placeholder:e,actionType:{FETCH:"@\u002Fview\u002Factivity-index\u002FFETCH",FETCH_RECOMMEND_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_RECOMMEND_LIST",RESET_ACTIVITY_LIST:"@\u002Fview\u002Factivity-index\u002FRESET_ACTIVITY_LIST",FETCH_USER_ACTIVITY_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_USER_ACTIVITY_LIST",FETCH_NEW_COUNT:"@\u002Fview\u002Factivity-index\u002FFETCH_NEW_COUNT",DELETE_ACTIVITY:"@\u002Fview\u002Factivity-index\u002FDELETE_ACTIVITY",TOGGLE_FOLLOW_USER:"@\u002Fview\u002Factivity-index\u002FTOGGLE_FOLLOW_USER",FETCH_ENTRY_COMMENT_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_ENTRY_COMMENT_LIST",UPDATE_LIST_LOADING:"@\u002Fview\u002Factivity-index\u002FUPDATE_LIST_LOADING",RESET:"@\u002Fview\u002Factivity-index\u002FRESET"},hotList:{list:[],after:e,loading:a,hasNextPage:a,actionType:{UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FFETCH",RESET:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FRESET"}},sidebar:{bannerList:[],actionType:{RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FRESET",UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FUPDATE_STATE",FETCH_BANNER:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FFETCH_BANNER"},recommend:{pageSize:h,page:d,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FRESET"},after:d},followed:{pageSize:h,page:d,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FRESET"},after:d},recommendPin:{list:[],after:e,loading:a,hasNextPage:b,actionType:{UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FFETCH",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FRESET"}}},topicPinList:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FRESET"},topicId:e,navList:[{type:k,name:k,title:"推荐 ",id:k},{type:l,name:l,title:"热门 ",id:l},{type:s,name:s,title:"关注 ",id:s},{type:i,name:"opensource",title:"开源推荐 ",id:"5c09ea2b092dcb42c740fe73"},{type:i,name:"recruitment",title:"内推招聘",id:"5abb61e1092dcb4620ca3322"},{type:i,name:"dating",title:"掘金相亲",id:"5abcaa67092dcb4620ca335c"},{type:i,name:"slacking",title:"上班摸鱼",id:"5c106be9092dcb2cc5de7257"},{type:i,name:"app",title:"应用安利",id:"5b514af1092dcb61bd72800d"},{type:i,name:"tool",title:"开发工具",id:"5abb67d2092dcb4620ca3324"},{type:i,name:"news",title:"New资讯",id:"5c46a17f092dcb4737217152"}],sortType:t}},search:{search_result_from:d,query:e,list:[],linkList:[],loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fsearch\u002FFETCH",FETCH_MORE:"@\u002Fview\u002Fsearch\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fsearch\u002FRESET"}},columnIndex:{list:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FRESET"},sort:m,category:"all"},hotList:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FUPDATE",FETCH:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFETCH_MORE",RESET:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FRESET"}}},timelineIndex:{tdkTemplates:[],categoryNavList:[],tagNavList:[],splitTagList:[],timelineAdList:[],list:[],sort:t,category:k,categoryId:e,tagId:e,tag:"全部",actionType:{FETCH_TIMELINE_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_TIMELINE_LIST",FETCH_CATEGORY_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_CATEGORY_LIST",FETCH_TAG_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_TAG_LIST",DELETE_ENTRY:"@\u002Fview\u002FtimelineIndex\u002FDELETE_ENTRY",DELETE_USER_ENTRIES:"@\u002Fview\u002FtimelineIndex\u002FDELETE_USER_ENTRIES",DELETE_TAG_ENTRIES:"@\u002Fview\u002FtimelineIndex\u002FDELETE_TAG_ENTRIES",FETCH_MORE:"@\u002Fview\u002FtimelineIndex\u002FFETCH_MORE",FETCH:"@\u002Fview\u002FtimelineIndex\u002FFETCH",RESET:"@\u002Fview\u002FtimelineIndex\u002FRESET"},serverRenderTimelineList:a,timelineList:{list:[],cursor:f,skeleton:b,loading:a,hasMore:b,categoryId:e,tagId:e,sort:e,actionType:{UPDATE_STATE:"timeline-list\u002FUPDATE_STATE",FETCH_MORE:"timeline-list\u002FFETCH_MORE",FETCH:"timeline-list\u002FFETCH",RESET:"timeline-list\u002FRESET"}},recommendList:{list:[],cursor:f,loading:a,skeleton:b,hasMore:b,actionType:{UPDATE_STATE:"recommend-list\u002FUPDATE_STATE",FETCH_MORE:"recommend-list\u002FFETCH_MORE",FETCH:"recommend-list\u002FFETCH",RESET:"recommend-list\u002FRESET"}},followingList:{list:[],cursor:f,skeleton:b,loading:a,hasMore:b,actionType:{UPDATE_STATE:"following-list\u002FUPDATE_STATE",FETCH_MORE:"following-list\u002FFETCH_MORE",FETCH:"following-list\u002FFETCH",RESET:"following-list\u002FRESET"}}},subscribe:{subscribed:{list:[],cursor:f,skeleton:b,loading:a,hasMore:a,actionType:{UPDATE_STATE:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FFETCH_MORE",FETCH:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FFETCH",RESET:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FRESET"}},all:{list:[],cursor:f,loading:a,skeleton:b,hasMore:a,linkList:e,actionType:{UPDATE_STATE:"view\u002Fsubscribe\u002Fall\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fsubscribe\u002Fall\u002Flist\u002FFETCH_MORE",FETCH:"view\u002Fsubscribe\u002Fall\u002Flist\u002FFETCH",RESET:"view\u002Fsubscribe\u002Fall\u002Flist\u002FRESET"}}},entryPublic:{entry:{user:{}},relatedEntryList:[],relatedCollectionList:[],actionType:{FETCH:"@\u002Fview\u002FentryPublic\u002FFETCH",RESET:"@\u002Fview\u002FentryPublic\u002FRESET"}},user:{user:{},serverRendered:a,userAnnuals:[],actionType:{FETCH:"@\u002Fview\u002Fuser\u002FFETCH",RESET:"@\u002Fview\u002Fuser\u002FRESET",UPDATE:"@\u002Fview\u002Fuser\u002FUPDATE",FETCH_ANNUALS:"@\u002Fview\u002Fuser\u002FFETCH_ANNUALS"},detailList:{actionType:{RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FRESET"},likeList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FRESET"}},postList:{list:[],hasMore:a,skeleton:a,loading:a,sort:m,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FRESET"}},searchList:{list:[],hasMore:a,skeleton:a,loading:a,key_word:e,search_type:d,cursor:f,isPostSearch:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FsearchList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FsearchList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FsearchList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FsearchList\u002FRESET"}},tagList:{list:[],loading:a,skeleton:b,hasMore:a,cursor:f,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FRESET"}},collectionList:{list:[],userId:e,skeleton:b,hasMore:a,cursor:f,type:"created",loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FRESET",TOGGLE_FOLLOW_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FTOGGLE_FOLLOW_COLLECTION",FOLLOW_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFOLLOW_COLLECTION",UNFOLLOW_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FUNFOLLOW_COLLECTION",DELELTE_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FDELELTE_COLLECTION",ADD_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FADD_COLLECTION",EDIT_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FEDIT_COLLECTION"}},followerList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FRESET"}},followingList:{list:[],cursor:f,hasMore:a,skeleton:a,loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FRESET"}},followingTeamsList:{list:[],cursor:f,hasMore:a,skeleton:a,loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingTeamsList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingTeamsList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingTeamsList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingTeamsList\u002FRESET"}},activityList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FRESET"}},bookList:{list:[],cursor:f,skeleton:b,hasMore:a,loading:a,type:"bought",actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FRESET"}},pinList:{list:[],hasMore:a,loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FRESET"}},courseList:{list:[],hasMore:a,loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FRESET"}},pinPraisedList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FRESET"}},eventList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FRESET"}},selfColumnList:{list:[],hasMore:a,skeleton:a,loading:a,cursor:f,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnList\u002FRESET"}},columnFollowedList:{list:[],hasMore:a,skeleton:a,loading:a,cursor:f,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FRESET",FILTER:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FFILTER"}},realtimes:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FRESET",DELETE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FDELETE"}},realtimeliked:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FRESET",DELETE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FDELETE"}}}},tag:{tag:{},actionType:{FETCH:"@\u002Fview\u002Ftag\u002FFETCH",FETCH_LIST:"@\u002Fview\u002Ftag\u002FFETCH_LIST",RESET:"@\u002Fview\u002Ftag\u002FRESET"},list:{list:[],cursor:f,loading:a,skeleton:a,hasMore:a,actionType:{UPDATE_STATE:"@\u002Fview\u002Ftag\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Ftag\u002Flist\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Ftag\u002Flist\u002FFETCH",RESET:"@\u002Fview\u002Ftag\u002Flist\u002FRESET"}}},notification:{user:{actionType:{READ_ALL:"@\u002Fview\u002Fnotification\u002Fuser\u002FREAD_ALL",RESET:"@\u002Fview\u002Fnotification\u002Fuser\u002FRESET"},listState:{list:[],cursor:f,hasMore:a,isLoading:a,messageType:3,msgTotal:d,msgSubMap:{"1":d,"2":d,"3":d,"4":d}},list:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FRESET"}}},system:{actionType:{READ_ALL:"@\u002Fview\u002Fnotification\u002Fsystem\u002FREAD_ALL",RESET:"@\u002Fview\u002Fnotification\u002Fsystem\u002FRESET"},list:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FRESET"}}}},column:{renderPost:b,serverRenderList:a,column:{id:w},entry:{id:w,screenshot:void 0,liked:a,article_id:w,article_info:{article_id:w,user_id:"465848663023160",category_id:"6809637769959178254",tag_ids:[6809640862281105000],visible_level:d,link_url:e,cover_image:"https:\u002F\u002Fp1-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fd4bb10c70f334eaeada95a0520e002c5~tplv-k3u1fbpfcp-watermark.image",is_gfw:d,title:"Groovy AST 之旅",brief_content:"探讨 Groovy 基于 AST 变换的编译时元编程技术，我们自实现\"lombok\"将并非一件难事。",is_english:d,is_original:g,user_index:5.220389307302731,original_type:d,original_author:e,content:e,ctime:"1623045789",mtime:"1623060257",rtime:"1623060257",draft_id:"6970924582714736670",view_count:1389,collect_count:g,digg_count:g,comment_count:d,hot_index:70,is_hot:d,rank_index:.00034579,status:n,verify_status:g,audit_status:n,mark_content:"---\nhighlight: an-old-hope\ntheme: hydrogen\n---\n# 8. 编译时元编程\n\n编译器在将我们的源码编译成字节码之前，会率先将源代码转换为 AST ( Abstract Syntax Tree，抽象语法树 )，以便于语义分析。而 Groovy 提供的编译时元编程工具使得**我们能够在编译器产出真正的字节码之前截获源代码的 AST，并对其修改**。从用户的视角而言，和运行时元编程相比，编译时元编程的修改是 \"潜移默化\" 的。并且由于编译器早在编译期间就做了一些额外的注入工作，这也使得 Groovy 代码在运行期的效率得到一定提升 ( 用户不需要在运行期间做一些动态注入 ) 了。\n\n我们早就体验过编译期元编程为我们带来的便捷：比如笔者在 Groovy 开篇提到的各种懒人注解：`@Lazy`，`@Immutable`，以及 Groovy 默默为我们生成的各种 GET\u002FSET 方法。对了，或许你还会联想到注入 Lombok 这样的工具，它虽并非 Groovy 实现的，但是也一定使用到了其它的编译时元编程技术。\n\n在本专题中，所有的源代码都是 `Groovy` 脚本形式。我们将在 `Groovy` 脚本的编译期间实现代码导航，方法拦截，乃至方法注入。下面有一些可供参考的链接：\n\n[Groovy doc 官方教程](http:\u002F\u002Fgroovy-lang.org\u002Fmetaprogramming.html#xform-ASTTest) | [Groovy 元编程练习教程:melix.github.io](http:\u002F\u002Fmelix.github.io\u002Fast-workshop\u002F) | [youtube 视频教程 (自备梯子)](https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=GVfrNwTBpUM)\n\n笔者在一个 Maven 项目中演示例子，且项目的 JDK 为 8+，为了兼容 Groovy 的运行，需添加以下依赖：\n\n```xml\n\u003Cdependencies\u003E\n    \u003Cdependency\u003E\n        \u003CgroupId\u003Ejavax.xml.bind\u003C\u002FgroupId\u003E\n        \u003CartifactId\u003Ejaxb-api\u003C\u002FartifactId\u003E\n        \u003Cversion\u003E2.3.1\u003C\u002Fversion\u003E\n    \u003C\u002Fdependency\u003E\n\n    \u003Cdependency\u003E\n        \u003CgroupId\u003Eorg.glassfish.jaxb\u003C\u002FgroupId\u003E\n        \u003CartifactId\u003Ejaxb-runtime\u003C\u002FartifactId\u003E\n        \u003Cversion\u003E2.3.1\u003C\u002Fversion\u003E\n    \u003C\u002Fdependency\u003E\n\u003C\u002Fdependencies\u003E\n```\n\n## 8.1 Groovy AST\n\n在 Groovy 中，某个 Groovy 脚本的 AST 可以包含：ClassNode ( 代表脚本自身的编译类节点)，Constructors ( 构造器 )，Methods ( 方法 )。\n\nMethods 包含了众多 Method 节点。节点本身记载了关于此方法所有必要的信息。Method 的语句块由各种类型的 Statement 聚合而成，并最终以 BlockStatement 的形式保存 ( 根据 Groovy 源代码的描述，BlockStatement 被认为是 Statement 的一种子类继承 )。综上所述，语句可以大致分为以下内容：\n\n1. 表达一个普通表达式调用语句的 ExpressionStatement。\n2. 分支语句 IfStatement，\n3. 选择语句 SwitchStatement。\n4. 循环语句 ForStatement。\n5. 表示返回语句的 ReturnStatement。\n6. 以任意形式聚合以上各种语句的语句块 BlockStatement。\n7. 特殊的空语句块 Empty Statement。\n\nIfStatement，SwitchStatement，ForStatement，ReturnStatement 可以理解成以特定结构聚合 ExpressionStatement 的语句块，而 BlockStatement 则是广义的语句块。那么显然 **ExpressionStatement 是构建其它 Statement 的基础**，也是最常见的语句形式。每一条 ExpressionStatement 都可以由各种 Expression ( 表达式 ) 组合而成。 这些表达式又可以细化为：\n\n1. PropertyExpression，用于表示一个属性访问的表达式。\n2. UnaryExpression，表示一个一元表达式，如 `!`，`~`。\n3. BinaryExpression，表示一个二元表达式。\n4. TenaryExpression，表示一个三元表达式，如 `?:`。\n5. MethodCallExpression，表示一个方法调用，比较常见。\n6. Declaration Expression，表示一个赋值运算。\n\n若再向下细分，Expression 便是各种类型的 Variable ( 变量 )，Constant ( 常量 ) ，Token ( 操作符 ) ，或者其它多个 Expression 的组合。\n\n比如说，每一个方法是一个 MethodCallExpression，它向下拥有一个表示方法调用者的 Variable 节点，表示调用方法名的 Constant 节点，表示参数列表的 ArgumentList 节点。显然，ArgumentList 是一个 X 叉子树，X 是参数的个数。参数本身可以是表达式，可以是变量，或者是常量。\n\n其它 Expression 根据自身的语义不同，各种常量变量的组合方式也各不相同。但是，审视这些内容，我们可以发现它们是语言无关的，因此易得 AST 语法树本身也是语言无关的。任何源代码总是能抽象成 AST 的形式。只要你愿意，甚至可以从一段 Groovy 的逻辑中提取出 AST ，然后利用元编程技术将它翻译成等价的 C++ 代码，以此来提高程序的运行速度 ( 这个过程可以描述为 Groovy CST -\u003E AST -\u003E C++ CST )。\n\n**在 Groovy 的 AST 中，上述的所有 AST 节点有一个共同基类，那就是 org.codehaus.groovy.ast.ASTNode**。\n\n上文提到了太多的 Statement 或者是 Expression 类型，这一定程度上增加了设计 AST 的难度，但我们不需要对这些概念死记硬背。有一个实用工具 GroovyConsole：它是安装 Groovy 的 \"赠品\"，存放在 Groovy PATH 的 `bin` 目录下。\n\n笔者发现 Groovy 3.0.8 版本的 GroovyConsole 在更高版本的 JDK 环境中启动会出现错误：`Could not find or load main class org.codehaus.groovy.tools.GroovyStarter` 。为了解决这个问题，这里通过修改本机环境变量的方式暂时将本机 JDK 版本回退到 8。\n\n解决了以上小麻烦之后，只需要在控制台输入 `groovyConsole` 就可以唤起其 GUI 。可以在面板中粘贴一段代码，然后通过 `Ctrl`  + `T` 的方式打开 AST 分析窗口 Groovy AST Browser。当 GroovyConsole 面板的代码更新时，只需要按 `F5` 刷新即可。**利用这个工具，我们后期就不需要自己在纸上写写画画来手动构建一段 AST 。** 在设计复杂的 AST 变换时，这尤为有用。\n\n面板代码对应的 AST 结构可以在 `ClassNode -\u003E Methods -\u003E MethodNode - run -\u003E BlockStatement` 那里找到。\n\n![GroovyConsole](https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F45decb567ba94ad4b7ff6e19968e79f5~tplv-k3u1fbpfcp-watermark.image)\n\n这是一个平平无奇的控制台输出：`print shout?msg.toUpperCase():msg`。从语句类型来看，它是一个普通的 ExpressionStatement。这个语句只涉及一个简单的 MethodCallExpression，因为外层是一个对 `this.prinln` 方法的调用[^为什么不是System.out？]。 `print` 方法的参数是一个较为复杂的三元表达式。在 Groovy Console 工具中，它是这样显示的：\n\n![Groovy AST Browser](https:\u002F\u002Fp6-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F9c3b9b5a8c6d492190101d59047f9bf8~tplv-k3u1fbpfcp-watermark.image)\n\n## 8.2 从进行 AST 树检查开始\n\n\u003E 先不要着急想着对 AST 进行一番魔改，不如首先通过一个简单的 AST 检查的例子一窥 Groovy 脚本的 AST 结构 —— 在修改 AST 之前，至少得学会如何定位到想要修改的部分。\n\n从一个例子开始直接说起。我们受够了同事在团队项目中制造的代码异味[^味道有多大？]。与其在事后人工 review 代码，不如让编译器提前进行异味检查，如检测一些不规范的方法命名，参数命名 ( 尤其是使用一个字母 `a` 或 `b` 命名方法这种令其它同事深恶痛绝的行为) ，并对这些不规范的行为施加惩戒 —— 比如说抛出异常并拒绝执行。\n\n举个例子，现在随手创建一个 Groovy 脚本，然后随手在里面定义一个方法。\n\n```groovy\n\u002F\u002F a for what?\n\u002F\u002F p for what?\ndef a(p){\n    println p\n}\n\n\u002F\u002F 这段 Groovy 脚本可以正常编译，执行，但是毫无语义可言。\na(\"bad job\")\n```\n\n我们的目标是让编译器拦截这个随意的，语义不明的 Groovy 脚本。接下来就是利用 Groovy 的编译时元编程技术实现目标了。这分为两步：\n\n1. 找出 Groovy 脚本源代码内的所有 ClassNode 节点 ( 注意，脚本本身也是一个 ClassNode 节点 )。\n2. 在每个 ClassNode 节点内安插守卫或称观察者 Visitor，检查有关于此 ClassNode 的 Methods，Constructor，Field 等信息。\n\n除此之外，我们希望这个代码异味检查是全局性的，因此要对其**进行一个全局的 AST 变换 ( 或称检查 )**。\n\n对于第一个目标，需要创建出一个 `ASTTransformation` 接口的实现。额外的，**除非使用 ASTBudiler 工具，该接口可以使用任何一门 JVM 语言来实现**。对于第二个目标，可以创建出一个 `GroovyClassVisitor` 接口的实现。\n\n### 8.2.1 ASTTransformation\n\n该接口预留了一个用于 AST 变换的 `visit` 方法，同时还有一个配套的 `@GroovyASTTransformation` 注解，该注解告知编译器在哪个阶段发起 AST 变换。\n\n实际上，一共有九个阶段可供选择，它们分别是：初始化，解析，转换，语义分析，规范化，指令选择，class 生成，输出，结束。其中：转换 `CONVERSION`，语义分析 `SEMANTIC_ANALYSIS` 和 `CANONICALIZATION` 规范化是三个不错的时机，因为这三个阶段处于 \"既不太晚，也不太早\" 的状态。**但是，如果想要更丰富的 AST 信息，就必须在越靠后的阶段进行介入**。\n\n有关于 `visit` 的简单介绍，可以参考 Groovy Doc。[The Apache Groovy programming language - Groovy Development Kit (groovy-lang.org)](http:\u002F\u002Fwww.groovy-lang.org\u002Fapi.html)\n\n根据 Groovy Doc 的解释，`sourceUnit` 表示任意一个 `.groovy` 文件的源码。一份脚本内可以有多个类定义，故该参数称为“源单元”。`ASTNode[]` 参数一般用于基于注解的局部变换，后文会提到，在当前例子中可以放心地忽略它。\n\n在下面的例子中，程序从源单元中获取了 Groovy 脚本内部定义的所有的类的节点 `classNode`，并对准备每一个节点使用一个检查器 `MyClassVisitor` 来进行代码检查。\n\n```groovy\nimport org.codehaus.groovy.ast.ASTNode\nimport org.codehaus.groovy.control.CompilePhase\nimport org.codehaus.groovy.control.SourceUnit\nimport org.codehaus.groovy.transform.ASTTransformation\nimport org.codehaus.groovy.transform.GroovyASTTransformation\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\nclass CodeCheck implements ASTTransformation {\n    @Override\n    void visit(ASTNode[] astNodes, SourceUnit sourceUnit) {\n        sourceUnit.getAST().classes.each {\n            classNode -\u003E\n                \u002F\u002F 在源单元内定义的每一个类节点定义全部安插一个 \"导航助手\" 。\n                \u002F\u002F MyClassVisitor 的实现见后文。\n                classNode.visitContents(new MyClassVisitor())\n        }\n    }\n}\n```\n\n### 8.2.2 GroovyClassVisitor\n\n`MyClassVisitor` 内置了五个用于检查 ( 或变换 ) 的方法，它们分别用于类，构造器，字段 Field，属性 Property。如果变换的内容涉及到方方面面，那显然把不同的 AST 变换按照分类存放到这里能让代码的可读性更强一些。在 Groovy 中，Field 和 Property 两者的概念几乎重合了，两者的差异来自 Groovy 的元编程协议 MOP 带来的动态性。细微的差别可以参考 [Groovy下的field和property | kazaff's blog](https:\u002F\u002Fblog.kazaff.me\u002F2016\u002F04\u002F01\u002Fgroovy下的field和property\u002F) 。\n\nIntelliJ IDE 提供的代码提示足够我们利用已有的线索去实现目标。在此处设定：如果检查到方法名称的长度为 1，那么就抛出一个 `SyntaxException` 异常，并在控制台中给出相应信息。\n\n```groovy\nimport org.codehaus.groovy.ast.ClassNode\nimport org.codehaus.groovy.ast.ConstructorNode\nimport org.codehaus.groovy.ast.FieldNode\nimport org.codehaus.groovy.ast.GroovyClassVisitor\nimport org.codehaus.groovy.ast.MethodNode\nimport org.codehaus.groovy.ast.PropertyNode\nimport org.codehaus.groovy.syntax.SyntaxException\n\nclass MyClassVisitor implements GroovyClassVisitor{\n    \u002F\u002F 如果检查出单个字母命名的方法，就报错。\n    @Override\n    void visitMethod(MethodNode methodNode) {\n        if(methodNode.name.size() == 1) throw new SyntaxException(\n                \"single letter is forbidden\",\n                methodNode.lineNumber,\n                methodNode.columnNumber\n        )\n    }\n    \n    \u002F\u002F 在这个例子中，我们没有应用到这些方法，因此只保留空实现。\n    @Override\n    void visitClass(ClassNode classNode) {}\n    @Override\n    void visitConstructor(ConstructorNode constructorNode) {}\n    @Override\n    void visitField(FieldNode fieldNode) {}\n    @Override\n    void visitProperty(PropertyNode propertyNode) {}\n}\n\n```\n\n### 8.2.3 注册 SPI (全局变换必须注册)\n\n和前述的拓展 JDK 的做法类似，为了令 groovyc 编译器能够在编译期间发现这个 AST 变换，需要在 Maven  `resources` 目录下新建一个 `META-INF\u002Fservices` 目录，并创建一个名为 `org.codehaus.groovy.transform.ASTTransformation` 的清单。\n\n在该清单中补充 `CodeCheck` 的全限定名，它必须是实现了 `ASTTransformation` 的类，否则就不会被识别。清单内可以存在多个转换。\n\n```\ncom.i.CodeCheck\n```\n\n现在，如果试着重新编译开头的那段脚本，能发现：由于方法命名的不规范，这次编译被拦截了：\n\n```\nCaught: BUG! exception in phase 'semantic analysis' in source unit 'C:\\Users\\i\\IdeaProjects\\groovyInJdk11\\src\\main\\java\\groovy_script.groovy' single letter is forbidden @ line 2, column 1.\nBUG! exception in phase 'semantic analysis' in source unit 'C:\\Users\\i\\IdeaProjects\\groovyInJdk11\\src\\main\\java\\groovy_script.groovy' single letter is forbidden @ line 2, column 1.\n\tat java.base\u002Fjdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base\u002Fjdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat java.base\u002Fjdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base\u002Fjdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base\u002Fjdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat java.base\u002Fjdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat com.intellij.rt.execution.application.AppMainV2.main(AppMainV2.java:131)\nCaused by: org.codehaus.groovy.syntax.SyntaxException: single letter is forbidden @ line 2, column 1.\n\tat java.base\u002Fjdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat java.base\u002Fjdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n\tat java.base\u002Fjdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat astTest.MyClassVisitor.visitMethod(MyClassVisitor.groovy:25)\n\tat astTest.CodeCheck$_visit_closure1.doCall(CodeCheck.groovy:15)\n\tat java.base\u002Fjdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base\u002Fjdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat java.base\u002Fjdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat astTest.CodeCheck.visit(CodeCheck.groovy:13)\n\t...\n```\n\n这是一个全局的 AST 变换，它对于项目内的所有 Groovy 代码全部生效。\n\n## 8.3 基于 AST 全局变换的方法拦截\n\n下面是另一个全局 AST 变换的演示，还是直接从例子开始讲起。有这样一段 Groovy 脚本，脚本内有一处 `CheckingAccountUsing` 的类定义：\n\n```groovy\nclass CheckingAccountUsing {\n    def audit(int amount){println \"audit...\"}\n    \u002F\u002F 希望当执行的金额 \u003E10000 时，进行 audit 审计。\n    def deposit(int amount){println \"deposit \\$$amount.\"}\n    def withdraw(int amount){println \"withdraw \\$$amount.\"}\n}\n\ndef account = new CheckingAccountUsing()\n\u002F\u002F 取出一万零一块钱。\naccount.withdraw(10001)\n```\n\n我们希望 `CheckingAccountUsing` 内定义的任何方法 ( 除了 `audit` 方法本身 ) 当检测到操作的金额大于 10000 时，实例能够自动调用 `audit` 方法进行审计。基于之前各种 Execute Method Around 模式，运行时方法注入等手段，实现这个目的已经不是什么难事。不过这一次，这个 AOP 的实现将交付给编译器。\n\n首先另创建一个 `ASTTransformation` 的实现类，然后进入到 `visit` 方法内实现我们的思路。第一步，从源单元 `sourceUnit` 中定位到脚本内定义的 `CheckingAccountUsing` 类，然后从它的 Methods 节点中翻找出所有除了 `auduit` 以外的方法节点 MethodNode 。注意，如果不小心对 `audit` 方法节点注入了 `audit` 方法，这会无意中设置一个无限循环的程序陷阱。\n\n注入的详细步骤被封装成了 `injectMethodWithAudit` 方法，见下文。\n\n```groovy\ndef targetClass = sourceUnit.getAST().classes.find {\n    \u002F\u002F 找出想要变换的类\n    it.name == \"astTest.CheckingAccountUsing\"\n}\ndef nonAuditMethods = targetClass?.methods?.findAll {\n    \u002F\u002F 找出想要变换的方法\n    it.name != \"audit\"\n}\nnonAuditMethods?.each { injectMethodWithAudit(it) }\n```\n\n现在进入到了待实现的 `injectMethodWithAudit` 方法内部。后面的思路是，我们需要在每个 MethodNode 的 BlockStatement 节点内部，安插一段这样的逻辑：\n\n```groovy\n\u002F\u002F amount 来自于 deposit 或者是 withdraw 方法的参数。\nif(amount\u003E10000){\n    audit(amount)\n}else{\n    println(\"no need to audit\")\n}\n```\n\n这段语句的 AST 树该如何表示呢？人工分析一定会比较麻烦，尤其是对于初学 AST 的开发者而言。一个投机的办法就是 —— 将这段代码直接复制到 Groovy Console 内，然后 \"照葫芦画瓢\"。\n\n\n![if 语句块对应的 AST](https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F140bec8de10b470c9fa78156b52c678e~tplv-k3u1fbpfcp-watermark.image)\n\n将这个结构稍微整理一下，给出伪代码结构。\n\n```\nIfStatement(\n\tBooleanStatement(BinaryStatement(Variable(amount),Token(\"\u003E\"),Constant(10000)))，\n\t\u002F\u002F 表示条件为 true\n\tExpressionStatement(\n\t\tMethodCallStatement(\n\t\t\t'this','audit',Variable('amount')\n\t\t)\n\t)\n\t\u002F\u002F 表示条件为 false\n\tExpressionStatement(\n\t\tMethodCallStatement(\n\t\t\t'this','print',Variable('No need to audit')\n\t\t)\n\t)\n)\n```\n\n由于 if 和 else 块内只有一行语句，因此在这里可以直接传入 ExpressionStatement。在更一般的情形中，如果块内包含了多条语句，那么就必须要选择 BlockStatement，然后将多条 ExpressionStatement 组织为链表的形式放入其中。或者，条件分支没有 else 时，那么 else 块实际上为空。此时需要选择 EmptyStatement，而不是直接传入一个 `null`。\n\n这些节点都是 `org.codehaus.groovy.ast.*` 包中确切存在的类 ( 在构建的过程中，IDE 可能还会提供其他包的同名类，不要选错了 ) 。当构建好一个蓝图之后，剩下的工作就是将这段逻辑使用源代码去实现。\n\n```groovy\n\u002F\u002F condition\ndef condition = new BooleanExpression(\n    new BinaryExpression(\n        new VariableExpression('amount'),\n        \u002F\u002F org.codehaus.groovy.syntax.Types\n        \u002F\u002F org.codehaus.groovy.syntax.Token\n        \u002F\u002F 经过实践证明，startLine 和 startColumn 的设置不会影响构建 AST，在此处全部设置为 -1.\n        Token.newSymbol(Types.COMPARE_GREATER_THAN, -1, -1),\n        new ConstantExpression(10000, true)\n    )\n)\n\n\u002F\u002F 构造 this.audit(amount)\ndef ifBlock = new ExpressionStatement(\n    new MethodCallExpression(\n        new VariableExpression('this'),\n        'audit',\n        new ArgumentListExpression(\n            new VariableExpression('amount')\n        )\n    )\n)\n\n\u002F\u002F 没有 else 块则使用 EmptyStatement() 代替。\n\u002F\u002F def elseBlock = new EmptyStatement()\n\u002F\u002F this.println(\"No need to audit\")\ndef elseBlock = new ExpressionStatement(\n    new MethodCallExpression(\n        new VariableExpression('this'),\n        'println',\n        new ArgumentListExpression(\n            new ConstantExpression(\"No need to audit\")\n        )\n    )\n)\n\ndef insert = new IfStatement(condition , ifBlock, elseBlock)\n```\n\n其中，二元符号 ( 这里需要一个表示大于的 `\u003E` 符号 ) 需要借助 `org.codehaus.groovy.syntax` 包下的 `Types` 和 `Token` 类创建。如果需要其它表达符号，可以进入到源代码内进行查看。\n\n初次尝试 AST 语法变换是比较困难的事情，但是 IntelliJ IDE 给出的代码提示也足够用了。在创建各个 XXXStatement 实例时，可以多加留意每个 Statement 的创建需要哪些内容。最终的 `insert` 代表了我们想要插入的那段 `if` 语句块。最后的工作则是将它插入到原方法节点的 BlockStatement 内部。\n\n```groovy\n((BlockStatement)methodNode.code).statements.add(0, insert)\n\u002F\u002F 更偷懒的写法是:\n\u002F\u002F methodNode.code.statements.add(0,insert)，不过 IDE 无法对此给出代码提示。\n```\n\n`.statements` 实际上获得的是一组存储方法原语句块的 `List\u003CStatement\u003E` 链表，我们后文总是通过修改它来实现编译时方法注入或变换。这里将 `insert` 语句块头插入到原语句块，以此实现一个前置通知。反之，实现的则是后置通知。\n\n最后，不要忘记到 `META-INF\u002Fservices\u002Forg.codehaus.groovy.transform.ASTTransforamtion` 那里注册这个 AST 变换。当然，这个演示有明显的不合理之处：这个全局变换实际上只应用在了特定类 `CheckAccountUsing` 上，我们应用全局变换后还得特地花些功夫重新将它从源单元 `sourceUnit` 挑出来，颇有买椟还珠之嫌。在后文会介绍如何结合**注解实现一个局部 AST 变换**。\n\n从这个例子可以看出来，手动实现 AST 转换其实并非一件易事，编译时元编程明显要比运行时元编程要来的复杂。然而，它为用户提供带来的便捷可以说是一劳永逸的。\n\n## 8.4 编译期注入属性\n\n注，`ASTTransformation` 的实现者可以是任何一门 JVM 语言。如果想要增强编译器的执行效率，那么也可以使用原生的 Java 语言来实现它，或者在 Groovy Class 上加上 `@ComplieStatic` ( 但是这样就写不了动态代码了，那还不如直接使用 Java ) 。注入属性只需要两步：\n\n1. 找到目标 ClassNode 节点，调用其提供的 `addField` 增加属性方法。\n2. 构造方法的名称，修饰符，类型 ( 需要 ClassHelper 类辅助构造，详细可以翻阅源代码 )，初始值 ( Expression ) 。\n\n```groovy\nimport org.codehaus.groovy.ast.ASTNode;\nimport org.codehaus.groovy.ast.ClassHelper;\nimport org.codehaus.groovy.ast.ClassNode;\nimport org.codehaus.groovy.ast.expr.ConstantExpression;\nimport org.codehaus.groovy.control.CompilePhase;\nimport org.codehaus.groovy.control.SourceUnit;\nimport org.codehaus.groovy.transform.ASTTransformation;\nimport org.codehaus.groovy.transform.GroovyASTTransformation;\nimport java.util.List;\nimport static groovyjarjarasm.asm.Opcodes.ACC_FINAL;\nimport static groovyjarjarasm.asm.Opcodes.ACC_PUBLIC;\nimport static groovyjarjarasm.asm.Opcodes.ACC_STATIC;\n\n\u002F\u002F build from YouToBe\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\npublic class CodeBuilder implements ASTTransformation {\n    @Override\n    public void visit(ASTNode[] astNodes, SourceUnit sourceUnit) {\n        \u002F\u002F 增加字段，相当于 public static final String AUTHOR = me;\n        List\u003CClassNode\u003E classes = sourceUnit.getAST().getClasses();\n        classes.forEach(classNode -\u003E classNode.addField(\n                \"AUTHOR\",\n                ACC_PUBLIC | ACC_FINAL | ACC_STATIC,\n                ClassHelper.STRING_TYPE,\n                new ConstantExpression(\"me\")\n        ));\n    }\n}\n```\n\n## 8.5 编译期注入方法\n\n我们已经了解如何利用 AST 对已有的方法进行改造。结合编译期注入属性章节，现在不妨尝试着在编译期为目标构建一个全新的方法。这需要三个步骤：\n\n1. 找到目标 ClassNode 节点，调用 `addMethod` 插入方法。\n2. 设置方法的修饰符，返回值，参数列表，异常抛出列表等。\n3. 准备好方法对应函数体的 AST。\n\n或者说，和编译期注入属性相比，额外的工作就是准备一个符合语义[^怎样算符合语义？]的 AST 以及方法的其它信息一起传入到 `addMethod` 方法内。\n\n这个例子演示了如何为所有类注入一个 `getAuthor` 方法：\n\n```groovy\nimport groovyjarjarasm.asm.Opcodes\nimport org.codehaus.groovy.ast.ASTNode\nimport org.codehaus.groovy.ast.ClassHelper\nimport org.codehaus.groovy.ast.ClassNode\nimport org.codehaus.groovy.ast.Parameter\nimport org.codehaus.groovy.ast.expr.ConstantExpression\nimport org.codehaus.groovy.ast.stmt.BlockStatement\nimport org.codehaus.groovy.ast.stmt.ExpressionStatement\nimport org.codehaus.groovy.ast.stmt.ReturnStatement\nimport org.codehaus.groovy.control.CompilePhase\nimport org.codehaus.groovy.control.SourceUnit\nimport org.codehaus.groovy.transform.ASTTransformation\nimport org.codehaus.groovy.transform.GroovyASTTransformation\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\nclass getMethodInserter implements ASTTransformation{\n    @Override\n    void visit(ASTNode[] nodes, SourceUnit source) {\n\n        \u002F\u002F 为编译期注入的方法准备语句块部分\n        BlockStatement code = new BlockStatement()\n\n        \u002F*\n        *  { return \"author:me\" }\n        *\u002F\n        def returnString = new ReturnStatement(\n            new ExpressionStatement(\n                    new ConstantExpression(\"author:me\")\n            )\n        )\n\n        \u002F\u002F 将语句插入到语句块内\n        code.addStatement(returnString)\n\n        \u002F\u002F 向各个 ClassNode 注入一个新的 Method 节点。\n        source.getAST().classes.each {\n            classNode -\u003E classNode.addMethod(\n                    \u002F\u002F 表示注入的方法名称\n                    \"getAuthor\",\n                    \u002F\u002F 修饰符\n                    Opcodes.ACC_PUBLIC,\n                    \u002F\u002F 表示返回值类型。\n                    ClassHelper.STRING_TYPE,\n                    \u002F\u002F 表示不接受参数\n                    Parameter.EMPTY_ARRAY,\n                    \u002F\u002F 表示不抛出异常\n                    ClassNode.EMPTY_ARRAY,\n                    code\n            )\n        }\n    }\n}\n```\n\n将它注册到 SPI 之后，任何一个类都可以在不改动源代码的情况下直接获得 `getAuthor` ：\n\n```groovy\nprintln new Foo().getAuthor()\n```\n\n当然，根据 Groovy 的统一访问原则，对于 `getXXX` 方法可以直接作为一个属性访问：\n\n```groovy\nprintln new Foo().author\n```\n\n## 8.6 基于注解的局部变换\n\n\u003E 本章需要对 Java 注解的创建有一个基本认识，具体可查阅笔者的 [简单回顾Java注解 (juejin.cn)](https:\u002F\u002Fjuejin.cn\u002Fpost\u002F6844904164988813325#heading-6) 。\n\n到目前为止，所有的案例全都是全局的 AST 变换。如果这个 AST 并不是通用的，那么它最好是局部变换而非全局变换。\n\n一个好的解决方案是将一个 AST 变换和一个标记型注解关联起来 ( 后文为了方便叙述，称这样的注解为 trigger 注解 )。这样，编译器如果在解析类的过程中发现了这些注解，那么就能够根据线索对标记类进行指定的 AST 变换，而被未标记的类则不会受到任何影响。和全局 AST 变换的另一个显著区别是：**局部变换不需要注册到 SPI 接口**，**如果不小心这么做了，那么程序反而会报错**。\n\n现在创建一个 `Messenger` 注解，并为它赋予这样的功能：一旦类的定义被该注解标记，那么编译期这个类就会新增一个 `message` 方法。该方法接收一个字符串，并将它输出到控制台。同时，`Messenger` 注解有一个 `boolean` 类型的选项：`shout`。如果该值为 `true`，那么 `message` 方法在输出到控制台之前，会将字符串内的英文全部转换为大写形式，否则，不采取任何额外操作。\n\n一个 Java 注解至少需要两个元注解 `@Retention` 和 `@Target`。除此之外，这里需要额外标记一个元注解 `GroovyASTTransformClass` 去关联指定的 AST 变换。\n\n```groovy\n\u002F\u002F 这个注解仅在编译期用于生成方法，因此生命周期保持到源码级别即可。\n@Retention(RetentionPolicy.SOURCE)\n\u002F\u002F 指定这是个标记在类上面的注解。\n@Target(ElementType.TYPE)\n\u002F\u002F 将该注解和指定的 AST 变换关联起来。\n@GroovyASTTransformationClass(classes = MessageAdderAstTransformation.class)\npublic @interface Messenger {\n    boolean shout() default false;\n}\n```\n\n下一步便是实现这个 `MessageAdderAstTransformation` 。再次提醒，在局部变换中，这个 AST 变换不需要注册到 SPI 接口。\n\n```groovy\nimport groovyjarjarasm.asm.Opcodes;\nimport org.codehaus.groovy.ast.*;\nimport org.codehaus.groovy.ast.expr.*;\nimport org.codehaus.groovy.ast.stmt.ExpressionStatement;\nimport org.codehaus.groovy.control.CompilePhase;\nimport org.codehaus.groovy.control.SourceUnit;\nimport org.codehaus.groovy.transform.AbstractASTTransformation;\nimport org.codehaus.groovy.transform.GroovyASTTransformation;\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\npublic class MessageAdderAstTransformation extends AbstractASTTransformation {\n    @Override\n    public void visit(ASTNode[] astNodes, SourceUnit sourceUnit) {\n        \u002F*\n        `nodes` - The ASTnodes when the call was triggered.\n        Element 0 is the AnnotationNode that triggered this annotation to be activated.\n        Element 1 is the AnnotatedNode decorated, such as a MethodNode or ClassNode.\n        For global transformations it is usually safe to ignore this parameter.\n         *\u002F\n        \u002F\u002F 这里的类型来自 org.codehaus.groovy.ast.* .\n        AnnotationNode msgAnnotation = (AnnotationNode) astNodes[0];\n        \n        \u002F\u002F 从注解中获取 shout 选项的值并设定为常量 (因为是编译期就设定好的值)。\n        \u002F\u002F 它将决定 message 如何操作。\n        ConstantExpression shout = (ConstantExpression) msgAnnotation.getMember(\"shout\");\n        ClassNode annotatedClass = (ClassNode) astNodes[1];\n\t\t\n        \u002F\u002FTODO \n    }\n}\n```\n\n在以往全局变换的例子中，我们总是从源单元 `sourceUnit` 获取源码的 AST 树。但在局部变换中，使用第一个参数更合适一些。`astNodes` 参数只有固定的两个元素，下面是 Groovy Doc 的提供的解释：\n\n1. `astNodes[0]` 代表了能够引发 AST 变换的 trigger 注解，可以从该元素中提取 trigger 注解内部的信息。\n2. `astNodes[1]` 代表了被 trigger 注解标记的 ClassNode，可以从该元素中提取出被 trigger 注解标记的类的 AST 树并施加变换。\n\n显然，每一个局部 AST 变换只会和一个 trigger 注解关联，这是 `@GroovyASTTransformationClass` 元注解里定义的。这里为了方便操作，将 `astNodes[0]` 强制转换为 AnnotationNode，将 `astNodes[1]` 强制转换成 ClassNode。\n\n剩下的步骤大概都比较明确了：那就是分析下面这段程序的 AST。类似的套路，如果觉得手动分析内部 AST 太过麻烦，可以直接使用 GroovyConsole 工具进行生成。\n\n```groovy\n\u002F\u002F 标识符: ACC_PUBlIC,\n\u002F\u002F 返回值: ClassHelper.VOID_TYPE\n\u002F\u002F 参数: [Parameter(ClassHelper.STRING_TYPE,\"message\")]\n\u002F\u002F 抛出异常: ClassNode.EMPTY_ARRAY ( 表示不抛出异常 )\n\u002F\u002F 语法块: {this.println(shout?message.toUpperCase:message)}\npublic void message(String message){\n    \u002F\u002F shout 是一个 boolean 值，源自于 Messengers 注解。\n    this.println(shout?message.toUpperCase:message)\n}\n```\n\n完整的代码如下：\n\n```groovy\npackage astTest.javaImpl;\n\nimport groovyjarjarasm.asm.Opcodes;\nimport org.codehaus.groovy.ast.*;\nimport org.codehaus.groovy.ast.expr.*;\nimport org.codehaus.groovy.ast.stmt.ExpressionStatement;\nimport org.codehaus.groovy.control.CompilePhase;\nimport org.codehaus.groovy.control.SourceUnit;\nimport org.codehaus.groovy.transform.AbstractASTTransformation;\nimport org.codehaus.groovy.transform.GroovyASTTransformation;\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\npublic class MessageAdderAstTransformation extends AbstractASTTransformation {\n    @Override\n    public void visit(ASTNode[] astNodes, SourceUnit sourceUnit) {\n        \u002F*\n        `nodes` - The ASTnodes when the call was triggered.\n        Element 0 is the AnnotationNode that triggered this annotation to be activated.\n        Element 1 is the AnnotatedNode decorated, such as a MethodNode or ClassNode.\n        For global transformations it is usually safe to ignore this parameter.\n         *\u002F\n        \u002F\u002F 这里的类型来自 org.codehaus.groovy.ast.* .\n        AnnotationNode msgAnnotation = (AnnotationNode) astNodes[0];\n        ConstantExpression shout = (ConstantExpression) msgAnnotation.getMember(\"shout\");\n        ClassNode annotatedClass = (ClassNode) astNodes[1];\n\n        \u002F\u002F 这个局部变量 message 和构造的函数体的 message 变量相对应。\n        VariableExpression message = new VariableExpression(\"message\");\n        MethodCallExpression toUpperCaseCall = new MethodCallExpression(message, \"toUpperCase\", ArgumentListExpression.EMPTY_ARGUMENTS);\n\n        \u002F\u002F 构造了一个这样的一条语句 statement：\n        \u002F\u002F this.println(shout?message.toUpperCase:message)\n        ExpressionStatement code = new ExpressionStatement(\n                new MethodCallExpression(new VariableExpression(\"this\"),\n                        \"println\",\n                        new TernaryExpression(new BooleanExpression(shout), toUpperCaseCall, message))\n        );\n\n\n        \u002F\u002F 创建 message\n        annotatedClass.addMethod(\"message\",\n                Opcodes.ACC_PUBLIC,\n                ClassHelper.VOID_TYPE,\n                new Parameter[]{\n                        \u002F\u002F 参数 message 和局部变量的 message 相对应。\n                        new Parameter(ClassHelper.STRING_TYPE,\"message\")\n                },\n                \u002F\u002F 指代不抛出任何异常\n                ClassNode.EMPTY_ARRAY,\n                code\n                );\n\n        \u002F*\n         最终相当于构造了这样的函数：\n         public void message(String message){\n            \u002F\u002F shout 是一个 boolean 值，源自于 Messengers 注解。\n            this.println(shout?message.toUpperCase:message)\n         }\n         *\u002F\n    }\n}\n```\n\n## 8.7 AST 杀手锏：AstBuilder\n\n**注意，一但使用 AstBuilder，那么 AST 变换就必须选择 Groovy 语言进行实现**。\n\nAstBuilder 提供了三种风格的 AST 辅助转换：`nuildFromSpec`，`buildFromString`，`buildFromCode`。我们将在一个例子中对这三种 AST 构建方式做出对比：\n\n创建一个局部 AST 变换，使得所有被名为 `@InjectAOP` 的 trigger 注解标记的类，它内部所有其它方法块内部会被注入一条调用自身 `before` 方法的语句。为了确保目标类实现了 `before` 方法，这里可以使用接口做一些强制性约束。\n\n给出 trigger 注解的实现：\n\n```groovy\npackage astBuilderTest\nimport org.codehaus.groovy.transform.GroovyASTTransformationClass;\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n@Retention(RetentionPolicy.SOURCE)\n@Target(ElementType.TYPE)\n@GroovyASTTransformationClass(classes = InjectAopASTTransformation.class)\npublic @interface InjectAOP {}\n```\n\n给出目标脚本的实现：\n\n```groovy\npackage astBuilderTest\n\n@InjectAOP\nclass Foo implements AOP{\n    @Override\n    void before() {println(\"这段逻辑会被注入到其它方法\")} \u002F\u002F 通过接口强制令该类实现 before 方法。\n    void run(){println(\"测试的方法\")}\n}\n\n\u002F\u002F 目标:执行此脚本，控制台应当输出：\n\u002F\u002F 这段逻辑会被注入到其它方法\n\u002F\u002F 测试的方法\nnew Foo().run()\n```\n\n核心目标是 `InjectAopASTTransformation` 的实现。首先给出传统实现：\n\n```groovy\npackage astBuilderTest\nimport org.codehaus.groovy.ast.ASTNode\nimport org.codehaus.groovy.ast.ClassNode\nimport org.codehaus.groovy.ast.expr.ArgumentListExpression\nimport org.codehaus.groovy.ast.expr.MethodCallExpression\nimport org.codehaus.groovy.ast.expr.VariableExpression\nimport org.codehaus.groovy.ast.stmt.BlockStatement\nimport org.codehaus.groovy.ast.stmt.ExpressionStatement\nimport org.codehaus.groovy.control.CompilePhase\nimport org.codehaus.groovy.control.SourceUnit\nimport org.codehaus.groovy.transform.ASTTransformation\nimport org.codehaus.groovy.transform.GroovyASTTransformation\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\nclass InjectAopASTTransformation implements ASTTransformation {\n    @Override\n    void visit(ASTNode[] nodes, SourceUnit source) {\n        def classNode = nodes[1] as ClassNode\n\n        \u002F\u002F 确保它实现了 AOP 接口。\n        \u002F\u002F 在 AST 内部，所有信息全部是 ASTNode 形式，因此需要将等待判断的 AOP 接口类型转换为 ClassNode 并比较。\n        \u002F\u002F 这和一般的判别方式有所不同。\n        def c = new ClassNode(AOP.class)\n        println classNode.interfaces.contains(c)\n\n        \u002F\u002F 找出所有其它方法\n        def methods = classNode.methods.findAll {\n            it.name != \"before\"\n        }\n\n        \u002F\u002F -------------AstBuilder 主要负责重构的部分------------------\u002F\u002F\n        def beforeCall = new ExpressionStatement(\n                new MethodCallExpression(\n                        new VariableExpression('this'),\n                        'before',\n                        ArgumentListExpression.EMPTY_ARGUMENTS\n                )\n        )\n\n        methods.each {\n            ((BlockStatement) it.code).statements.add(0, beforeCall)\n        }\n        \u002F\u002F ---------------------------------------------------------\u002F\u002F\n\n    }\n}\n```\n\n第一种：`buildFromSpec`。它本质上是创建了一个内部 DSL，使我们在创建各种 ASTNode 的过程中免去了频繁的 `new` 关键字声明。\n\n```groovy\npackage astBuilderTest\nimport org.codehaus.groovy.ast.ASTNode\nimport org.codehaus.groovy.ast.ClassNode\nimport org.codehaus.groovy.ast.builder.AstBuilder\nimport org.codehaus.groovy.ast.stmt.BlockStatement\nimport org.codehaus.groovy.ast.stmt.Statement\nimport org.codehaus.groovy.control.CompilePhase\nimport org.codehaus.groovy.control.SourceUnit\nimport org.codehaus.groovy.transform.ASTTransformation\nimport org.codehaus.groovy.transform.GroovyASTTransformation\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\nclass InjectAopASTTransformation implements ASTTransformation {\n    @Override\n    void visit(ASTNode[] nodes, SourceUnit source) {\n        def classNode = nodes[1] as ClassNode\n\n        \u002F\u002F 确保它实现了 AOP 接口。\n        \u002F\u002F 在 AST 内部，所有信息全部是 ASTNode 形式，因此需要将等待判断的 AOP 接口类型转换为 ClassNode 并比较。\n        \u002F\u002F 这和一般的判别方式有所不同。\n        def c = new ClassNode(AOP.class)\n        assert classNode.interfaces.contains(c)\n\n        \u002F\u002F 找出所有其它方法\n        def methods = classNode.methods.findAll {\n            it.name != \"before\"\n        }\n\n        \u002F\u002F -------------AstBuilder 主要负责重构的部分------------------\u002F\u002F\n        def beforeCall = new AstBuilder().buildFromSpec {\n            \u002F\u002F ExpressionStatement\n            expression {\n                methodCall {\n                    variable 'this'\n                    constant 'before'\n                    argumentList {}\n                }\n            }\n        } as List\u003CStatement\u003E\n\n        methods.each {\n            ((BlockStatement) it.code).statements.add(0, beforeCall[0])\n        }\n        \u002F\u002F ---------------------------------------------------------\u002F\u002F\n\n    }\n}\n```\n\n其 DSL 的构建方式只是在写法上减少了一点构建 AST 的负担，但是仍然要求我们熟练掌握 Groovy 提供的各种 AST 节点及其构建方式。对于不熟悉 `org.codehaus.groovy.ast` 包下各种类型的开发者而言，构建 AST 仍然是一个繁琐且困难的工作。\n\n假如有这样一个工具，能够允许我们按照日常的习惯编写源代码，然后由它自动转换为 AST 树就好了 ( 这样的话，我们甚至都不用深入了解 AST 树了! )。AstBuilder 正好解决了这个痛点。下面介绍 AstBuilder 第二种使用方式：`buildFromCode`。\n\n```groovy\npackage astBuilderTest\nimport org.codehaus.groovy.ast.ASTNode\nimport org.codehaus.groovy.ast.ClassNode\nimport org.codehaus.groovy.ast.builder.AstBuilder\nimport org.codehaus.groovy.ast.stmt.BlockStatement\nimport org.codehaus.groovy.ast.stmt.Statement\nimport org.codehaus.groovy.control.CompilePhase\nimport org.codehaus.groovy.control.SourceUnit\nimport org.codehaus.groovy.transform.ASTTransformation\nimport org.codehaus.groovy.transform.GroovyASTTransformation\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\nclass InjectAopASTTransformation implements ASTTransformation {\n    @Override\n    void visit(ASTNode[] nodes, SourceUnit source) {\n        def classNode = nodes[1] as ClassNode\n\n        \u002F\u002F 确保它实现了 AOP 接口。\n        \u002F\u002F 在 AST 内部，所有信息全部是 ASTNode 形式，因此需要将判断的 AOP 接口类型装入到 ClassNode 并比较。\n        \u002F\u002F 这和一般的判别方式有所不同。\n        def c = new ClassNode(AOP.class)\n        assert classNode.interfaces.contains(c)\n\n        \u002F\u002F 找出所有其它方法\n        def methods = classNode.methods.findAll {\n            it.name != \"before\"\n        }\n\n        \u002F\u002F -------------AstBuilder 主要负责重构的部分------------------\u002F\u002F\n        \u002F\u002F AstBuilder 独立于 InjectAopASTTransformation 进行编译。\n        def beforeCall = new AstBuilder().buildFromCode(CompilePhase.SEMANTIC_ANALYSIS){\n            this.before()\n        } as List\u003CStatement\u003E\n        \n        methods.each {\n            \u002F\u002F ((BlockStatement) it.code).statements.addAll(0,beforeCall)\n            ((BlockStatement) it.code).statements.add(0,beforeCall[0])\n        }\n       \u002F\u002F ---------------------------------------------------------\u002F\u002F\n    }\n}\n```\n\n这里有很多细节需要说明。如我们所见，`buildFromCode` 方法的闭包内允许直接放入一段代码块，我们不再需要在各种复杂的 AST 结构当中挣扎。除此之外，该方法还指明 AstBuilder 在某个阶段 ( 此处是 `CompilePhase.SEMANTIC_ANALYSIS` ) **将闭包的内代码转为等价的 AST** ( 笔者推测 AstBuilder 的 AST 变换过程和 `InjectAopASTTransformation` 的 AST 变换是分开且独立的，但是 Groovy Doc 给出的解释令我云里雾里，网上也没有足够资料 ) 。\n\n实际上，`buildFromCode` 返回的是一个抽象的 `List\u003CASTNode\u003E` 类型。为了便于操作，这里通过 `as` 符号将其转换为了 `List\u003CStatement\u003E` 类型 。 注，`as` 操作符依赖调用者的 `asType` 方法，和强制转换的概念有区别。无论我们在 `buildFromCode` 内创建了多少语句块，它们最终总是被包装为一个 BlockStatement，然后再装入到一个 List 内部。\n\n换句话说，通过访问 `beforeCall[0]` 就可以获取到 AstBuilder 为我们转换好的 AST 了。注意，一旦进入到 `buildFromCode` ( 还有后文的 `buildFromString` ) 方法的闭包内部，**IntelliJ IDE 就无法再为我们提供有效的代码提示**，甚至有时还会出现 \"误导\" 的情况。比如：上述代码块内的 `this` 可不是指代这个 AST 变换类本身，而是指代上下文中被注入的那个对象 \"that\"，调用的是 \"that\" 的 `before` 方法。\n\n第三种，`buildFromString`。这种方式和 `buildFromCode` 非常接近，只不过 AstBuilder 这一次转化的目标是 `String` 类型。\n\n```groovy\npackage astBuilderTest\nimport org.codehaus.groovy.ast.ASTNode\nimport org.codehaus.groovy.ast.ClassNode\nimport org.codehaus.groovy.ast.builder.AstBuilder\nimport org.codehaus.groovy.ast.stmt.BlockStatement\nimport org.codehaus.groovy.ast.stmt.Statement\nimport org.codehaus.groovy.control.CompilePhase\nimport org.codehaus.groovy.control.SourceUnit\nimport org.codehaus.groovy.transform.ASTTransformation\nimport org.codehaus.groovy.transform.GroovyASTTransformation\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\nclass InjectAopASTTransformation implements ASTTransformation {\n    @Override\n    void visit(ASTNode[] nodes, SourceUnit source) {\n        def classNode = nodes[1] as ClassNode\n\n        \u002F\u002F 确保它实现了 AOP 接口。\n        \u002F\u002F 在 AST 内部，所有信息全部是 ASTNode 形式，因此需要将等待判断的 AOP 接口类型转换为 ClassNode 并比较。\n        \u002F\u002F 这和一般的判别方式有所不同。\n        def c = new ClassNode(AOP.class)\n        assert classNode.interfaces.contains(c)\n\n        \u002F\u002F 找出所有其它方法\n        def methods = classNode.methods.findAll {\n            it.name != \"before\"\n        }\n\n        \u002F\u002F -------------AstBuilder 主要负责重构的部分------------------\u002F\u002F\n        \u002F\u002F AstBuilder 独立于 InjectAopASTTransformation 进行编译。\n        def info = \"println \\\"this source build by AstBuilder\\\" \"\n        def beforeCall = new AstBuilder().buildFromString(CompilePhase.SEMANTIC_ANALYSIS,\"\"\"\n            this.before()\n            ${info}\n        \"\"\") as List\u003CStatement\u003E\n        \n        methods.each {\n            ((BlockStatement) it.code).statements.add(0,beforeCall[0])\n        }\n        \u002F\u002F -------------等待 AstBuilder 重构的部分------------------\u002F\u002F\n    }\n}\n```\n\n和 `buildFromCode` 相比，它的优势是允许我们能够像拼凑 GString 一样自由地组合源代码 ( 并且不再需要关心它的 AST 结构，因为 AstBuilder 会替我们搞定 )，而缺点则是可能会遇到一些字符串转义的烦恼。\n\n## 8.8 补充：部分 AST 节点表示为 “空” 的方式\n\n如果要构造一个空语句块，则需要创建 EmptyStatement 实例。\n\n当构造 MethodCallExpression 时，如果遇到空括号方法的调用，那么参数列表应表示为 `ArgumentListExpression.EMPTY_ARGUMENTS`。\n\n当进行编译期方法构造 ( 对某个 ClassNode 调用 `addMethod` 方法 ) 时，如果此方法是空括号方法，那么参数列表应表示为 `Parameter.EMPTY_ARRAY`。如果此方法不抛出任何异常，那么应表示为 `ClassNode.EMPTY_ARRAY`。如果该方法不返回值，应表示为 `ClassHelper.VOID_TYPE`。\n\n在构造方法返回值类型，或是属性类型时，使用 Groovy 提供 ClassHelper 去完成。\n\n[^为什么不是System.out？]: Groovy 给所有的 GroovyObject 都绑定了 print 方法，因此调用者自然就是 this 。\n[^味道有多大？]: 常见的代码异味包括 Duplicated Code，Long Method，Switch Statement，以及其它可以想到的不良代码，详情可见[一些常见的代码异味 Code Smell -- 简明现代魔法 (nowamagic.net)](http:\u002F\u002Fwww.nowamagic.net\u002Flibrarys\u002Fveda\u002Fdetail\u002F2053)。\n[^怎样算符合语义？]: 比如插入方法时设定返回值为 `String`，那么该方法的 BlockStatement 的最后一个元素应当是返回字符串类型的 ReturnStatement。\n\n",display_count:d,is_markdown:g},author_user_info:{user_id:"465848663023160",user_name:"花花子",company:"新东方烹饪学校",job_title:"学生",avatar_large:"https:\u002F\u002Fp3-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002F2c3d36ac68756ea7f747669b94554d42~300x300.image",level:4,description:"浪漫主义coder",followee_count:56,follower_count:142,post_article_count:98,digg_article_count:267,got_digg_count:365,got_view_count:97822,post_shortmsg_count:3,digg_shortmsg_count:16,isfollowed:a,favorable_author:d,power:3811,study_point:1530,university:{university_id:"6888594369101152269",name:"黑龙江大学",logo:e},major:{major_id:f,parent_id:f,name:e},student_status:3,select_event_count:d,select_online_course_count:d,identity:d,is_select_annual:a,select_annual_rank:d,annual_list_type:d,extraMap:{},is_logout:d,annual_info:[],account_amount:d,user_growth_info:{user_id:465848663023160,jpower:3811,jscore:394.2,jpower_level:4,jscore_level:4,jscore_title:"进阶掘友",author_achievement_list:[],vip_level:4,vip_title:"融会贯通",jscore_next_level_score:500,jscore_this_level_mini_score:d},is_vip:b,become_author_days:d,collection_set_article_count:d},category:{category_id:"6809637769959178254",category_name:"后端",category_url:"backend",rank:g,back_ground:"https:\u002F\u002Flc-mhke0kuv.cn-n1.lcfile.com\u002Ffb3b208d06e6fe32.png",icon:"https:\u002F\u002Flc-mhke0kuv.cn-n1.lcfile.com\u002Fa2ec01b816abd4c5.png",ctime:1457483880,mtime:1432503193,show_type:3,item_type:n,promote_tag_cap:4,promote_priority:g,id:"6809637769959178254",name:"后端",title:"后端",alias:"backend"},tags:[{entriesCount:void 0,subscribed:a,id:"6809640862281105415",tag_id:"6809640862281105415",tag_name:"Groovy",color:"#000000",icon:"https:\u002F\u002Fp1-jj.byteimg.com\u002Ftos-cn-i-t2oaga2asx\u002Fleancloud-assets\u002F59e008bf567fda17a009.png~tplv-t2oaga2asx-image.image",back_ground:e,show_navi:d,ctime:1489100571,mtime:1668179383,id_type:9,tag_alias:e,post_article_count:180,concern_user_count:2512,title:"Groovy",tagId:"6809640862281105415",articleCount:180,subscribersCount:2512,createdAt:c,updatedAt:c}],user_interact:{id:6970928380812198000,omitempty:n,user_id:d,is_digg:a,is_follow:a,is_collect:a},org:{org_info:c,org_user:c,is_followed:a},req_id:"202211212240380102121680960139B93E",status:{push_status:d},author_interact:c,extra:{boost_type:e},title:"Groovy AST 之旅",user:{id:"465848663023160",self_description:void 0,followed:a,viewerIsFollowing:void 0,community:void 0,subscribedTagCount:d,wroteBookCount:d,boughtBookCount:d,isBindedPhone:a,level:4,user_id:"465848663023160",user_name:"花花子",company:"新东方烹饪学校",job_title:"学生",avatar_large:"https:\u002F\u002Fp3-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002F2c3d36ac68756ea7f747669b94554d42~300x300.image",description:"浪漫主义coder",followee_count:56,follower_count:142,post_article_count:98,digg_article_count:267,got_digg_count:365,got_view_count:97822,post_shortmsg_count:3,digg_shortmsg_count:16,isfollowed:a,favorable_author:d,power:3811,study_point:1530,university:{university_id:"6888594369101152269",name:"黑龙江大学",logo:e},major:{major_id:f,parent_id:f,name:e},student_status:3,select_event_count:d,select_online_course_count:d,identity:d,is_select_annual:a,select_annual_rank:d,annual_list_type:d,extraMap:{},is_logout:d,annual_info:[],account_amount:d,user_growth_info:{user_id:465848663023160,jpower:3811,jscore:394.2,jpower_level:4,jscore_level:4,jscore_title:"进阶掘友",author_achievement_list:[],vip_level:4,vip_title:"融会贯通",jscore_next_level_score:500,jscore_this_level_mini_score:d},is_vip:b,become_author_days:d,collection_set_article_count:d,juejinPower:3811,jobTitle:"学生",roles:{isBookAuthor:a,isFavorableAuthor:a,isCobuilder:a,isAdmin:a},username:"花花子",blogAddress:void 0,selfDescription:"浪漫主义coder",beLikedCount:365,beReadCount:97822,followerCount:142,followingCount:56,collectionCount:d,createdCollectionCount:d,followingCollectionCount:d,postedPostsCount:98,pinCount:3,likedArticleCount:267,likedPinCount:16,avatar:"https:\u002F\u002Fp3-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002F2c3d36ac68756ea7f747669b94554d42~300x300.image",latestLoginedInAt:c,createdAt:c,updatedAt:c,phoneNumber:e,titleDescription:e,followeesCount:56,applyEventCount:d,need_lead:d,followTopicCnt:void 0},viewCount:void 0,commentsCount:d,isEvent:void 0,abstract:"探讨 Groovy 基于 AST 变换的编译时元编程技术，我们自实现\"lombok\"将并非一件难事。",latestCommentAt:c,createdAt:new Date(1623045789000),updatedAt:c,isTopicEvent:a,likedCount:g,likeCount:g,content:e,originalUrl:e,type:"post",collected:a,viewsCount:1389,username:"花花子",viewerHasLiked:a,draftId:"6970924582714736670",collectionCount:g},entryView:{},author:{id:"465848663023160",self_description:void 0,followed:a,viewerIsFollowing:void 0,community:void 0,subscribedTagCount:d,wroteBookCount:d,boughtBookCount:d,isBindedPhone:a,level:4,user_id:"465848663023160",user_name:"花花子",company:"新东方烹饪学校",job_title:"学生",avatar_large:"https:\u002F\u002Fp3-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002F2c3d36ac68756ea7f747669b94554d42~300x300.image",description:"浪漫主义coder",followee_count:56,follower_count:142,post_article_count:98,digg_article_count:267,got_digg_count:365,got_view_count:97822,post_shortmsg_count:3,digg_shortmsg_count:16,isfollowed:a,favorable_author:d,power:3811,study_point:1530,university:{university_id:"6888594369101152269",name:"黑龙江大学",logo:e},major:{major_id:f,parent_id:f,name:e},student_status:3,select_event_count:d,select_online_course_count:d,identity:d,is_select_annual:a,select_annual_rank:d,annual_list_type:d,extraMap:{},is_logout:d,annual_info:[],account_amount:d,user_growth_info:{user_id:465848663023160,jpower:3811,jscore:394.2,jpower_level:4,jscore_level:4,jscore_title:"进阶掘友",author_achievement_list:[],vip_level:4,vip_title:"融会贯通",jscore_next_level_score:500,jscore_this_level_mini_score:d},is_vip:b,become_author_days:d,collection_set_article_count:d,juejinPower:3811,jobTitle:"学生",roles:{isBookAuthor:a,isFavorableAuthor:a,isCobuilder:a,isAdmin:a},username:"花花子",blogAddress:void 0,selfDescription:"浪漫主义coder",beLikedCount:365,beReadCount:97822,followerCount:142,followingCount:56,collectionCount:d,createdCollectionCount:d,followingCollectionCount:d,postedPostsCount:98,pinCount:3,likedArticleCount:267,likedPinCount:16,avatar:"https:\u002F\u002Fp3-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002F2c3d36ac68756ea7f747669b94554d42~300x300.image",latestLoginedInAt:c,createdAt:c,updatedAt:c,phoneNumber:e,titleDescription:e,followeesCount:56,applyEventCount:d,need_lead:d,followTopicCnt:void 0},adEntryList:[],relatedEntryList:[],linkVotingList:[],userAnnuals:[],columnList:[],cachedHtml:"\u003Cstyle\u003E@charset \"UTF-8\";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:\"#\";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:\"\";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image\u002Fpng;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq\u002Fo4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC\u002FIhh2Z0nVV27VnZnenumW9i6ddV7\u002F\u002FfrV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd\u002FigC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG\u002FwjMeqAkijwW4xQJ5Gf\u002FZzRC8OW3hiBTGGlURRswW55Bh\u002FSsxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe\u002FC2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn\u002FZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe\u002FsHJ6MxN5lnoSpnC\u002FUGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q\u002FQM69V26jjW86Gvov\u002FEaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5\u002FS19gsAzGKqm6LE5FrShbdS0ku465DjDwKA\u002FoQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD\u002FAp80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre\u003Ecode{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:\"\";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image\u002Fsvg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:\"“\";top:4px;left:6px}.markdown-body blockquote:after{content:\"”\";right:8px;bottom:-8px}.markdown-body blockquote\u003Ep,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}\u003C\u002Fstyle\u003E\u003Ch1 data-id=\"heading-0\"\u003E8. 编译时元编程\u003C\u002Fh1\u003E\n\u003Cp\u003E编译器在将我们的源码编译成字节码之前，会率先将源代码转换为 AST ( Abstract Syntax Tree，抽象语法树 )，以便于语义分析。而 Groovy 提供的编译时元编程工具使得\u003Cstrong\u003E我们能够在编译器产出真正的字节码之前截获源代码的 AST，并对其修改\u003C\u002Fstrong\u003E。从用户的视角而言，和运行时元编程相比，编译时元编程的修改是 \"潜移默化\" 的。并且由于编译器早在编译期间就做了一些额外的注入工作，这也使得 Groovy 代码在运行期的效率得到一定提升 ( 用户不需要在运行期间做一些动态注入 ) 了。\u003C\u002Fp\u003E\n\u003Cp\u003E我们早就体验过编译期元编程为我们带来的便捷：比如笔者在 Groovy 开篇提到的各种懒人注解：\u003Ccode\u003E@Lazy\u003C\u002Fcode\u003E，\u003Ccode\u003E@Immutable\u003C\u002Fcode\u003E，以及 Groovy 默默为我们生成的各种 GET\u002FSET 方法。对了，或许你还会联想到注入 Lombok 这样的工具，它虽并非 Groovy 实现的，但是也一定使用到了其它的编译时元编程技术。\u003C\u002Fp\u003E\n\u003Cp\u003E在本专题中，所有的源代码都是 \u003Ccode\u003EGroovy\u003C\u002Fcode\u003E 脚本形式。我们将在 \u003Ccode\u003EGroovy\u003C\u002Fcode\u003E 脚本的编译期间实现代码导航，方法拦截，乃至方法注入。下面有一些可供参考的链接：\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=http%3A%2F%2Fgroovy-lang.org%2Fmetaprogramming.html%23xform-ASTTest\" target=\"_blank\" rel=\"nofollow noopener noreferrer\" title=\"http:\u002F\u002Fgroovy-lang.org\u002Fmetaprogramming.html#xform-ASTTest\" ref=\"nofollow noopener noreferrer\"\u003EGroovy doc 官方教程\u003C\u002Fa\u003E | \u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=http%3A%2F%2Fmelix.github.io%2Fast-workshop%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\" title=\"http:\u002F\u002Fmelix.github.io\u002Fast-workshop\u002F\" ref=\"nofollow noopener noreferrer\"\u003EGroovy 元编程练习教程:melix.github.io\u003C\u002Fa\u003E | \u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DGVfrNwTBpUM\" target=\"_blank\" rel=\"nofollow noopener noreferrer\" title=\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=GVfrNwTBpUM\" ref=\"nofollow noopener noreferrer\"\u003Eyoutube 视频教程 (自备梯子)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E笔者在一个 Maven 项目中演示例子，且项目的 JDK 为 8+，为了兼容 Groovy 的运行，需添加以下依赖：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-xml copyable\" lang=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u003Cspan class=\"hljs-name\"\u003Edependencies\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u003Cspan class=\"hljs-name\"\u003Edependency\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u003Cspan class=\"hljs-name\"\u003EgroupId\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003Ejavax.xml.bind\u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u002F\u003Cspan class=\"hljs-name\"\u003EgroupId\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u003Cspan class=\"hljs-name\"\u003EartifactId\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003Ejaxb-api\u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u002F\u003Cspan class=\"hljs-name\"\u003EartifactId\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u003Cspan class=\"hljs-name\"\u003Eversion\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E2.3.1\u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u002F\u003Cspan class=\"hljs-name\"\u003Eversion\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u002F\u003Cspan class=\"hljs-name\"\u003Edependency\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u003Cspan class=\"hljs-name\"\u003Edependency\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u003Cspan class=\"hljs-name\"\u003EgroupId\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003Eorg.glassfish.jaxb\u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u002F\u003Cspan class=\"hljs-name\"\u003EgroupId\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u003Cspan class=\"hljs-name\"\u003EartifactId\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003Ejaxb-runtime\u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u002F\u003Cspan class=\"hljs-name\"\u003EartifactId\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u003Cspan class=\"hljs-name\"\u003Eversion\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E2.3.1\u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u002F\u003Cspan class=\"hljs-name\"\u003Eversion\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u002F\u003Cspan class=\"hljs-name\"\u003Edependency\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&#x3C;\u002F\u003Cspan class=\"hljs-name\"\u003Edependencies\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 data-id=\"heading-1\"\u003E8.1 Groovy AST\u003C\u002Fh2\u003E\n\u003Cp\u003E在 Groovy 中，某个 Groovy 脚本的 AST 可以包含：ClassNode ( 代表脚本自身的编译类节点)，Constructors ( 构造器 )，Methods ( 方法 )。\u003C\u002Fp\u003E\n\u003Cp\u003EMethods 包含了众多 Method 节点。节点本身记载了关于此方法所有必要的信息。Method 的语句块由各种类型的 Statement 聚合而成，并最终以 BlockStatement 的形式保存 ( 根据 Groovy 源代码的描述，BlockStatement 被认为是 Statement 的一种子类继承 )。综上所述，语句可以大致分为以下内容：\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E表达一个普通表达式调用语句的 ExpressionStatement。\u003C\u002Fli\u003E\n\u003Cli\u003E分支语句 IfStatement，\u003C\u002Fli\u003E\n\u003Cli\u003E选择语句 SwitchStatement。\u003C\u002Fli\u003E\n\u003Cli\u003E循环语句 ForStatement。\u003C\u002Fli\u003E\n\u003Cli\u003E表示返回语句的 ReturnStatement。\u003C\u002Fli\u003E\n\u003Cli\u003E以任意形式聚合以上各种语句的语句块 BlockStatement。\u003C\u002Fli\u003E\n\u003Cli\u003E特殊的空语句块 Empty Statement。\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003EIfStatement，SwitchStatement，ForStatement，ReturnStatement 可以理解成以特定结构聚合 ExpressionStatement 的语句块，而 BlockStatement 则是广义的语句块。那么显然 \u003Cstrong\u003EExpressionStatement 是构建其它 Statement 的基础\u003C\u002Fstrong\u003E，也是最常见的语句形式。每一条 ExpressionStatement 都可以由各种 Expression ( 表达式 ) 组合而成。 这些表达式又可以细化为：\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003EPropertyExpression，用于表示一个属性访问的表达式。\u003C\u002Fli\u003E\n\u003Cli\u003EUnaryExpression，表示一个一元表达式，如 \u003Ccode\u003E!\u003C\u002Fcode\u003E，\u003Ccode\u003E~\u003C\u002Fcode\u003E。\u003C\u002Fli\u003E\n\u003Cli\u003EBinaryExpression，表示一个二元表达式。\u003C\u002Fli\u003E\n\u003Cli\u003ETenaryExpression，表示一个三元表达式，如 \u003Ccode\u003E?:\u003C\u002Fcode\u003E。\u003C\u002Fli\u003E\n\u003Cli\u003EMethodCallExpression，表示一个方法调用，比较常见。\u003C\u002Fli\u003E\n\u003Cli\u003EDeclaration Expression，表示一个赋值运算。\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003E若再向下细分，Expression 便是各种类型的 Variable ( 变量 )，Constant ( 常量 ) ，Token ( 操作符 ) ，或者其它多个 Expression 的组合。\u003C\u002Fp\u003E\n\u003Cp\u003E比如说，每一个方法是一个 MethodCallExpression，它向下拥有一个表示方法调用者的 Variable 节点，表示调用方法名的 Constant 节点，表示参数列表的 ArgumentList 节点。显然，ArgumentList 是一个 X 叉子树，X 是参数的个数。参数本身可以是表达式，可以是变量，或者是常量。\u003C\u002Fp\u003E\n\u003Cp\u003E其它 Expression 根据自身的语义不同，各种常量变量的组合方式也各不相同。但是，审视这些内容，我们可以发现它们是语言无关的，因此易得 AST 语法树本身也是语言无关的。任何源代码总是能抽象成 AST 的形式。只要你愿意，甚至可以从一段 Groovy 的逻辑中提取出 AST ，然后利用元编程技术将它翻译成等价的 C++ 代码，以此来提高程序的运行速度 ( 这个过程可以描述为 Groovy CST -\u003E AST -\u003E C++ CST )。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003E在 Groovy 的 AST 中，上述的所有 AST 节点有一个共同基类，那就是 org.codehaus.groovy.ast.ASTNode\u003C\u002Fstrong\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003E上文提到了太多的 Statement 或者是 Expression 类型，这一定程度上增加了设计 AST 的难度，但我们不需要对这些概念死记硬背。有一个实用工具 GroovyConsole：它是安装 Groovy 的 \"赠品\"，存放在 Groovy PATH 的 \u003Ccode\u003Ebin\u003C\u002Fcode\u003E 目录下。\u003C\u002Fp\u003E\n\u003Cp\u003E笔者发现 Groovy 3.0.8 版本的 GroovyConsole 在更高版本的 JDK 环境中启动会出现错误：\u003Ccode\u003ECould not find or load main class org.codehaus.groovy.tools.GroovyStarter\u003C\u002Fcode\u003E 。为了解决这个问题，这里通过修改本机环境变量的方式暂时将本机 JDK 版本回退到 8。\u003C\u002Fp\u003E\n\u003Cp\u003E解决了以上小麻烦之后，只需要在控制台输入 \u003Ccode\u003EgroovyConsole\u003C\u002Fcode\u003E 就可以唤起其 GUI 。可以在面板中粘贴一段代码，然后通过 \u003Ccode\u003ECtrl\u003C\u002Fcode\u003E  + \u003Ccode\u003ET\u003C\u002Fcode\u003E 的方式打开 AST 分析窗口 Groovy AST Browser。当 GroovyConsole 面板的代码更新时，只需要按 \u003Ccode\u003EF5\u003C\u002Fcode\u003E 刷新即可。\u003Cstrong\u003E利用这个工具，我们后期就不需要自己在纸上写写画画来手动构建一段 AST 。\u003C\u002Fstrong\u003E 在设计复杂的 AST 变换时，这尤为有用。\u003C\u002Fp\u003E\n\u003Cp\u003E面板代码对应的 AST 结构可以在 \u003Ccode\u003EClassNode -\u003E Methods -\u003E MethodNode - run -\u003E BlockStatement\u003C\u002Fcode\u003E 那里找到。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F45decb567ba94ad4b7ff6e19968e79f5~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp\" alt=\"GroovyConsole\" loading=\"lazy\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E这是一个平平无奇的控制台输出：\u003Ccode\u003Eprint shout?msg.toUpperCase():msg\u003C\u002Fcode\u003E。从语句类型来看，它是一个普通的 ExpressionStatement。这个语句只涉及一个简单的 MethodCallExpression，因为外层是一个对 \u003Ccode\u003Ethis.prinln\u003C\u002Fcode\u003E 方法的调用\u003Csup\u003E\u003Ca href=\"#user-content-fn-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AFsystem.out%EF%BC%9F\" id=\"user-content-user-content-fnref-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AFsystem.out%EF%BC%9F\" data-footnote-ref=\"\" aria-describedby=\"footnote-label\" title=\"#user-content-fn-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AFsystem.out%EF%BC%9F\"\u003E1\u003C\u002Fa\u003E\u003C\u002Fsup\u003E。 \u003Ccode\u003Eprint\u003C\u002Fcode\u003E 方法的参数是一个较为复杂的三元表达式。在 Groovy Console 工具中，它是这样显示的：\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fp6-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F9c3b9b5a8c6d492190101d59047f9bf8~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp\" alt=\"Groovy AST Browser\" loading=\"lazy\"\u003E\u003C\u002Fp\u003E\n\u003Ch2 data-id=\"heading-2\"\u003E8.2 从进行 AST 树检查开始\u003C\u002Fh2\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E先不要着急想着对 AST 进行一番魔改，不如首先通过一个简单的 AST 检查的例子一窥 Groovy 脚本的 AST 结构 —— 在修改 AST 之前，至少得学会如何定位到想要修改的部分。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E从一个例子开始直接说起。我们受够了同事在团队项目中制造的代码异味\u003Csup\u003E\u003Ca href=\"#user-content-fn-%E5%91%B3%E9%81%93%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F\" id=\"user-content-user-content-fnref-%E5%91%B3%E9%81%93%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F\" data-footnote-ref=\"\" aria-describedby=\"footnote-label\" title=\"#user-content-fn-%E5%91%B3%E9%81%93%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F\"\u003E2\u003C\u002Fa\u003E\u003C\u002Fsup\u003E。与其在事后人工 review 代码，不如让编译器提前进行异味检查，如检测一些不规范的方法命名，参数命名 ( 尤其是使用一个字母 \u003Ccode\u003Ea\u003C\u002Fcode\u003E 或 \u003Ccode\u003Eb\u003C\u002Fcode\u003E 命名方法这种令其它同事深恶痛绝的行为) ，并对这些不规范的行为施加惩戒 —— 比如说抛出异常并拒绝执行。\u003C\u002Fp\u003E\n\u003Cp\u003E举个例子，现在随手创建一个 Groovy 脚本，然后随手在里面定义一个方法。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003E\u002F\u002F a for what?\n\u002F\u002F p for what?\ndef a(p){\n    println p\n}\n\n\u002F\u002F 这段 Groovy 脚本可以正常编译，执行，但是毫无语义可言。\na(\"bad job\")\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E我们的目标是让编译器拦截这个随意的，语义不明的 Groovy 脚本。接下来就是利用 Groovy 的编译时元编程技术实现目标了。这分为两步：\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E找出 Groovy 脚本源代码内的所有 ClassNode 节点 ( 注意，脚本本身也是一个 ClassNode 节点 )。\u003C\u002Fli\u003E\n\u003Cli\u003E在每个 ClassNode 节点内安插守卫或称观察者 Visitor，检查有关于此 ClassNode 的 Methods，Constructor，Field 等信息。\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003E除此之外，我们希望这个代码异味检查是全局性的，因此要对其\u003Cstrong\u003E进行一个全局的 AST 变换 ( 或称检查 )\u003C\u002Fstrong\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003E对于第一个目标，需要创建出一个 \u003Ccode\u003EASTTransformation\u003C\u002Fcode\u003E 接口的实现。额外的，\u003Cstrong\u003E除非使用 ASTBudiler 工具，该接口可以使用任何一门 JVM 语言来实现\u003C\u002Fstrong\u003E。对于第二个目标，可以创建出一个 \u003Ccode\u003EGroovyClassVisitor\u003C\u002Fcode\u003E 接口的实现。\u003C\u002Fp\u003E\n\u003Ch3 data-id=\"heading-3\"\u003E8.2.1 ASTTransformation\u003C\u002Fh3\u003E\n\u003Cp\u003E该接口预留了一个用于 AST 变换的 \u003Ccode\u003Evisit\u003C\u002Fcode\u003E 方法，同时还有一个配套的 \u003Ccode\u003E@GroovyASTTransformation\u003C\u002Fcode\u003E 注解，该注解告知编译器在哪个阶段发起 AST 变换。\u003C\u002Fp\u003E\n\u003Cp\u003E实际上，一共有九个阶段可供选择，它们分别是：初始化，解析，转换，语义分析，规范化，指令选择，class 生成，输出，结束。其中：转换 \u003Ccode\u003ECONVERSION\u003C\u002Fcode\u003E，语义分析 \u003Ccode\u003ESEMANTIC_ANALYSIS\u003C\u002Fcode\u003E 和 \u003Ccode\u003ECANONICALIZATION\u003C\u002Fcode\u003E 规范化是三个不错的时机，因为这三个阶段处于 \"既不太晚，也不太早\" 的状态。\u003Cstrong\u003E但是，如果想要更丰富的 AST 信息，就必须在越靠后的阶段进行介入\u003C\u002Fstrong\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003E有关于 \u003Ccode\u003Evisit\u003C\u002Fcode\u003E 的简单介绍，可以参考 Groovy Doc。\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=http%3A%2F%2Fwww.groovy-lang.org%2Fapi.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\" title=\"http:\u002F\u002Fwww.groovy-lang.org\u002Fapi.html\" ref=\"nofollow noopener noreferrer\"\u003EThe Apache Groovy programming language - Groovy Development Kit (groovy-lang.org)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E根据 Groovy Doc 的解释，\u003Ccode\u003EsourceUnit\u003C\u002Fcode\u003E 表示任意一个 \u003Ccode\u003E.groovy\u003C\u002Fcode\u003E 文件的源码。一份脚本内可以有多个类定义，故该参数称为“源单元”。\u003Ccode\u003EASTNode[]\u003C\u002Fcode\u003E 参数一般用于基于注解的局部变换，后文会提到，在当前例子中可以放心地忽略它。\u003C\u002Fp\u003E\n\u003Cp\u003E在下面的例子中，程序从源单元中获取了 Groovy 脚本内部定义的所有的类的节点 \u003Ccode\u003EclassNode\u003C\u002Fcode\u003E，并对准备每一个节点使用一个检查器 \u003Ccode\u003EMyClassVisitor\u003C\u002Fcode\u003E 来进行代码检查。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Eimport org.codehaus.groovy.ast.ASTNode\nimport org.codehaus.groovy.control.CompilePhase\nimport org.codehaus.groovy.control.SourceUnit\nimport org.codehaus.groovy.transform.ASTTransformation\nimport org.codehaus.groovy.transform.GroovyASTTransformation\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\nclass CodeCheck implements ASTTransformation {\n    @Override\n    void visit(ASTNode[] astNodes, SourceUnit sourceUnit) {\n        sourceUnit.getAST().classes.each {\n            classNode -\u003E\n                \u002F\u002F 在源单元内定义的每一个类节点定义全部安插一个 \"导航助手\" 。\n                \u002F\u002F MyClassVisitor 的实现见后文。\n                classNode.visitContents(new MyClassVisitor())\n        }\n    }\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3 data-id=\"heading-4\"\u003E8.2.2 GroovyClassVisitor\u003C\u002Fh3\u003E\n\u003Cp\u003E\u003Ccode\u003EMyClassVisitor\u003C\u002Fcode\u003E 内置了五个用于检查 ( 或变换 ) 的方法，它们分别用于类，构造器，字段 Field，属性 Property。如果变换的内容涉及到方方面面，那显然把不同的 AST 变换按照分类存放到这里能让代码的可读性更强一些。在 Groovy 中，Field 和 Property 两者的概念几乎重合了，两者的差异来自 Groovy 的元编程协议 MOP 带来的动态性。细微的差别可以参考 \u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fblog.kazaff.me%2F2016%2F04%2F01%2Fgroovy%25E4%25B8%258B%25E7%259A%2584field%25E5%2592%258Cproperty%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\" title=\"https:\u002F\u002Fblog.kazaff.me\u002F2016\u002F04\u002F01\u002Fgroovy%E4%B8%8B%E7%9A%84field%E5%92%8Cproperty\u002F\" ref=\"nofollow noopener noreferrer\"\u003EGroovy下的field和property | kazaff's blog\u003C\u002Fa\u003E 。\u003C\u002Fp\u003E\n\u003Cp\u003EIntelliJ IDE 提供的代码提示足够我们利用已有的线索去实现目标。在此处设定：如果检查到方法名称的长度为 1，那么就抛出一个 \u003Ccode\u003ESyntaxException\u003C\u002Fcode\u003E 异常，并在控制台中给出相应信息。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Eimport org.codehaus.groovy.ast.ClassNode\nimport org.codehaus.groovy.ast.ConstructorNode\nimport org.codehaus.groovy.ast.FieldNode\nimport org.codehaus.groovy.ast.GroovyClassVisitor\nimport org.codehaus.groovy.ast.MethodNode\nimport org.codehaus.groovy.ast.PropertyNode\nimport org.codehaus.groovy.syntax.SyntaxException\n\nclass MyClassVisitor implements GroovyClassVisitor{\n    \u002F\u002F 如果检查出单个字母命名的方法，就报错。\n    @Override\n    void visitMethod(MethodNode methodNode) {\n        if(methodNode.name.size() == 1) throw new SyntaxException(\n                \"single letter is forbidden\",\n                methodNode.lineNumber,\n                methodNode.columnNumber\n        )\n    }\n    \n    \u002F\u002F 在这个例子中，我们没有应用到这些方法，因此只保留空实现。\n    @Override\n    void visitClass(ClassNode classNode) {}\n    @Override\n    void visitConstructor(ConstructorNode constructorNode) {}\n    @Override\n    void visitField(FieldNode fieldNode) {}\n    @Override\n    void visitProperty(PropertyNode propertyNode) {}\n}\n\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3 data-id=\"heading-5\"\u003E8.2.3 注册 SPI (全局变换必须注册)\u003C\u002Fh3\u003E\n\u003Cp\u003E和前述的拓展 JDK 的做法类似，为了令 groovyc 编译器能够在编译期间发现这个 AST 变换，需要在 Maven  \u003Ccode\u003Eresources\u003C\u002Fcode\u003E 目录下新建一个 \u003Ccode\u003EMETA-INF\u002Fservices\u003C\u002Fcode\u003E 目录，并创建一个名为 \u003Ccode\u003Eorg.codehaus.groovy.transform.ASTTransformation\u003C\u002Fcode\u003E 的清单。\u003C\u002Fp\u003E\n\u003Cp\u003E在该清单中补充 \u003Ccode\u003ECodeCheck\u003C\u002Fcode\u003E 的全限定名，它必须是实现了 \u003Ccode\u003EASTTransformation\u003C\u002Fcode\u003E 的类，否则就不会被识别。清单内可以存在多个转换。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs copyable\"\u003Ecom.i.CodeCheck\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E现在，如果试着重新编译开头的那段脚本，能发现：由于方法命名的不规范，这次编译被拦截了：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-csharp copyable\" lang=\"csharp\"\u003ECaught: BUG! exception \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E phase \u003Cspan class=\"hljs-string\"\u003E'semantic analysis'\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E source unit \u003Cspan class=\"hljs-string\"\u003E'C:\\Users\\i\\IdeaProjects\\groovyInJdk11\\src\\main\\java\\groovy_script.groovy'\u003C\u002Fspan\u003E single letter \u003Cspan class=\"hljs-keyword\"\u003Eis\u003C\u002Fspan\u003E forbidden @ line \u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E, column \u003Cspan class=\"hljs-number\"\u003E1.\u003C\u002Fspan\u003E\nBUG! exception \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E phase \u003Cspan class=\"hljs-string\"\u003E'semantic analysis'\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E source unit \u003Cspan class=\"hljs-string\"\u003E'C:\\Users\\i\\IdeaProjects\\groovyInJdk11\\src\\main\\java\\groovy_script.groovy'\u003C\u002Fspan\u003E single letter \u003Cspan class=\"hljs-keyword\"\u003Eis\u003C\u002Fspan\u003E forbidden @ line \u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E, column \u003Cspan class=\"hljs-number\"\u003E1.\u003C\u002Fspan\u003E\n\tat java.\u003Cspan class=\"hljs-keyword\"\u003Ebase\u003C\u002Fspan\u003E\u002Fjdk.\u003Cspan class=\"hljs-keyword\"\u003Einternal\u003C\u002Fspan\u003E.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.\u003Cspan class=\"hljs-keyword\"\u003Ebase\u003C\u002Fspan\u003E\u002Fjdk.\u003Cspan class=\"hljs-keyword\"\u003Einternal\u003C\u002Fspan\u003E.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:\u003Cspan class=\"hljs-number\"\u003E62\u003C\u002Fspan\u003E)\n\tat java.\u003Cspan class=\"hljs-keyword\"\u003Ebase\u003C\u002Fspan\u003E\u002Fjdk.\u003Cspan class=\"hljs-keyword\"\u003Einternal\u003C\u002Fspan\u003E.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:\u003Cspan class=\"hljs-number\"\u003E43\u003C\u002Fspan\u003E)\n\tat java.\u003Cspan class=\"hljs-keyword\"\u003Ebase\u003C\u002Fspan\u003E\u002Fjdk.\u003Cspan class=\"hljs-keyword\"\u003Einternal\u003C\u002Fspan\u003E.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.\u003Cspan class=\"hljs-keyword\"\u003Ebase\u003C\u002Fspan\u003E\u002Fjdk.\u003Cspan class=\"hljs-keyword\"\u003Einternal\u003C\u002Fspan\u003E.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:\u003Cspan class=\"hljs-number\"\u003E62\u003C\u002Fspan\u003E)\n\tat java.\u003Cspan class=\"hljs-keyword\"\u003Ebase\u003C\u002Fspan\u003E\u002Fjdk.\u003Cspan class=\"hljs-keyword\"\u003Einternal\u003C\u002Fspan\u003E.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:\u003Cspan class=\"hljs-number\"\u003E43\u003C\u002Fspan\u003E)\n\tat com.intellij.rt.execution.application.AppMainV2.main(AppMainV2.java:\u003Cspan class=\"hljs-number\"\u003E131\u003C\u002Fspan\u003E)\nCaused \u003Cspan class=\"hljs-keyword\"\u003Eby\u003C\u002Fspan\u003E: org.codehaus.groovy.syntax.SyntaxException: single letter \u003Cspan class=\"hljs-keyword\"\u003Eis\u003C\u002Fspan\u003E forbidden @ line \u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E, column \u003Cspan class=\"hljs-number\"\u003E1.\u003C\u002Fspan\u003E\n\tat java.\u003Cspan class=\"hljs-keyword\"\u003Ebase\u003C\u002Fspan\u003E\u002Fjdk.\u003Cspan class=\"hljs-keyword\"\u003Einternal\u003C\u002Fspan\u003E.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat java.\u003Cspan class=\"hljs-keyword\"\u003Ebase\u003C\u002Fspan\u003E\u002Fjdk.\u003Cspan class=\"hljs-keyword\"\u003Einternal\u003C\u002Fspan\u003E.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:\u003Cspan class=\"hljs-number\"\u003E62\u003C\u002Fspan\u003E)\n\tat java.\u003Cspan class=\"hljs-keyword\"\u003Ebase\u003C\u002Fspan\u003E\u002Fjdk.\u003Cspan class=\"hljs-keyword\"\u003Einternal\u003C\u002Fspan\u003E.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:\u003Cspan class=\"hljs-number\"\u003E45\u003C\u002Fspan\u003E)\n\tat astTest.MyClassVisitor.visitMethod(MyClassVisitor.groovy:\u003Cspan class=\"hljs-number\"\u003E25\u003C\u002Fspan\u003E)\n\tat astTest.CodeCheck$_visit_closure1.doCall(CodeCheck.groovy:\u003Cspan class=\"hljs-number\"\u003E15\u003C\u002Fspan\u003E)\n\tat java.\u003Cspan class=\"hljs-keyword\"\u003Ebase\u003C\u002Fspan\u003E\u002Fjdk.\u003Cspan class=\"hljs-keyword\"\u003Einternal\u003C\u002Fspan\u003E.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.\u003Cspan class=\"hljs-keyword\"\u003Ebase\u003C\u002Fspan\u003E\u002Fjdk.\u003Cspan class=\"hljs-keyword\"\u003Einternal\u003C\u002Fspan\u003E.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:\u003Cspan class=\"hljs-number\"\u003E62\u003C\u002Fspan\u003E)\n\tat java.\u003Cspan class=\"hljs-keyword\"\u003Ebase\u003C\u002Fspan\u003E\u002Fjdk.\u003Cspan class=\"hljs-keyword\"\u003Einternal\u003C\u002Fspan\u003E.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:\u003Cspan class=\"hljs-number\"\u003E43\u003C\u002Fspan\u003E)\n\tat astTest.CodeCheck.visit(CodeCheck.groovy:\u003Cspan class=\"hljs-number\"\u003E13\u003C\u002Fspan\u003E)\n\t...\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E这是一个全局的 AST 变换，它对于项目内的所有 Groovy 代码全部生效。\u003C\u002Fp\u003E\n\u003Ch2 data-id=\"heading-6\"\u003E8.3 基于 AST 全局变换的方法拦截\u003C\u002Fh2\u003E\n\u003Cp\u003E下面是另一个全局 AST 变换的演示，还是直接从例子开始讲起。有这样一段 Groovy 脚本，脚本内有一处 \u003Ccode\u003ECheckingAccountUsing\u003C\u002Fcode\u003E 的类定义：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Eclass CheckingAccountUsing {\n    def audit(int amount){println \"audit...\"}\n    \u002F\u002F 希望当执行的金额 \u003E10000 时，进行 audit 审计。\n    def deposit(int amount){println \"deposit \\$$amount.\"}\n    def withdraw(int amount){println \"withdraw \\$$amount.\"}\n}\n\ndef account = new CheckingAccountUsing()\n\u002F\u002F 取出一万零一块钱。\naccount.withdraw(10001)\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E我们希望 \u003Ccode\u003ECheckingAccountUsing\u003C\u002Fcode\u003E 内定义的任何方法 ( 除了 \u003Ccode\u003Eaudit\u003C\u002Fcode\u003E 方法本身 ) 当检测到操作的金额大于 10000 时，实例能够自动调用 \u003Ccode\u003Eaudit\u003C\u002Fcode\u003E 方法进行审计。基于之前各种 Execute Method Around 模式，运行时方法注入等手段，实现这个目的已经不是什么难事。不过这一次，这个 AOP 的实现将交付给编译器。\u003C\u002Fp\u003E\n\u003Cp\u003E首先另创建一个 \u003Ccode\u003EASTTransformation\u003C\u002Fcode\u003E 的实现类，然后进入到 \u003Ccode\u003Evisit\u003C\u002Fcode\u003E 方法内实现我们的思路。第一步，从源单元 \u003Ccode\u003EsourceUnit\u003C\u002Fcode\u003E 中定位到脚本内定义的 \u003Ccode\u003ECheckingAccountUsing\u003C\u002Fcode\u003E 类，然后从它的 Methods 节点中翻找出所有除了 \u003Ccode\u003Eauduit\u003C\u002Fcode\u003E 以外的方法节点 MethodNode 。注意，如果不小心对 \u003Ccode\u003Eaudit\u003C\u002Fcode\u003E 方法节点注入了 \u003Ccode\u003Eaudit\u003C\u002Fcode\u003E 方法，这会无意中设置一个无限循环的程序陷阱。\u003C\u002Fp\u003E\n\u003Cp\u003E注入的详细步骤被封装成了 \u003Ccode\u003EinjectMethodWithAudit\u003C\u002Fcode\u003E 方法，见下文。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Edef targetClass = sourceUnit.getAST().classes.find {\n    \u002F\u002F 找出想要变换的类\n    it.name == \"astTest.CheckingAccountUsing\"\n}\ndef nonAuditMethods = targetClass?.methods?.findAll {\n    \u002F\u002F 找出想要变换的方法\n    it.name != \"audit\"\n}\nnonAuditMethods?.each { injectMethodWithAudit(it) }\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E现在进入到了待实现的 \u003Ccode\u003EinjectMethodWithAudit\u003C\u002Fcode\u003E 方法内部。后面的思路是，我们需要在每个 MethodNode 的 BlockStatement 节点内部，安插一段这样的逻辑：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003E\u002F\u002F amount 来自于 deposit 或者是 withdraw 方法的参数。\nif(amount\u003E10000){\n    audit(amount)\n}else{\n    println(\"no need to audit\")\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E这段语句的 AST 树该如何表示呢？人工分析一定会比较麻烦，尤其是对于初学 AST 的开发者而言。一个投机的办法就是 —— 将这段代码直接复制到 Groovy Console 内，然后 \"照葫芦画瓢\"。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F140bec8de10b470c9fa78156b52c678e~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp\" alt=\"if 语句块对应的 AST\" loading=\"lazy\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E将这个结构稍微整理一下，给出伪代码结构。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-scss copyable\" lang=\"scss\"\u003E\u003Cspan class=\"hljs-built_in\"\u003EIfStatement\u003C\u002Fspan\u003E(\n\tBooleanStatement(BinaryStatement(Variable(amount),\u003Cspan class=\"hljs-built_in\"\u003EToken\u003C\u002Fspan\u003E(\"\u003E\"),\u003Cspan class=\"hljs-built_in\"\u003EConstant\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-number\"\u003E10000\u003C\u002Fspan\u003E)))，\n\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 表示条件为 true\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-built_in\"\u003EExpressionStatement\u003C\u002Fspan\u003E(\n\t\tMethodCallStatement(\n\t\t\t'this','audit',Variable('amount')\n\t\t)\n\t)\n\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 表示条件为 false\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-built_in\"\u003EExpressionStatement\u003C\u002Fspan\u003E(\n\t\tMethodCallStatement(\n\t\t\t'this','print',Variable('No need to audit')\n\t\t)\n\t)\n)\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E由于 if 和 else 块内只有一行语句，因此在这里可以直接传入 ExpressionStatement。在更一般的情形中，如果块内包含了多条语句，那么就必须要选择 BlockStatement，然后将多条 ExpressionStatement 组织为链表的形式放入其中。或者，条件分支没有 else 时，那么 else 块实际上为空。此时需要选择 EmptyStatement，而不是直接传入一个 \u003Ccode\u003Enull\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003E这些节点都是 \u003Ccode\u003Eorg.codehaus.groovy.ast.*\u003C\u002Fcode\u003E 包中确切存在的类 ( 在构建的过程中，IDE 可能还会提供其他包的同名类，不要选错了 ) 。当构建好一个蓝图之后，剩下的工作就是将这段逻辑使用源代码去实现。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003E\u002F\u002F condition\ndef condition = new BooleanExpression(\n    new BinaryExpression(\n        new VariableExpression('amount'),\n        \u002F\u002F org.codehaus.groovy.syntax.Types\n        \u002F\u002F org.codehaus.groovy.syntax.Token\n        \u002F\u002F 经过实践证明，startLine 和 startColumn 的设置不会影响构建 AST，在此处全部设置为 -1.\n        Token.newSymbol(Types.COMPARE_GREATER_THAN, -1, -1),\n        new ConstantExpression(10000, true)\n    )\n)\n\n\u002F\u002F 构造 this.audit(amount)\ndef ifBlock = new ExpressionStatement(\n    new MethodCallExpression(\n        new VariableExpression('this'),\n        'audit',\n        new ArgumentListExpression(\n            new VariableExpression('amount')\n        )\n    )\n)\n\n\u002F\u002F 没有 else 块则使用 EmptyStatement() 代替。\n\u002F\u002F def elseBlock = new EmptyStatement()\n\u002F\u002F this.println(\"No need to audit\")\ndef elseBlock = new ExpressionStatement(\n    new MethodCallExpression(\n        new VariableExpression('this'),\n        'println',\n        new ArgumentListExpression(\n            new ConstantExpression(\"No need to audit\")\n        )\n    )\n)\n\ndef insert = new IfStatement(condition , ifBlock, elseBlock)\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E其中，二元符号 ( 这里需要一个表示大于的 \u003Ccode\u003E\u003E\u003C\u002Fcode\u003E 符号 ) 需要借助 \u003Ccode\u003Eorg.codehaus.groovy.syntax\u003C\u002Fcode\u003E 包下的 \u003Ccode\u003ETypes\u003C\u002Fcode\u003E 和 \u003Ccode\u003EToken\u003C\u002Fcode\u003E 类创建。如果需要其它表达符号，可以进入到源代码内进行查看。\u003C\u002Fp\u003E\n\u003Cp\u003E初次尝试 AST 语法变换是比较困难的事情，但是 IntelliJ IDE 给出的代码提示也足够用了。在创建各个 XXXStatement 实例时，可以多加留意每个 Statement 的创建需要哪些内容。最终的 \u003Ccode\u003Einsert\u003C\u002Fcode\u003E 代表了我们想要插入的那段 \u003Ccode\u003Eif\u003C\u002Fcode\u003E 语句块。最后的工作则是将它插入到原方法节点的 BlockStatement 内部。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003E((BlockStatement)methodNode.code).statements.add(0, insert)\n\u002F\u002F 更偷懒的写法是:\n\u002F\u002F methodNode.code.statements.add(0,insert)，不过 IDE 无法对此给出代码提示。\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Ccode\u003E.statements\u003C\u002Fcode\u003E 实际上获得的是一组存储方法原语句块的 \u003Ccode\u003EList&#x3C;Statement\u003E\u003C\u002Fcode\u003E 链表，我们后文总是通过修改它来实现编译时方法注入或变换。这里将 \u003Ccode\u003Einsert\u003C\u002Fcode\u003E 语句块头插入到原语句块，以此实现一个前置通知。反之，实现的则是后置通知。\u003C\u002Fp\u003E\n\u003Cp\u003E最后，不要忘记到 \u003Ccode\u003EMETA-INF\u002Fservices\u002Forg.codehaus.groovy.transform.ASTTransforamtion\u003C\u002Fcode\u003E 那里注册这个 AST 变换。当然，这个演示有明显的不合理之处：这个全局变换实际上只应用在了特定类 \u003Ccode\u003ECheckAccountUsing\u003C\u002Fcode\u003E 上，我们应用全局变换后还得特地花些功夫重新将它从源单元 \u003Ccode\u003EsourceUnit\u003C\u002Fcode\u003E 挑出来，颇有买椟还珠之嫌。在后文会介绍如何结合\u003Cstrong\u003E注解实现一个局部 AST 变换\u003C\u002Fstrong\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003E从这个例子可以看出来，手动实现 AST 转换其实并非一件易事，编译时元编程明显要比运行时元编程要来的复杂。然而，它为用户提供带来的便捷可以说是一劳永逸的。\u003C\u002Fp\u003E\n\u003Ch2 data-id=\"heading-7\"\u003E8.4 编译期注入属性\u003C\u002Fh2\u003E\n\u003Cp\u003E注，\u003Ccode\u003EASTTransformation\u003C\u002Fcode\u003E 的实现者可以是任何一门 JVM 语言。如果想要增强编译器的执行效率，那么也可以使用原生的 Java 语言来实现它，或者在 Groovy Class 上加上 \u003Ccode\u003E@ComplieStatic\u003C\u002Fcode\u003E ( 但是这样就写不了动态代码了，那还不如直接使用 Java ) 。注入属性只需要两步：\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E找到目标 ClassNode 节点，调用其提供的 \u003Ccode\u003EaddField\u003C\u002Fcode\u003E 增加属性方法。\u003C\u002Fli\u003E\n\u003Cli\u003E构造方法的名称，修饰符，类型 ( 需要 ClassHelper 类辅助构造，详细可以翻阅源代码 )，初始值 ( Expression ) 。\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Eimport org.codehaus.groovy.ast.ASTNode;\nimport org.codehaus.groovy.ast.ClassHelper;\nimport org.codehaus.groovy.ast.ClassNode;\nimport org.codehaus.groovy.ast.expr.ConstantExpression;\nimport org.codehaus.groovy.control.CompilePhase;\nimport org.codehaus.groovy.control.SourceUnit;\nimport org.codehaus.groovy.transform.ASTTransformation;\nimport org.codehaus.groovy.transform.GroovyASTTransformation;\nimport java.util.List;\nimport static groovyjarjarasm.asm.Opcodes.ACC_FINAL;\nimport static groovyjarjarasm.asm.Opcodes.ACC_PUBLIC;\nimport static groovyjarjarasm.asm.Opcodes.ACC_STATIC;\n\n\u002F\u002F build from YouToBe\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\npublic class CodeBuilder implements ASTTransformation {\n    @Override\n    public void visit(ASTNode[] astNodes, SourceUnit sourceUnit) {\n        \u002F\u002F 增加字段，相当于 public static final String AUTHOR = me;\n        List&#x3C;ClassNode\u003E classes = sourceUnit.getAST().getClasses();\n        classes.forEach(classNode -\u003E classNode.addField(\n                \"AUTHOR\",\n                ACC_PUBLIC | ACC_FINAL | ACC_STATIC,\n                ClassHelper.STRING_TYPE,\n                new ConstantExpression(\"me\")\n        ));\n    }\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 data-id=\"heading-8\"\u003E8.5 编译期注入方法\u003C\u002Fh2\u003E\n\u003Cp\u003E我们已经了解如何利用 AST 对已有的方法进行改造。结合编译期注入属性章节，现在不妨尝试着在编译期为目标构建一个全新的方法。这需要三个步骤：\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E找到目标 ClassNode 节点，调用 \u003Ccode\u003EaddMethod\u003C\u002Fcode\u003E 插入方法。\u003C\u002Fli\u003E\n\u003Cli\u003E设置方法的修饰符，返回值，参数列表，异常抛出列表等。\u003C\u002Fli\u003E\n\u003Cli\u003E准备好方法对应函数体的 AST。\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003E或者说，和编译期注入属性相比，额外的工作就是准备一个符合语义\u003Csup\u003E\u003Ca href=\"#user-content-fn-%E6%80%8E%E6%A0%B7%E7%AE%97%E7%AC%A6%E5%90%88%E8%AF%AD%E4%B9%89%EF%BC%9F\" id=\"user-content-user-content-fnref-%E6%80%8E%E6%A0%B7%E7%AE%97%E7%AC%A6%E5%90%88%E8%AF%AD%E4%B9%89%EF%BC%9F\" data-footnote-ref=\"\" aria-describedby=\"footnote-label\" title=\"#user-content-fn-%E6%80%8E%E6%A0%B7%E7%AE%97%E7%AC%A6%E5%90%88%E8%AF%AD%E4%B9%89%EF%BC%9F\"\u003E3\u003C\u002Fa\u003E\u003C\u002Fsup\u003E的 AST 以及方法的其它信息一起传入到 \u003Ccode\u003EaddMethod\u003C\u002Fcode\u003E 方法内。\u003C\u002Fp\u003E\n\u003Cp\u003E这个例子演示了如何为所有类注入一个 \u003Ccode\u003EgetAuthor\u003C\u002Fcode\u003E 方法：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Eimport groovyjarjarasm.asm.Opcodes\nimport org.codehaus.groovy.ast.ASTNode\nimport org.codehaus.groovy.ast.ClassHelper\nimport org.codehaus.groovy.ast.ClassNode\nimport org.codehaus.groovy.ast.Parameter\nimport org.codehaus.groovy.ast.expr.ConstantExpression\nimport org.codehaus.groovy.ast.stmt.BlockStatement\nimport org.codehaus.groovy.ast.stmt.ExpressionStatement\nimport org.codehaus.groovy.ast.stmt.ReturnStatement\nimport org.codehaus.groovy.control.CompilePhase\nimport org.codehaus.groovy.control.SourceUnit\nimport org.codehaus.groovy.transform.ASTTransformation\nimport org.codehaus.groovy.transform.GroovyASTTransformation\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\nclass getMethodInserter implements ASTTransformation{\n    @Override\n    void visit(ASTNode[] nodes, SourceUnit source) {\n\n        \u002F\u002F 为编译期注入的方法准备语句块部分\n        BlockStatement code = new BlockStatement()\n\n        \u002F*\n        *  { return \"author:me\" }\n        *\u002F\n        def returnString = new ReturnStatement(\n            new ExpressionStatement(\n                    new ConstantExpression(\"author:me\")\n            )\n        )\n\n        \u002F\u002F 将语句插入到语句块内\n        code.addStatement(returnString)\n\n        \u002F\u002F 向各个 ClassNode 注入一个新的 Method 节点。\n        source.getAST().classes.each {\n            classNode -\u003E classNode.addMethod(\n                    \u002F\u002F 表示注入的方法名称\n                    \"getAuthor\",\n                    \u002F\u002F 修饰符\n                    Opcodes.ACC_PUBLIC,\n                    \u002F\u002F 表示返回值类型。\n                    ClassHelper.STRING_TYPE,\n                    \u002F\u002F 表示不接受参数\n                    Parameter.EMPTY_ARRAY,\n                    \u002F\u002F 表示不抛出异常\n                    ClassNode.EMPTY_ARRAY,\n                    code\n            )\n        }\n    }\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E将它注册到 SPI 之后，任何一个类都可以在不改动源代码的情况下直接获得 \u003Ccode\u003EgetAuthor\u003C\u002Fcode\u003E ：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Eprintln new Foo().getAuthor()\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E当然，根据 Groovy 的统一访问原则，对于 \u003Ccode\u003EgetXXX\u003C\u002Fcode\u003E 方法可以直接作为一个属性访问：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Eprintln new Foo().author\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 data-id=\"heading-9\"\u003E8.6 基于注解的局部变换\u003C\u002Fh2\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E本章需要对 Java 注解的创建有一个基本认识，具体可查阅笔者的 \u003Ca href=\"https:\u002F\u002Fjuejin.cn\u002Fpost\u002F6844904164988813325#heading-6\" target=\"_blank\" title=\"https:\u002F\u002Fjuejin.cn\u002Fpost\u002F6844904164988813325#heading-6\"\u003E简单回顾Java注解 (juejin.cn)\u003C\u002Fa\u003E 。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E到目前为止，所有的案例全都是全局的 AST 变换。如果这个 AST 并不是通用的，那么它最好是局部变换而非全局变换。\u003C\u002Fp\u003E\n\u003Cp\u003E一个好的解决方案是将一个 AST 变换和一个标记型注解关联起来 ( 后文为了方便叙述，称这样的注解为 trigger 注解 )。这样，编译器如果在解析类的过程中发现了这些注解，那么就能够根据线索对标记类进行指定的 AST 变换，而被未标记的类则不会受到任何影响。和全局 AST 变换的另一个显著区别是：\u003Cstrong\u003E局部变换不需要注册到 SPI 接口\u003C\u002Fstrong\u003E，\u003Cstrong\u003E如果不小心这么做了，那么程序反而会报错\u003C\u002Fstrong\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003E现在创建一个 \u003Ccode\u003EMessenger\u003C\u002Fcode\u003E 注解，并为它赋予这样的功能：一旦类的定义被该注解标记，那么编译期这个类就会新增一个 \u003Ccode\u003Emessage\u003C\u002Fcode\u003E 方法。该方法接收一个字符串，并将它输出到控制台。同时，\u003Ccode\u003EMessenger\u003C\u002Fcode\u003E 注解有一个 \u003Ccode\u003Eboolean\u003C\u002Fcode\u003E 类型的选项：\u003Ccode\u003Eshout\u003C\u002Fcode\u003E。如果该值为 \u003Ccode\u003Etrue\u003C\u002Fcode\u003E，那么 \u003Ccode\u003Emessage\u003C\u002Fcode\u003E 方法在输出到控制台之前，会将字符串内的英文全部转换为大写形式，否则，不采取任何额外操作。\u003C\u002Fp\u003E\n\u003Cp\u003E一个 Java 注解至少需要两个元注解 \u003Ccode\u003E@Retention\u003C\u002Fcode\u003E 和 \u003Ccode\u003E@Target\u003C\u002Fcode\u003E。除此之外，这里需要额外标记一个元注解 \u003Ccode\u003EGroovyASTTransformClass\u003C\u002Fcode\u003E 去关联指定的 AST 变换。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003E\u002F\u002F 这个注解仅在编译期用于生成方法，因此生命周期保持到源码级别即可。\n@Retention(RetentionPolicy.SOURCE)\n\u002F\u002F 指定这是个标记在类上面的注解。\n@Target(ElementType.TYPE)\n\u002F\u002F 将该注解和指定的 AST 变换关联起来。\n@GroovyASTTransformationClass(classes = MessageAdderAstTransformation.class)\npublic @interface Messenger {\n    boolean shout() default false;\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E下一步便是实现这个 \u003Ccode\u003EMessageAdderAstTransformation\u003C\u002Fcode\u003E 。再次提醒，在局部变换中，这个 AST 变换不需要注册到 SPI 接口。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Eimport groovyjarjarasm.asm.Opcodes;\nimport org.codehaus.groovy.ast.*;\nimport org.codehaus.groovy.ast.expr.*;\nimport org.codehaus.groovy.ast.stmt.ExpressionStatement;\nimport org.codehaus.groovy.control.CompilePhase;\nimport org.codehaus.groovy.control.SourceUnit;\nimport org.codehaus.groovy.transform.AbstractASTTransformation;\nimport org.codehaus.groovy.transform.GroovyASTTransformation;\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\npublic class MessageAdderAstTransformation extends AbstractASTTransformation {\n    @Override\n    public void visit(ASTNode[] astNodes, SourceUnit sourceUnit) {\n        \u002F*\n        `nodes` - The ASTnodes when the call was triggered.\n        Element 0 is the AnnotationNode that triggered this annotation to be activated.\n        Element 1 is the AnnotatedNode decorated, such as a MethodNode or ClassNode.\n        For global transformations it is usually safe to ignore this parameter.\n         *\u002F\n        \u002F\u002F 这里的类型来自 org.codehaus.groovy.ast.* .\n        AnnotationNode msgAnnotation = (AnnotationNode) astNodes[0];\n        \n        \u002F\u002F 从注解中获取 shout 选项的值并设定为常量 (因为是编译期就设定好的值)。\n        \u002F\u002F 它将决定 message 如何操作。\n        ConstantExpression shout = (ConstantExpression) msgAnnotation.getMember(\"shout\");\n        ClassNode annotatedClass = (ClassNode) astNodes[1];\n\t\t\n        \u002F\u002FTODO \n    }\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E在以往全局变换的例子中，我们总是从源单元 \u003Ccode\u003EsourceUnit\u003C\u002Fcode\u003E 获取源码的 AST 树。但在局部变换中，使用第一个参数更合适一些。\u003Ccode\u003EastNodes\u003C\u002Fcode\u003E 参数只有固定的两个元素，下面是 Groovy Doc 的提供的解释：\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E\u003Ccode\u003EastNodes[0]\u003C\u002Fcode\u003E 代表了能够引发 AST 变换的 trigger 注解，可以从该元素中提取 trigger 注解内部的信息。\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003EastNodes[1]\u003C\u002Fcode\u003E 代表了被 trigger 注解标记的 ClassNode，可以从该元素中提取出被 trigger 注解标记的类的 AST 树并施加变换。\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003E显然，每一个局部 AST 变换只会和一个 trigger 注解关联，这是 \u003Ccode\u003E@GroovyASTTransformationClass\u003C\u002Fcode\u003E 元注解里定义的。这里为了方便操作，将 \u003Ccode\u003EastNodes[0]\u003C\u002Fcode\u003E 强制转换为 AnnotationNode，将 \u003Ccode\u003EastNodes[1]\u003C\u002Fcode\u003E 强制转换成 ClassNode。\u003C\u002Fp\u003E\n\u003Cp\u003E剩下的步骤大概都比较明确了：那就是分析下面这段程序的 AST。类似的套路，如果觉得手动分析内部 AST 太过麻烦，可以直接使用 GroovyConsole 工具进行生成。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003E\u002F\u002F 标识符: ACC_PUBlIC,\n\u002F\u002F 返回值: ClassHelper.VOID_TYPE\n\u002F\u002F 参数: [Parameter(ClassHelper.STRING_TYPE,\"message\")]\n\u002F\u002F 抛出异常: ClassNode.EMPTY_ARRAY ( 表示不抛出异常 )\n\u002F\u002F 语法块: {this.println(shout?message.toUpperCase:message)}\npublic void message(String message){\n    \u002F\u002F shout 是一个 boolean 值，源自于 Messengers 注解。\n    this.println(shout?message.toUpperCase:message)\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E完整的代码如下：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Epackage astTest.javaImpl;\n\nimport groovyjarjarasm.asm.Opcodes;\nimport org.codehaus.groovy.ast.*;\nimport org.codehaus.groovy.ast.expr.*;\nimport org.codehaus.groovy.ast.stmt.ExpressionStatement;\nimport org.codehaus.groovy.control.CompilePhase;\nimport org.codehaus.groovy.control.SourceUnit;\nimport org.codehaus.groovy.transform.AbstractASTTransformation;\nimport org.codehaus.groovy.transform.GroovyASTTransformation;\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\npublic class MessageAdderAstTransformation extends AbstractASTTransformation {\n    @Override\n    public void visit(ASTNode[] astNodes, SourceUnit sourceUnit) {\n        \u002F*\n        `nodes` - The ASTnodes when the call was triggered.\n        Element 0 is the AnnotationNode that triggered this annotation to be activated.\n        Element 1 is the AnnotatedNode decorated, such as a MethodNode or ClassNode.\n        For global transformations it is usually safe to ignore this parameter.\n         *\u002F\n        \u002F\u002F 这里的类型来自 org.codehaus.groovy.ast.* .\n        AnnotationNode msgAnnotation = (AnnotationNode) astNodes[0];\n        ConstantExpression shout = (ConstantExpression) msgAnnotation.getMember(\"shout\");\n        ClassNode annotatedClass = (ClassNode) astNodes[1];\n\n        \u002F\u002F 这个局部变量 message 和构造的函数体的 message 变量相对应。\n        VariableExpression message = new VariableExpression(\"message\");\n        MethodCallExpression toUpperCaseCall = new MethodCallExpression(message, \"toUpperCase\", ArgumentListExpression.EMPTY_ARGUMENTS);\n\n        \u002F\u002F 构造了一个这样的一条语句 statement：\n        \u002F\u002F this.println(shout?message.toUpperCase:message)\n        ExpressionStatement code = new ExpressionStatement(\n                new MethodCallExpression(new VariableExpression(\"this\"),\n                        \"println\",\n                        new TernaryExpression(new BooleanExpression(shout), toUpperCaseCall, message))\n        );\n\n\n        \u002F\u002F 创建 message\n        annotatedClass.addMethod(\"message\",\n                Opcodes.ACC_PUBLIC,\n                ClassHelper.VOID_TYPE,\n                new Parameter[]{\n                        \u002F\u002F 参数 message 和局部变量的 message 相对应。\n                        new Parameter(ClassHelper.STRING_TYPE,\"message\")\n                },\n                \u002F\u002F 指代不抛出任何异常\n                ClassNode.EMPTY_ARRAY,\n                code\n                );\n\n        \u002F*\n         最终相当于构造了这样的函数：\n         public void message(String message){\n            \u002F\u002F shout 是一个 boolean 值，源自于 Messengers 注解。\n            this.println(shout?message.toUpperCase:message)\n         }\n         *\u002F\n    }\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 data-id=\"heading-10\"\u003E8.7 AST 杀手锏：AstBuilder\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Cstrong\u003E注意，一但使用 AstBuilder，那么 AST 变换就必须选择 Groovy 语言进行实现\u003C\u002Fstrong\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003EAstBuilder 提供了三种风格的 AST 辅助转换：\u003Ccode\u003EnuildFromSpec\u003C\u002Fcode\u003E，\u003Ccode\u003EbuildFromString\u003C\u002Fcode\u003E，\u003Ccode\u003EbuildFromCode\u003C\u002Fcode\u003E。我们将在一个例子中对这三种 AST 构建方式做出对比：\u003C\u002Fp\u003E\n\u003Cp\u003E创建一个局部 AST 变换，使得所有被名为 \u003Ccode\u003E@InjectAOP\u003C\u002Fcode\u003E 的 trigger 注解标记的类，它内部所有其它方法块内部会被注入一条调用自身 \u003Ccode\u003Ebefore\u003C\u002Fcode\u003E 方法的语句。为了确保目标类实现了 \u003Ccode\u003Ebefore\u003C\u002Fcode\u003E 方法，这里可以使用接口做一些强制性约束。\u003C\u002Fp\u003E\n\u003Cp\u003E给出 trigger 注解的实现：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Epackage astBuilderTest\nimport org.codehaus.groovy.transform.GroovyASTTransformationClass;\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n@Retention(RetentionPolicy.SOURCE)\n@Target(ElementType.TYPE)\n@GroovyASTTransformationClass(classes = InjectAopASTTransformation.class)\npublic @interface InjectAOP {}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E给出目标脚本的实现：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Epackage astBuilderTest\n\n@InjectAOP\nclass Foo implements AOP{\n    @Override\n    void before() {println(\"这段逻辑会被注入到其它方法\")} \u002F\u002F 通过接口强制令该类实现 before 方法。\n    void run(){println(\"测试的方法\")}\n}\n\n\u002F\u002F 目标:执行此脚本，控制台应当输出：\n\u002F\u002F 这段逻辑会被注入到其它方法\n\u002F\u002F 测试的方法\nnew Foo().run()\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E核心目标是 \u003Ccode\u003EInjectAopASTTransformation\u003C\u002Fcode\u003E 的实现。首先给出传统实现：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Epackage astBuilderTest\nimport org.codehaus.groovy.ast.ASTNode\nimport org.codehaus.groovy.ast.ClassNode\nimport org.codehaus.groovy.ast.expr.ArgumentListExpression\nimport org.codehaus.groovy.ast.expr.MethodCallExpression\nimport org.codehaus.groovy.ast.expr.VariableExpression\nimport org.codehaus.groovy.ast.stmt.BlockStatement\nimport org.codehaus.groovy.ast.stmt.ExpressionStatement\nimport org.codehaus.groovy.control.CompilePhase\nimport org.codehaus.groovy.control.SourceUnit\nimport org.codehaus.groovy.transform.ASTTransformation\nimport org.codehaus.groovy.transform.GroovyASTTransformation\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\nclass InjectAopASTTransformation implements ASTTransformation {\n    @Override\n    void visit(ASTNode[] nodes, SourceUnit source) {\n        def classNode = nodes[1] as ClassNode\n\n        \u002F\u002F 确保它实现了 AOP 接口。\n        \u002F\u002F 在 AST 内部，所有信息全部是 ASTNode 形式，因此需要将等待判断的 AOP 接口类型转换为 ClassNode 并比较。\n        \u002F\u002F 这和一般的判别方式有所不同。\n        def c = new ClassNode(AOP.class)\n        println classNode.interfaces.contains(c)\n\n        \u002F\u002F 找出所有其它方法\n        def methods = classNode.methods.findAll {\n            it.name != \"before\"\n        }\n\n        \u002F\u002F -------------AstBuilder 主要负责重构的部分------------------\u002F\u002F\n        def beforeCall = new ExpressionStatement(\n                new MethodCallExpression(\n                        new VariableExpression('this'),\n                        'before',\n                        ArgumentListExpression.EMPTY_ARGUMENTS\n                )\n        )\n\n        methods.each {\n            ((BlockStatement) it.code).statements.add(0, beforeCall)\n        }\n        \u002F\u002F ---------------------------------------------------------\u002F\u002F\n\n    }\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E第一种：\u003Ccode\u003EbuildFromSpec\u003C\u002Fcode\u003E。它本质上是创建了一个内部 DSL，使我们在创建各种 ASTNode 的过程中免去了频繁的 \u003Ccode\u003Enew\u003C\u002Fcode\u003E 关键字声明。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Epackage astBuilderTest\nimport org.codehaus.groovy.ast.ASTNode\nimport org.codehaus.groovy.ast.ClassNode\nimport org.codehaus.groovy.ast.builder.AstBuilder\nimport org.codehaus.groovy.ast.stmt.BlockStatement\nimport org.codehaus.groovy.ast.stmt.Statement\nimport org.codehaus.groovy.control.CompilePhase\nimport org.codehaus.groovy.control.SourceUnit\nimport org.codehaus.groovy.transform.ASTTransformation\nimport org.codehaus.groovy.transform.GroovyASTTransformation\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\nclass InjectAopASTTransformation implements ASTTransformation {\n    @Override\n    void visit(ASTNode[] nodes, SourceUnit source) {\n        def classNode = nodes[1] as ClassNode\n\n        \u002F\u002F 确保它实现了 AOP 接口。\n        \u002F\u002F 在 AST 内部，所有信息全部是 ASTNode 形式，因此需要将等待判断的 AOP 接口类型转换为 ClassNode 并比较。\n        \u002F\u002F 这和一般的判别方式有所不同。\n        def c = new ClassNode(AOP.class)\n        assert classNode.interfaces.contains(c)\n\n        \u002F\u002F 找出所有其它方法\n        def methods = classNode.methods.findAll {\n            it.name != \"before\"\n        }\n\n        \u002F\u002F -------------AstBuilder 主要负责重构的部分------------------\u002F\u002F\n        def beforeCall = new AstBuilder().buildFromSpec {\n            \u002F\u002F ExpressionStatement\n            expression {\n                methodCall {\n                    variable 'this'\n                    constant 'before'\n                    argumentList {}\n                }\n            }\n        } as List&#x3C;Statement\u003E\n\n        methods.each {\n            ((BlockStatement) it.code).statements.add(0, beforeCall[0])\n        }\n        \u002F\u002F ---------------------------------------------------------\u002F\u002F\n\n    }\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E其 DSL 的构建方式只是在写法上减少了一点构建 AST 的负担，但是仍然要求我们熟练掌握 Groovy 提供的各种 AST 节点及其构建方式。对于不熟悉 \u003Ccode\u003Eorg.codehaus.groovy.ast\u003C\u002Fcode\u003E 包下各种类型的开发者而言，构建 AST 仍然是一个繁琐且困难的工作。\u003C\u002Fp\u003E\n\u003Cp\u003E假如有这样一个工具，能够允许我们按照日常的习惯编写源代码，然后由它自动转换为 AST 树就好了 ( 这样的话，我们甚至都不用深入了解 AST 树了! )。AstBuilder 正好解决了这个痛点。下面介绍 AstBuilder 第二种使用方式：\u003Ccode\u003EbuildFromCode\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Epackage astBuilderTest\nimport org.codehaus.groovy.ast.ASTNode\nimport org.codehaus.groovy.ast.ClassNode\nimport org.codehaus.groovy.ast.builder.AstBuilder\nimport org.codehaus.groovy.ast.stmt.BlockStatement\nimport org.codehaus.groovy.ast.stmt.Statement\nimport org.codehaus.groovy.control.CompilePhase\nimport org.codehaus.groovy.control.SourceUnit\nimport org.codehaus.groovy.transform.ASTTransformation\nimport org.codehaus.groovy.transform.GroovyASTTransformation\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\nclass InjectAopASTTransformation implements ASTTransformation {\n    @Override\n    void visit(ASTNode[] nodes, SourceUnit source) {\n        def classNode = nodes[1] as ClassNode\n\n        \u002F\u002F 确保它实现了 AOP 接口。\n        \u002F\u002F 在 AST 内部，所有信息全部是 ASTNode 形式，因此需要将判断的 AOP 接口类型装入到 ClassNode 并比较。\n        \u002F\u002F 这和一般的判别方式有所不同。\n        def c = new ClassNode(AOP.class)\n        assert classNode.interfaces.contains(c)\n\n        \u002F\u002F 找出所有其它方法\n        def methods = classNode.methods.findAll {\n            it.name != \"before\"\n        }\n\n        \u002F\u002F -------------AstBuilder 主要负责重构的部分------------------\u002F\u002F\n        \u002F\u002F AstBuilder 独立于 InjectAopASTTransformation 进行编译。\n        def beforeCall = new AstBuilder().buildFromCode(CompilePhase.SEMANTIC_ANALYSIS){\n            this.before()\n        } as List&#x3C;Statement\u003E\n        \n        methods.each {\n            \u002F\u002F ((BlockStatement) it.code).statements.addAll(0,beforeCall)\n            ((BlockStatement) it.code).statements.add(0,beforeCall[0])\n        }\n       \u002F\u002F ---------------------------------------------------------\u002F\u002F\n    }\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E这里有很多细节需要说明。如我们所见，\u003Ccode\u003EbuildFromCode\u003C\u002Fcode\u003E 方法的闭包内允许直接放入一段代码块，我们不再需要在各种复杂的 AST 结构当中挣扎。除此之外，该方法还指明 AstBuilder 在某个阶段 ( 此处是 \u003Ccode\u003ECompilePhase.SEMANTIC_ANALYSIS\u003C\u002Fcode\u003E ) \u003Cstrong\u003E将闭包的内代码转为等价的 AST\u003C\u002Fstrong\u003E ( 笔者推测 AstBuilder 的 AST 变换过程和 \u003Ccode\u003EInjectAopASTTransformation\u003C\u002Fcode\u003E 的 AST 变换是分开且独立的，但是 Groovy Doc 给出的解释令我云里雾里，网上也没有足够资料 ) 。\u003C\u002Fp\u003E\n\u003Cp\u003E实际上，\u003Ccode\u003EbuildFromCode\u003C\u002Fcode\u003E 返回的是一个抽象的 \u003Ccode\u003EList&#x3C;ASTNode\u003E\u003C\u002Fcode\u003E 类型。为了便于操作，这里通过 \u003Ccode\u003Eas\u003C\u002Fcode\u003E 符号将其转换为了 \u003Ccode\u003EList&#x3C;Statement\u003E\u003C\u002Fcode\u003E 类型 。 注，\u003Ccode\u003Eas\u003C\u002Fcode\u003E 操作符依赖调用者的 \u003Ccode\u003EasType\u003C\u002Fcode\u003E 方法，和强制转换的概念有区别。无论我们在 \u003Ccode\u003EbuildFromCode\u003C\u002Fcode\u003E 内创建了多少语句块，它们最终总是被包装为一个 BlockStatement，然后再装入到一个 List 内部。\u003C\u002Fp\u003E\n\u003Cp\u003E换句话说，通过访问 \u003Ccode\u003EbeforeCall[0]\u003C\u002Fcode\u003E 就可以获取到 AstBuilder 为我们转换好的 AST 了。注意，一旦进入到 \u003Ccode\u003EbuildFromCode\u003C\u002Fcode\u003E ( 还有后文的 \u003Ccode\u003EbuildFromString\u003C\u002Fcode\u003E ) 方法的闭包内部，\u003Cstrong\u003EIntelliJ IDE 就无法再为我们提供有效的代码提示\u003C\u002Fstrong\u003E，甚至有时还会出现 \"误导\" 的情况。比如：上述代码块内的 \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 可不是指代这个 AST 变换类本身，而是指代上下文中被注入的那个对象 \"that\"，调用的是 \"that\" 的 \u003Ccode\u003Ebefore\u003C\u002Fcode\u003E 方法。\u003C\u002Fp\u003E\n\u003Cp\u003E第三种，\u003Ccode\u003EbuildFromString\u003C\u002Fcode\u003E。这种方式和 \u003Ccode\u003EbuildFromCode\u003C\u002Fcode\u003E 非常接近，只不过 AstBuilder 这一次转化的目标是 \u003Ccode\u003EString\u003C\u002Fcode\u003E 类型。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-groovy copyable\" lang=\"groovy\"\u003Epackage astBuilderTest\nimport org.codehaus.groovy.ast.ASTNode\nimport org.codehaus.groovy.ast.ClassNode\nimport org.codehaus.groovy.ast.builder.AstBuilder\nimport org.codehaus.groovy.ast.stmt.BlockStatement\nimport org.codehaus.groovy.ast.stmt.Statement\nimport org.codehaus.groovy.control.CompilePhase\nimport org.codehaus.groovy.control.SourceUnit\nimport org.codehaus.groovy.transform.ASTTransformation\nimport org.codehaus.groovy.transform.GroovyASTTransformation\n\n@GroovyASTTransformation(phase = CompilePhase.SEMANTIC_ANALYSIS)\nclass InjectAopASTTransformation implements ASTTransformation {\n    @Override\n    void visit(ASTNode[] nodes, SourceUnit source) {\n        def classNode = nodes[1] as ClassNode\n\n        \u002F\u002F 确保它实现了 AOP 接口。\n        \u002F\u002F 在 AST 内部，所有信息全部是 ASTNode 形式，因此需要将等待判断的 AOP 接口类型转换为 ClassNode 并比较。\n        \u002F\u002F 这和一般的判别方式有所不同。\n        def c = new ClassNode(AOP.class)\n        assert classNode.interfaces.contains(c)\n\n        \u002F\u002F 找出所有其它方法\n        def methods = classNode.methods.findAll {\n            it.name != \"before\"\n        }\n\n        \u002F\u002F -------------AstBuilder 主要负责重构的部分------------------\u002F\u002F\n        \u002F\u002F AstBuilder 独立于 InjectAopASTTransformation 进行编译。\n        def info = \"println \\\"this source build by AstBuilder\\\" \"\n        def beforeCall = new AstBuilder().buildFromString(CompilePhase.SEMANTIC_ANALYSIS,\"\"\"\n            this.before()\n            ${info}\n        \"\"\") as List&#x3C;Statement\u003E\n        \n        methods.each {\n            ((BlockStatement) it.code).statements.add(0,beforeCall[0])\n        }\n        \u002F\u002F -------------等待 AstBuilder 重构的部分------------------\u002F\u002F\n    }\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E和 \u003Ccode\u003EbuildFromCode\u003C\u002Fcode\u003E 相比，它的优势是允许我们能够像拼凑 GString 一样自由地组合源代码 ( 并且不再需要关心它的 AST 结构，因为 AstBuilder 会替我们搞定 )，而缺点则是可能会遇到一些字符串转义的烦恼。\u003C\u002Fp\u003E\n\u003Ch2 data-id=\"heading-11\"\u003E8.8 补充：部分 AST 节点表示为 “空” 的方式\u003C\u002Fh2\u003E\n\u003Cp\u003E如果要构造一个空语句块，则需要创建 EmptyStatement 实例。\u003C\u002Fp\u003E\n\u003Cp\u003E当构造 MethodCallExpression 时，如果遇到空括号方法的调用，那么参数列表应表示为 \u003Ccode\u003EArgumentListExpression.EMPTY_ARGUMENTS\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003E当进行编译期方法构造 ( 对某个 ClassNode 调用 \u003Ccode\u003EaddMethod\u003C\u002Fcode\u003E 方法 ) 时，如果此方法是空括号方法，那么参数列表应表示为 \u003Ccode\u003EParameter.EMPTY_ARRAY\u003C\u002Fcode\u003E。如果此方法不抛出任何异常，那么应表示为 \u003Ccode\u003EClassNode.EMPTY_ARRAY\u003C\u002Fcode\u003E。如果该方法不返回值，应表示为 \u003Ccode\u003EClassHelper.VOID_TYPE\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003E在构造方法返回值类型，或是属性类型时，使用 Groovy 提供 ClassHelper 去完成。\u003C\u002Fp\u003E\n\u003Ch2 id=\"user-content-footnote-label\" class=\"sr-only\" data-id=\"heading-12\"\u003EFootnotes\u003C\u002Fh2\u003E\n\u003Col\u003E\n\u003Cli id=\"user-content-user-content-fn-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AFsystem.out%EF%BC%9F\"\u003E\n\u003Cp\u003EGroovy 给所有的 GroovyObject 都绑定了 print 方法，因此调用者自然就是 this 。 \u003Ca href=\"#user-content-fnref-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AFsystem.out%EF%BC%9F\" data-footnote-backref=\"\" class=\"data-footnote-backref\" aria-label=\"Back to content\" title=\"#user-content-fnref-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AFsystem.out%EF%BC%9F\"\u003E↩\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli id=\"user-content-user-content-fn-%E5%91%B3%E9%81%93%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F\"\u003E\n\u003Cp\u003E常见的代码异味包括 Duplicated Code，Long Method，Switch Statement，以及其它可以想到的不良代码，详情可见\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=http%3A%2F%2Fwww.nowamagic.net%2Flibrarys%2Fveda%2Fdetail%2F2053\" target=\"_blank\" rel=\"nofollow noopener noreferrer\" title=\"http:\u002F\u002Fwww.nowamagic.net\u002Flibrarys\u002Fveda\u002Fdetail\u002F2053\" ref=\"nofollow noopener noreferrer\"\u003E一些常见的代码异味 Code Smell -- 简明现代魔法 (nowamagic.net)\u003C\u002Fa\u003E。 \u003Ca href=\"#user-content-fnref-%E5%91%B3%E9%81%93%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F\" data-footnote-backref=\"\" class=\"data-footnote-backref\" aria-label=\"Back to content\" title=\"#user-content-fnref-%E5%91%B3%E9%81%93%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F\"\u003E↩\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli id=\"user-content-user-content-fn-%E6%80%8E%E6%A0%B7%E7%AE%97%E7%AC%A6%E5%90%88%E8%AF%AD%E4%B9%89%EF%BC%9F\"\u003E\n\u003Cp\u003E比如插入方法时设定返回值为 \u003Ccode\u003EString\u003C\u002Fcode\u003E，那么该方法的 BlockStatement 的最后一个元素应当是返回字符串类型的 ReturnStatement。 \u003Ca href=\"#user-content-fnref-%E6%80%8E%E6%A0%B7%E7%AE%97%E7%AC%A6%E5%90%88%E8%AF%AD%E4%B9%89%EF%BC%9F\" data-footnote-backref=\"\" class=\"data-footnote-backref\" aria-label=\"Back to content\" title=\"#user-content-fnref-%E6%80%8E%E6%A0%B7%E7%AE%97%E7%AC%A6%E5%90%88%E8%AF%AD%E4%B9%89%EF%BC%9F\"\u003E↩\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n",showSidebar:a,actionType:{FETCH:"view\u002Fcolumn\u002FFETCH",FETCH_CACHED_HTML:"view\u002Fcolumn\u002FFETCH_CACHED_HTML",FETCH_ADDITIONAL:"view\u002Fcolumn\u002FFETCH_ADDITIONAL",FETCH_SIDEBAR_ADENTRY:"view\u002Fcolumn\u002FFETCH_SIDEBAR_ADENTRY",FETCH_AUTHOR_EXTRA:"view\u002Fcolumn\u002FFETCH_AUTHOR_EXTRA",RESET:"view\u002Fcolumn\u002FRESET"},recommendedArticleList:{list:[],cursor:f,loading:a,skeleton:a,hasMore:a,articleId:e,actionType:{UPDATE_STATE:"view\u002Fcolumn\u002Frecommend-List\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fcolumn\u002Frecommend-List\u002FFETCH_MORE",FETCH:"view\u002Fcolumn\u002Frecommend-List\u002FFETCH",RESET:"view\u002Fcolumn\u002Frecommend-List\u002FRESET"}}},collection:{collection:{author:{}},actionType:{FETCH:"@\u002Fview\u002Fcollection\u002FFETCH",REFRESH:"@\u002Fview\u002Fcollection\u002FREFRESH",RESET:"@\u002Fview\u002Fcollection\u002FRESET"},list:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fcollection\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fcollection\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fcollection\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fcollection\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fcollection\u002Flist\u002FRESET"},id:e,sort:m}},gettingStarted:{category:{},actionType:{UPDATE_STATE:"@\u002Fview\u002FgettingStarted\u002FUPDATE_STATE",FOLLOW:"@\u002Fview\u002FgettingStarted\u002FFOLLOW",RESET:"@\u002Fview\u002FgettingStarted\u002FRESET",UPDATE_CATEGORY:"@\u002Fview\u002FgettingStarted\u002FUPDATE_CATEGORY"}},pin:{pin:{user:{},imageUrlList:[]},pinList:[],actionType:{FETCH:"@\u002Fview\u002Fpin\u002FFETCH",RESET:"@\u002Fview\u002Fpin\u002FRESET"},sidebar:{list:[],after:e,loading:a,isRecommend:a,hasNextPage:b,actionType:{UPDATE_STATE:"@\u002Fview\u002Fpin\u002Fsidebar\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fpin\u002Fsidebar\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Fpin\u002Fsidebar\u002FFETCH",RESET:"@\u002Fview\u002Fpin\u002Fsidebar\u002FRESET"}},commentList:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fpin\u002FcommentList\u002FUPDATE",FETCH:"@\u002Fview\u002Fpin\u002FcommentList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fpin\u002FcommentList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fpin\u002FcommentList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fpin\u002FcommentList\u002FRESET"},pinId:c},subCommentList:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FUPDATE",FETCH:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FRESET"},commentId:c}},topic:{topic:e,followedTopicList:[],actionType:{FETCH:"@\u002Fview\u002Ftopic\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Ftopic\u002FUPDATE_STATE",RESET:"@\u002Fview\u002Ftopic\u002FRESET"},allTopicList:{pageSize:x,page:d,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FRESET"},sortType:l},pinlist:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FpinList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FpinList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FpinList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FpinList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FpinList\u002FRESET"},sortType:t},sidebar:{actionType:{RESET:"@\u002Fview\u002Ftopic\u002Fsidebar\u002FRESET",UPDATE_STATE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002FUPDATE_STATE"},attender:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FRESET"},topicId:c}},followedList:{pageSize:x,page:d,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FRESET"},after:d}},recommendationIndex:{actionType:{FETCH_USER:"@\u002Fview\u002Frecommendation\u002FFETCH_USER",FETCH_MORE:"@\u002Fview\u002Frecommendation\u002FFETCH_MORE",RESET:"@\u002Fview\u002Frecommendation\u002FRESET",FETCH:"@\u002Fview\u002Frecommendation\u002FFETCH"},cursor:e,hasMore:e,userList:[],loading:a,skeleton:b,category:k,categoryNavList:[],serverRenderUserList:a},event:{event:{},loading:a,user:{},actionType:{FETCH:"view\u002Fevent\u002FFETCH",RESET:"view\u002Fevent\u002FRESET"}},academyIndex:{academy:{},bannerList:[],qualitiedList:[],latestList:[],offlineList:[],loading:a,user:{},actionType:{FETCH:"view\u002Facademy\u002FFETCH",RESET:"view\u002Facademy\u002FRESET"}},coursesIndex:{loading:a,list:[],sort:"online",actionType:{FETCH:"view\u002Fcourses\u002FFETCH",RESET:"view\u002Fcourses\u002FRESET",FETCH_MORE:"view\u002Fcourses\u002FFETCH_MORE"}},team:{team:{},loading:b,actionType:{FETCH:"@\u002Fview\u002Fteam\u002FFETCH",RESET:"@\u002Fview\u002Fteam\u002FRESET",UPDATE:"@\u002Fview\u002Fteam\u002FUPDATE",FOLLOW:"@\u002Fview\u002Fteam\u002FFOLLOW"},detailList:{actionType:{RESET:"@\u002Fview\u002Fteam\u002FdetailList\u002FRESET"},posts:{list:[],hasMore:a,skeleton:a,loading:a,sort:m,actionType:{FETCH:"@\u002Fview\u002Fteam\u002FdetailList\u002Fposts\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fposts\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fposts\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fteam\u002FdetailList\u002Fposts\u002FRESET"}},pins:{list:[],hasMore:a,loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fteam\u002FdetailList\u002Fpins\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fpins\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fpins\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fteam\u002FdetailList\u002Fpins\u002FRESET"}},hire:{list:[],hasMore:a,cursor:f,loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fteam\u002FdetailList\u002Fhire\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fhire\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fhire\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fteam\u002FdetailList\u002Fhire\u002FRESET"}}}},couponList:{list:{"0":u,"1":u,"2":u}},payment:{selectedDiscount:{},bookletDetail:{},coupons:{availables:[],unavailables:[]}}},component:{indexAside:{bannerList:[],userList:[],actionType:{FETCH_BANNER:"@\u002Fcomponent\u002Faside\u002FFETCH_BANNER",FETCH_USER:"@\u002Fcomponent\u002Faside\u002FFETCH_USER",CLOSE_BANNER:"@\u002Fcomponent\u002Faside\u002FCLOSE_BANNER"}}},ore:{oreCount:d},avatarMenuInfo:{},common:{theme:"light"},env:{ua:"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F107.0.0.0 Safari\u002F537.36",serverEnv:"production"},auth:{user:c,clientId:e,token:e},tag:{subscribedTagList:[]},entry:{isLikeLoading:a},collection:{},comment:{},bookComment:{},repoComment:{},category:{list:[]},user:{subscribedTagList:[]},notification:{unreadCount:{user:d,system:d,total:d}},follow:{subscribedTagList:[]},error:{location:c,errorView:c,statusCode:200},abTest:{info:{}},suspensionPanel:{needSuspension:b},pinComment:{},pin:{deleteDialogVisible:a,reportDialogVisible:a,targetPin:c,isOnFocus:a},topic:{visible:a},activity:{"2020":{},offer:{is_show:d,start_time:d},voteData:{err_no:d,err_msg:"success",data:{face:{title:e,activity_id:"2024",start_time:1657814400,end_time:1668787200,status:n,image:"https:\u002F\u002Fp9-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fd4bdb22a62c64ebd9eadc0646d5b6a53~tplv-k3u1fbpfcp-zoom-1.image",close_image:"https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F882fc263e36347ffbf6d598de520870e~tplv-k3u1fbpfcp-image.image",url:"https:\u002F\u002Fjuejin.cn\u002Fmagic\u002Feco\u002Fruntime\u002Frelease\u002F636c6d57dd25b303e84121e9?appType=juejin&magic_page_no=1",is_show:d},top:{title:o,activity_id:p,start_time:q,end_time:r,status:g,image:"https:\u002F\u002Fp1-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fac22d16bd96248f48b9f63ab747a1e04~tplv-k3u1fbpfcp-zoom-1.image",close_image:"https:\u002F\u002Fp1-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F4e7fb9a08a1d4f13889588806b35d2ba~tplv-k3u1fbpfcp-zoom-1.image?",url:"https:\u002F\u002Fjuejin.cn\u002Fchallenge\u002F1?utm_source=app_nav",is_show:g},web_top:{title:o,activity_id:p,start_time:q,end_time:r,status:g,image:j,close_image:j,url:"https:\u002F\u002Fjuejin.cn\u002Fchallenge\u002F1?utm_source=web_nav",is_show:g},plugin_top:{title:o,activity_id:p,start_time:q,end_time:r,status:g,image:j,close_image:j,url:"https:\u002F\u002Fjuejin.cn\u002Fchallenge\u002F1?utm_source=extension_nav",is_show:g},search_top:{title:"我的2021年度报告",activity_id:y,start_time:z,end_time:1642348799,status:n,image:A,close_image:B,url:"https:\u002F\u002Fjuejin.cn\u002Freport2021\u002Fmobile?utm_campaign=report_2021&utm_medium=app_search&share_title=2021%E6%8E%98%E5%8F%8B%E5%B9%B4%E5%BA%A6%E6%8A%A5%E5%91%8A&share_desc=%E8%A7%A3%E9%94%81%E5%B9%B4%E5%BA%A6%E6%8A%A5%E5%91%8A%EF%BC%8C%E9%A2%86%E5%8F%96%E4%B8%93%E5%B1%9E%E5%BE%BD%E7%AB%A0&share_image=https%3A%2F%2Fp9-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F26a9012785e643a6a520ed63b513c57e~tplv-k3u1fbpfcp-image.image",is_show:d},web_search:{title:"字节内部课会员免费学",activity_id:y,start_time:z,end_time:1664121599,status:n,image:A,close_image:B,url:"https:\u002F\u002Fjuejin.cn\u002Fpost\u002F7143435263472041998?utm_source=search&utm_medium=OM&utm_campaign=vip_activity_kxj",is_show:d},jcode_top:{title:o,activity_id:p,start_time:q,end_time:r,status:g,image:j,close_image:j,url:"https:\u002F\u002Fjuejin.cn\u002Fchallenge\u002F1?utm_source=code_nav",is_show:g},offer:{title:e,activity_id:"2020",start_time:1617638400,end_time:1618934400,status:n,image:"https:\u002F\u002Fp9-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F2879410508de459c91ae8b7509ca75f8~tplv-k3u1fbpfcp-zoom-1.image",close_image:"https:\u002F\u002Fp9-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fa38d640009e14c87a7d29cd95dee27dd~tplv-k3u1fbpfcp-zoom-1.image",url:"https:\u002F\u002Fjuejin-activity.bytedance.net\u002Frank",is_show:d}}}},header:{leadStep:d,isPopupZlink:a},tcc:{tccConfig:c},route:{name:"column",path:v,hash:e,query:{},params:{id:w},fullPath:v,meta:{},from:{name:c,path:C,hash:e,query:{},params:{},fullPath:C,meta:{}}}},serverRendered:b,routePath:v,config:{API_HOST:"api.juejin.cn",CAPTCHA_HOST:"verify.snssdk.com",PLATFORM_APPID:{wechat:1277,weibo:1276,github:1045,wechatApp:1070},SCM_VERSION:"1.0.0.5937",http:{}},globalRefs:{}}}(false,true,null,0,"","0",1,20,"topic","https:\u002F\u002Fp6-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F759e2aa805c0461b840e0f0f09ed05fa~tplv-k3u1fbpfcp-zoom-1.image?","recommended","hot","newest",2,"1024 码上掘金编程挑战赛","2022",1666540800,1669823999,"following","popular",{},"\u002Fpost\u002F6970928380812197901","6970928380812197901",100,"2021",1641780000,"https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fa06289e83d9640c4b8504d2626cfbbee~tplv-k3u1fbpfcp-image.image","https:\u002F\u002Fp9-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fe5199830276c4a85bc7c8cb8edecd54d~tplv-k3u1fbpfcp-image.image","\u002F"));</script><script src="./Groovy AST 之旅 - 掘金_files/1962f0f.js.下载" defer=""></script><script src="./Groovy AST 之旅 - 掘金_files/7e1140b.js.下载" defer=""></script><script src="./Groovy AST 之旅 - 掘金_files/7b24b05.js.下载" defer=""></script><script src="./Groovy AST 之旅 - 掘金_files/8abf2a2.js.下载" defer=""></script><script src="./Groovy AST 之旅 - 掘金_files/2d95a65.js.下载" defer=""></script><script src="./Groovy AST 之旅 - 掘金_files/4809dd4.js.下载" defer=""></script><script src="./Groovy AST 之旅 - 掘金_files/def72f5.js.下载" defer=""></script>
  

<link href="./Groovy AST 之旅 - 掘金_files/51.8344ef6.css" rel="stylesheet" type="text/css"><link href="./Groovy AST 之旅 - 掘金_files/default.2050f18.css" rel="stylesheet" type="text/css"><div data-transfer="true" class="collection-list-modal byte-modal v-transfer-dom" data-v-6bd26e03="" data-v-b7c4e7d2=""><div class="byte-modal__mask" style="z-index: 1000; display: none;"></div><div class="byte-modal__wrapper" style="z-index: 1000; display: none;"><div class="byte-modal__content" style="width:520px;"><!----><div class="byte-modal__body"></div><!----></div></div></div><div data-v-6bd26e03="" data-v-4fa94e66="" data-transfer="true" class="collection-list-modal byte-modal v-transfer-dom"><div class="byte-modal__mask" style="z-index: 1001; display: none;"></div><div class="byte-modal__wrapper" style="z-index: 1001; display: none;"><div class="byte-modal__content" style="width: 520px;"><!----><div class="byte-modal__body"></div><!----></div></div></div><link href="./Groovy AST 之旅 - 掘金_files/177.290e99d.css" rel="stylesheet" type="text/css"><link href="./Groovy AST 之旅 - 掘金_files/134.092fb39.css" rel="stylesheet" type="text/css"><link href="./Groovy AST 之旅 - 掘金_files/22.f94fff0.css" rel="stylesheet" type="text/css"><div data-v-8bb78912="" data-transfer="true" class="upgrade-new-modal byte-modal v-transfer-dom"><div class="byte-modal__mask" style="z-index: 1002; display: none;"></div><div class="byte-modal__wrapper" style="z-index: 1002; display: none;"><div class="byte-modal__content" style="width: 311px;"><div class="byte-modal__header"><span class="byte-modal__title"></span><!----></div><div class="byte-modal__body"> <!----> <div data-v-8bb78912="" class="close-icon"><img data-v-8bb78912="" src="./Groovy AST 之旅 - 掘金_files/8867e249c23a7c0ea596c139befc04d7.svg" alt=""></div></div><!----></div></div></div><div data-v-41eefe39="" data-transfer="true" class="lead byte-modal v-transfer-dom"><div class="byte-modal__mask" style="z-index: 1003; display: none;"></div><div class="byte-modal__wrapper" style="z-index: 1003; display: none;"><div class="byte-modal__content" style="width: 500px;"><div class="byte-modal__header"><img data-v-41eefe39="" src="./Groovy AST 之旅 - 掘金_files/MaskGroup.13dfc4f.png" alt="" loading="lazy" class="header-bgc"> <span data-v-41eefe39="" class="header-title">选择你感兴趣的技术方向</span><span aria-label="Close" class="byte-modal__headerbtn"><i class="byte-icon byte-icon--close"><svg t="1561638608887" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="441911" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M512 448l288-288c6.4-6.4 19.2-6.4 32 0l25.6 32c6.4 6.4 6.4 19.2 0 32L569.6 505.6l288 288c6.4 6.4 6.4 19.2 0 32l-32 32c-6.4 6.4-19.2 6.4-32 0L512 569.6l-288 288c-6.4 6.4-19.2 6.4-32 0l-32-32c-6.4-6.4-6.4-19.2 0-32L448 505.6 160 224c-6.4-12.8-6.4-25.6 0-32l32-32c6.4-6.4 19.2-6.4 32 0L512 448z" p-id="441912"></path><path d="M512 448l288-288c6.4-6.4 19.2-6.4 32 0l25.6 32c6.4 6.4 6.4 19.2 0 32L569.6 505.6l288 288c6.4 6.4 6.4 19.2 0 32l-32 32c-6.4 6.4-19.2 6.4-32 0L512 569.6l-288 288c-6.4 6.4-19.2 6.4-32 0l-32-32c-6.4-6.4-6.4-19.2 0-32L448 505.6 160 224c-6.4-12.8-6.4-25.6 0-32l32-32c6.4-6.4 19.2-6.4 32 0L512 448z" p-id="441913"></path></svg></i></span></div><div class="byte-modal__body"> <div data-v-41eefe39="" class="classify-box"><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><path data-v-41eefe39="" id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M2 2.5C1.44772 2.5 1 2.94772 1 3.5V11.5C1 12.0523 1.44772 12.5 2 12.5H14C14.5523 12.5 15 12.0523 15 11.5V3.5C15 2.94772 14.5523 2.5 14 2.5H2ZM4.5 7.5C4.22386 7.5 4 7.72386 4 8V10C4 10.2761 4.22386 10.5 4.5 10.5H5C5.27614 10.5 5.5 10.2761 5.5 10V8C5.5 7.72386 5.27614 7.5 5 7.5H4.5ZM7 5.5C7 5.22386 7.22386 5 7.5 5H8C8.27614 5 8.5 5.22386 8.5 5.5V10C8.5 10.2761 8.27614 10.5 8 10.5H7.5C7.22386 10.5 7 10.2761 7 10V5.5ZM10.5 6.5C10.2239 6.5 10 6.72386 10 7V10C10 10.2761 10.2239 10.5 10.5 10.5H11C11.2761 10.5 11.5 10.2761 11.5 10V7C11.5 6.72386 11.2761 6.5 11 6.5H10.5Z" fill="#86909C"></path><rect data-v-41eefe39="" id="Rectangle 282" x="3" y="13.5" width="10" height="1.3" rx="0.5" fill="#86909C"></rect></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              后端
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><path data-v-41eefe39="" id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M2 2.5C1.44772 2.5 1 2.94772 1 3.5V6.5H15V3.5C15 2.94772 14.5523 2.5 14 2.5H2ZM15 7.8H1V13.5C1 14.0523 1.44772 14.5 2 14.5H14C14.5523 14.5 15 14.0523 15 13.5V7.8ZM8.65811 8.52566C8.92009 8.61298 9.06167 8.89614 8.97434 9.15811L7.97434 12.1581C7.88702 12.4201 7.60386 12.5617 7.34189 12.4743C7.07991 12.387 6.93833 12.1039 7.02566 11.8419L8.02566 8.84189C8.11298 8.57991 8.39614 8.43833 8.65811 8.52566ZM3.5 5.5C3.77614 5.5 4 5.27614 4 5C4 4.72386 3.77614 4.5 3.5 4.5C3.22386 4.5 3 4.72386 3 5C3 5.27614 3.22386 5.5 3.5 5.5ZM5.5 5C5.5 5.27614 5.27614 5.5 5 5.5C4.72386 5.5 4.5 5.27614 4.5 5C4.5 4.72386 4.72386 4.5 5 4.5C5.27614 4.5 5.5 4.72386 5.5 5ZM6.5 5.5C6.77614 5.5 7 5.27614 7 5C7 4.72386 6.77614 4.5 6.5 4.5C6.22386 4.5 6 4.72386 6 5C6 5.27614 6.22386 5.5 6.5 5.5ZM6.44721 9.27639C6.57071 9.52338 6.4706 9.82372 6.22361 9.94721L5.11803 10.5L6.22361 11.0528C6.4706 11.1763 6.57071 11.4766 6.44721 11.7236C6.32372 11.9706 6.02338 12.0707 5.77639 11.9472L3.77639 10.9472C3.607 10.8625 3.5 10.6894 3.5 10.5C3.5 10.3106 3.607 10.1375 3.77639 10.0528L5.77639 9.05279C6.02338 8.92929 6.32372 9.0294 6.44721 9.27639ZM9.77639 9.94721C9.5294 9.82372 9.42929 9.52338 9.55279 9.27639C9.67628 9.0294 9.97662 8.92929 10.2236 9.05279L12.2236 10.0528C12.393 10.1375 12.5 10.3106 12.5 10.5C12.5 10.6894 12.393 10.8625 12.2236 10.9472L10.2236 11.9472C9.97662 12.0707 9.67628 11.9706 9.55279 11.7236C9.42929 11.4766 9.5294 11.1763 9.77639 11.0528L10.882 10.5L9.77639 9.94721Z" fill="#86909C"></path></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              前端
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><rect data-v-41eefe39="" id="Rectangle 287" x="5.7002" y="12.5" width="1.3" height="3" rx="0.5" fill="#86909C"></rect><rect data-v-41eefe39="" id="Rectangle 289" x="1" y="6.5" width="1.3" height="6" rx="0.5" fill="#86909C"></rect><rect data-v-41eefe39="" id="Rectangle 290" x="13.7002" y="6.5" width="1.3" height="6" rx="0.5" fill="#86909C"></rect><rect data-v-41eefe39="" id="Rectangle 288" x="9" y="12.5" width="1.3" height="3" rx="0.5" fill="#86909C"></rect><path data-v-41eefe39="" id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M13 5.86364V12.5C13 13.0523 12.5523 13.5 12 13.5H4C3.44772 13.5 3 13.0523 3 12.5V5.86364V5.77273C3 5.74067 3.00151 5.70897 3.00446 5.67768C3.11608 3.35397 5.30996 1.5 8 1.5C10.69 1.5 12.8839 3.35397 12.9955 5.67768C12.9985 5.70897 13 5.74067 13 5.77273V5.86364ZM7 6.25C7 6.66421 6.66421 7 6.25 7C5.83579 7 5.5 6.66421 5.5 6.25C5.5 5.83579 5.83579 5.5 6.25 5.5C6.66421 5.5 7 5.83579 7 6.25ZM9.75 7C10.1642 7 10.5 6.66421 10.5 6.25C10.5 5.83579 10.1642 5.5 9.75 5.5C9.33579 5.5 9 5.83579 9 6.25C9 6.66421 9.33579 7 9.75 7Z" fill="#86909C"></path></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              Android
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39=""><g data-v-41eefe39="" id="pingguo-2 1"><path data-v-41eefe39="" id="Vector" d="M11.821 8.9388C11.8035 7.16562 13.267 6.31556 13.3322 6.27312C12.5097 5.06956 11.2287 4.90506 10.7724 4.88581C9.6821 4.77556 8.64523 5.52763 8.09179 5.52763C7.5401 5.52763 6.6861 4.902 5.78179 4.91863C4.59354 4.93613 3.49761 5.60944 2.88598 6.67387C1.65136 8.8163 2.56967 11.9899 3.77323 13.7277C4.36123 14.5782 5.06254 15.5332 5.98304 15.4991C6.86942 15.4637 7.20498 14.9255 8.27642 14.9255C9.34785 14.9255 9.64929 15.4991 10.5877 15.4816C11.5415 15.4637 12.1461 14.6149 12.7302 13.7618C13.4052 12.7752 13.6835 11.8197 13.6997 11.7707C13.6787 11.7611 11.8394 11.0567 11.821 8.9388ZM10.0584 3.73563C10.547 3.14281 10.8769 2.32031 10.7868 1.5C10.0829 1.52888 9.22973 1.969 8.72485 2.56006C8.2716 3.08463 7.87523 3.922 7.98154 4.72613C8.76729 4.78737 9.56923 4.32669 10.0584 3.73563Z" fill="#86909C"></path></g></g><defs data-v-41eefe39=""></defs></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              iOS
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><rect data-v-41eefe39="" id="Rectangle 289" x="1" y="8.5" width="1.3" height="5" rx="0.5" fill="#86909C"></rect><rect data-v-41eefe39="" id="Rectangle 292" x="14" y="8.5" width="1.3" height="5" rx="0.5" fill="#86909C"></rect><rect data-v-41eefe39="" id="Rectangle 293" x="7.5" y="4.5" width="1" height="3" rx="0.5" fill="#86909C"></rect><circle data-v-41eefe39="" id="Ellipse 25" cx="8" cy="2.5" r="1" fill="#86909C"></circle><path data-v-41eefe39="" id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M3 7.5C3 6.94772 3.44772 6.5 4 6.5H12C12.5523 6.5 13 6.94772 13 7.5V14.5C13 15.0523 12.5523 15.5 12 15.5H4C3.44772 15.5 3 15.0523 3 14.5V7.5ZM7 11.25C7 11.6642 6.66421 12 6.25 12C5.83579 12 5.5 11.6642 5.5 11.25C5.5 10.8358 5.83579 10.5 6.25 10.5C6.66421 10.5 7 10.8358 7 11.25ZM9.75 12C10.1642 12 10.5 11.6642 10.5 11.25C10.5 10.8358 10.1642 10.5 9.75 10.5C9.33579 10.5 9 10.8358 9 11.25C9 11.6642 9.33579 12 9.75 12Z" fill="#86909C"></path></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              人工智能
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><g data-v-41eefe39="" id="kaifagongjuicon-hui 1"><path data-v-41eefe39="" id="Vector" d="M14.212 5.04986L13.497 5.76886C13.3158 5.95088 13.1005 6.09531 12.8633 6.19386C12.6261 6.29242 12.3718 6.34315 12.115 6.34315C11.8582 6.34315 11.6039 6.29242 11.3667 6.19386C11.1295 6.09531 10.9142 5.95088 10.733 5.76886C10.3664 5.39915 10.1606 4.89955 10.1606 4.37886C10.1606 3.85817 10.3664 3.35857 10.733 2.98886L11.448 2.26986C11.843 1.87286 11.579 1.40486 10.868 1.51686C10.028 1.64786 9.262 2.07586 8.709 2.72286C8.005 3.41786 7.682 4.66486 7.922 5.81786L1.927 11.8469C1.56096 12.2165 1.35562 12.7157 1.35562 13.2359C1.35562 13.7561 1.56096 14.2552 1.927 14.6249C2.10804 14.807 2.32329 14.9515 2.56038 15.0501C2.79747 15.1487 3.05172 15.1995 3.3085 15.1995C3.56528 15.1995 3.81953 15.1487 4.05662 15.0501C4.29371 14.9515 4.50896 14.807 4.69 14.6249L10.686 8.59486C11.2693 8.7189 11.8745 8.69473 12.446 8.52459C13.0176 8.35444 13.5375 8.04373 13.958 7.62086C14.5581 7.01861 14.9243 6.22244 14.991 5.37486C15.071 4.91886 14.607 4.65286 14.212 5.04986ZM3.768 13.6979C3.67659 13.7885 3.56041 13.85 3.4341 13.8747C3.30779 13.8994 3.17699 13.8861 3.05819 13.8366C2.93939 13.7871 2.8379 13.7036 2.76651 13.5965C2.69511 13.4894 2.65701 13.3636 2.657 13.2349C2.65647 13.0618 2.72462 12.8957 2.84649 12.7729C2.96836 12.6501 3.13399 12.5807 3.307 12.5799C3.487 12.5799 3.651 12.6529 3.768 12.7719C3.888 12.8889 3.96 13.0539 3.96 13.2349C3.9604 13.3209 3.94363 13.4062 3.91066 13.4857C3.87769 13.5652 3.82919 13.6373 3.768 13.6979ZM3.118 5.16786L5.377 7.43986L6.297 6.51286L4.04 4.24286L3.535 3.27086L1.92 2.11186L1 3.03986L2.151 4.66086L3.118 5.16786ZM10.672 9.98586C10.642 9.95526 10.6062 9.93095 10.5667 9.91436C10.5272 9.89776 10.4848 9.88921 10.442 9.88921C10.3992 9.88921 10.3568 9.89776 10.3173 9.91436C10.2778 9.93095 10.242 9.95526 10.212 9.98586L8.83 11.3759C8.79955 11.4062 8.7754 11.4423 8.75891 11.482C8.74243 11.5218 8.73395 11.5644 8.73395 11.6074C8.73395 11.6504 8.74243 11.693 8.75891 11.7327C8.7754 11.7724 8.79955 11.8085 8.83 11.8389L12.09 15.1169C12.2106 15.2383 12.3541 15.3348 12.5122 15.4006C12.6703 15.4663 12.8398 15.5002 13.011 15.5002C13.1822 15.5002 13.3517 15.4663 13.5098 15.4006C13.6679 15.3348 13.8114 15.2383 13.932 15.1169C14.442 14.6049 14.442 13.7769 13.932 13.2639L10.672 9.98586Z" fill="#86909C"></path></g></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              开发工具
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><path data-v-41eefe39="" id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M1 2.5C1 1.94772 1.44772 1.5 2 1.5H14C14.5523 1.5 15 1.94772 15 2.5V14.5C15 15.0523 14.5523 15.5 14 15.5H2C1.44772 15.5 1 15.0523 1 14.5V2.5ZM3 5C3 4.72386 3.22386 4.5 3.5 4.5H12.5C12.7761 4.5 13 4.72386 13 5V5.3C13 5.57614 12.7761 5.8 12.5 5.8H3.5C3.22386 5.8 3 5.57614 3 5.3V5ZM3.5 7.5C3.22386 7.5 3 7.72386 3 8V8.3C3 8.57614 3.22386 8.8 3.5 8.8H4.5C4.77614 8.8 5 8.57614 5 8.3V8C5 7.72386 4.77614 7.5 4.5 7.5H3.5ZM7 8C7 7.72386 7.22386 7.5 7.5 7.5H8.5C8.77614 7.5 9 7.72386 9 8V8.3C9 8.57614 8.77614 8.8 8.5 8.8H7.5C7.22386 8.8 7 8.57614 7 8.3V8ZM11.5 7.5C11.2239 7.5 11 7.72386 11 8V8.3C11 8.57614 11.2239 8.8 11.5 8.8H12.5C12.7761 8.8 13 8.57614 13 8.3V8C13 7.72386 12.7761 7.5 12.5 7.5H11.5ZM3 11C3 10.7239 3.22386 10.5 3.5 10.5H7.5C7.77614 10.5 8 10.7239 8 11V11.3C8 11.5761 7.77614 11.8 7.5 11.8H3.5C3.22386 11.8 3 11.5761 3 11.3V11ZM10.5 10.5C10.2239 10.5 10 10.7239 10 11V11.3C10 11.5761 10.2239 11.8 10.5 11.8H12.5C12.7761 11.8 13 11.5761 13 11.3V11C13 10.7239 12.7761 10.5 12.5 10.5H10.5Z" fill="#86909C"></path></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              代码人生
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><path data-v-41eefe39="" id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M14.9187 7.03385C15.0999 7.26744 14.9466 7.7 14.651 7.7H6.32905V4.5H5.02905V7.7H3.6C2.16406 7.7 1 6.53594 1 5.1C1 3.66406 2.16406 2.5 3.6 2.5H14.651C14.9466 2.5 15.0999 2.93257 14.9188 3.16616C14.5064 3.69779 14.2602 4.36959 14.2602 5.10001C14.2602 5.83043 14.5064 6.50222 14.9187 7.03385Z" fill="#86909C"></path><path data-v-41eefe39="" id="Subtract_2" fill-rule="evenodd" clip-rule="evenodd" d="M1.34902 14.5008C1.0534 14.5008 0.900077 14.0682 1.08126 13.8346C1.49363 13.303 1.7398 12.6312 1.7398 11.9008C1.7398 11.1704 1.49362 10.4986 1.08125 9.96694C0.900064 9.73335 1.05339 9.30078 1.34901 9.30078H12.4C13.8359 9.30078 15 10.4648 15 11.9008C15 13.3367 13.8359 14.5008 12.4 14.5008H1.34902Z" fill="#86909C"></path></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              阅读
            </span></div></div></div></div> <!----></div><div class="byte-modal__footer"><div data-v-41eefe39="" class="left">跳过</div> <div data-v-41eefe39="" class="mid" style="display: none;">上一步</div> <div data-v-41eefe39="" class="right">
      至少选择1个分类
    </div></div></div></div></div><link href="./Groovy AST 之旅 - 掘金_files/36.6f090be.css" rel="stylesheet" type="text/css"><link href="./Groovy AST 之旅 - 掘金_files/153.4faa841.css" rel="stylesheet" type="text/css"><link href="./Groovy AST 之旅 - 掘金_files/9.4cd501f.css" rel="stylesheet" type="text/css"><link href="./Groovy AST 之旅 - 掘金_files/83.ca68669.css" rel="stylesheet" type="text/css"></body><div style="all: initial;"><div id="__hcfy__" style="all: initial;"></div></div></html>